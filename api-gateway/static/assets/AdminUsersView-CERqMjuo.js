import{A as V}from"./AppLayout-SZYprED1.js";import{N as h,a2 as P,m as b,D as w,l as T,O as L,H as R,E as m,v as p,w as s,r as k,I as G,o as v,a as y,d as u,J as M,B as _,u as g,f,x as S,M as H}from"./index-Cixwe8cc.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={async getPendingUsers(){return(await h.get("/admin/pending-users")).data},async getAllUsers(){return(await h.get("/admin/users")).data},async approveUser(l){return(await h.post(`/admin/approve/${l}`)).data},async makeAdmin(l){return(await h.post(`/admin/make-admin/${l}`)).data},async deleteUser(l){return(await h.delete(`/admin/users/${l}`)).data},async revokeAdmin(l){return(await h.post(`/admin/revoke-admin/${l}`)).data}},J=P("admin",()=>{const l=b([]),t=b([]),o=b(!1),i=b(null);async function z(){o.value=!0,i.value=null;try{const r=await A.getPendingUsers();return l.value=r,r}catch(r){const a=w(r,"Ошибка загрузки пользователей");throw i.value=a.message,r.normalizedError=a,r}finally{o.value=!1}}async function C(){o.value=!0,i.value=null;try{const r=await A.getAllUsers();return t.value=r,r}catch(r){const a=w(r,"Ошибка загрузки списка пользователей");throw i.value=a.message,r.normalizedError=a,r}finally{o.value=!1}}async function E(r){o.value=!0,i.value=null;try{const a=await A.approveUser(r);return l.value=l.value.filter(e=>e.id!==r),t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=w(a,"Ошибка одобрения пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{o.value=!1}}async function D(r){o.value=!0,i.value=null;try{const a=await A.makeAdmin(r);return t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=w(a,"Ошибка назначения прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{o.value=!1}}async function d(r){o.value=!0,i.value=null;try{const a=await A.deleteUser(r);return t.value=t.value.filter(e=>e.id!==r),l.value=l.value.filter(e=>e.id!==r),a}catch(a){const e=w(a,"Ошибка удаления пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{o.value=!1}}async function c(r){o.value=!0,i.value=null;try{const a=await A.revokeAdmin(r);return t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=w(a,"Ошибка снятия прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{o.value=!1}}return{pendingUsers:l,users:t,loading:o,error:i,fetchPendingUsers:z,fetchAllUsers:C,approveUser:E,makeAdmin:D,revokeAdmin:c,deleteUser:d}}),O={class:"admin-users-view"},j={class:"actions-group"},q={class:"actions-group"},F={__name:"AdminUsersView",setup(l){const t=J(),o=T(),i=L(()=>t.users),z=async d=>{try{await t.approveUser(d.id),m.success(`Пользователь ${d.email} одобрен`)}catch{m.error(t.error||"Ошибка одобрения пользователя")}},C=async d=>{try{await t.makeAdmin(d.id),m.success(`Пользователь ${d.email} назначен администратором`)}catch{m.error(t.error||"Ошибка назначения прав администратора")}},E=async d=>{try{await t.revokeAdmin(d.id),m.success(`Права администратора сняты с ${d.email}`)}catch{m.error(t.error||"Ошибка снятия прав администратора")}},D=async d=>{if(d.id===o.user?.id){m.error("Нельзя удалить собственную учётную запись администратора");return}try{await H.confirm(`Вы уверены, что хотите удалить пользователя ${d.email}?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning",confirmButtonClass:"el-button--danger"}),await t.deleteUser(d.id),m.success(`Пользователь ${d.email} удалён`)}catch(c){if(c==="cancel")return;m.error(t.error||"Ошибка удаления пользователя")}};return R(async()=>{try{await t.fetchPendingUsers(),await t.fetchAllUsers()}catch{m.error(t.error||"Ошибка загрузки пользователей")}}),(d,c)=>{const r=k("el-card"),a=k("el-empty"),e=k("el-table-column"),$=k("el-tag"),U=k("el-button"),N=k("el-table"),B=G("loading");return v(),p(V,null,{default:s(()=>[y("div",O,[u(r,{class:"header-card"},{default:s(()=>[...c[0]||(c[0]=[y("h1",null,"Управление пользователями",-1),y("p",null,"Одобрение новых пользователей, назначение админов и удаление учётных записей",-1)])]),_:1}),M((v(),p(r,{class:"users-card"},{default:s(()=>[y("h3",null,"Ожидают одобрения ("+_(g(t).pendingUsers.length)+")",1),g(t).pendingUsers.length===0?(v(),p(a,{key:0,description:"Нет пользователей, ожидающих одобрения"})):(v(),p(N,{key:1,data:g(t).pendingUsers,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Статус",width:"120"},{default:s(({row:n})=>[u($,{type:"warning"},{default:s(()=>[f(_(n.status),1)]),_:2},1024)]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:n})=>[f(_(new Date(n.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"150",fixed:"right"},{default:s(({row:n})=>[y("div",j,[u(U,{type:"success",size:"small",onClick:x=>z(n)},{default:s(()=>[...c[1]||(c[1]=[f(" Одобрить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,g(t).loading]]),M((v(),p(r,{class:"users-card"},{default:s(()=>[y("h3",null,"Все пользователи ("+_(i.value.length)+")",1),i.value.length===0?(v(),p(a,{key:0,description:"Пользователи не найдены"})):(v(),p(N,{key:1,data:i.value,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Роль",width:"120"},{default:s(({row:n})=>[u($,{type:n.role==="ADMIN"?"danger":"info"},{default:s(()=>[f(_(n.role),1)]),_:2},1032,["type"])]),_:1}),u(e,{label:"Статус",width:"140"},{default:s(({row:n})=>[u($,{type:n.status==="ACTIVE"?"success":n.status==="PENDING"?"warning":"info"},{default:s(()=>[f(_(n.status),1)]),_:2},1032,["type"])]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:n})=>[f(_(new Date(n.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"320",fixed:"right"},{default:s(({row:n})=>[y("div",q,[n.role!=="ADMIN"?(v(),p(U,{key:0,type:"warning",size:"small",onClick:x=>C(n)},{default:s(()=>[...c[2]||(c[2]=[f(" Сделать админом ",-1)])]),_:1},8,["onClick"])):S("",!0),n.role==="ADMIN"&&n.id!==g(o).user?.id?(v(),p(U,{key:1,type:"info",size:"small",onClick:x=>E(n)},{default:s(()=>[...c[3]||(c[3]=[f(" Снять админа ",-1)])]),_:1},8,["onClick"])):S("",!0),u(U,{type:"danger",size:"small",disabled:n.id===g(o).user?.id,onClick:x=>D(n)},{default:s(()=>[...c[4]||(c[4]=[f(" Удалить ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,g(t).loading]])])]),_:1})}}},X=I(F,[["__scopeId","data-v-07e2c92c"]]);export{X as default};
