import{O as Q,P as rt,m as k,Q as J,D as it,p as ne,r as d,c as F,o,d as t,x as P,R as ut,w as e,u as v,S as ct,K as dt,z as Xe,B as g,F as ee,H as Ae,T as qe,v as b,f as _,a as u,C as ae,U as we,V as Ge,E as U,q as je,e as Je,I as Fe,J as fe,W as pt,k as De,X as Re,g as Me,Y as ft,Z as ze,_ as Pe,h as Le,$ as Ve,a0 as Ie,N as mt,L as _t,a1 as vt,n as yt,a2 as gt,t as wt,a3 as Oe,G as ht}from"./index-Cp45vpHX.js";import{A as bt}from"./AppLayout-sD4zSMcq.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as ye,f as kt,g as Ct}from"./metricNames-DQZnyRyL.js";import{f as $t,a as he,p as St}from"./dateFormat-BP9PuuuJ.js";import{a as We,p as He,u as Et}from"./useResponsive-CyfqvX5o.js";const ve={async upload(a,C){const r=new FormData;return r.append("file",C),(await Q.post(`/participants/${a}/reports`,r,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(a){return await Q.get(`/reports/${a}/download`,{responseType:"blob"})},async getById(a){return(await Q.get(`/reports/${a}`)).data},async delete(a){return(await Q.delete(`/reports/${a}`)).data},async extract(a){return(await Q.post(`/reports/${a}/extract`)).data},async getMetrics(a){return(await Q.get(`/reports/${a}/metrics`)).data},async getList(a){return(await Q.get(`/participants/${a}/reports`)).data}},Ue={async calculate(a,C){return(await Q.post(`/scoring/participants/${a}/calculate`,null,{params:{activity_code:C}})).data},async getHistory(a,C=10){return(await Q.get(`/scoring/participants/${a}/scores`,{params:{limit:C}})).data},async getById(a){return(await Q.get(`/scoring-results/${a}`)).data},async generateRecommendations(a){return(await Q.post(`/reports/${a}/recommendations`)).data},async getFinalReport(a,C,r="json"){const y={params:{activity_code:C,format:r}};r==="html"&&(y.responseType="text");const N=await Q.get(`/participants/${a}/final-report`,y);return N.data},async downloadFinalReportPdf(a,C,r=null){const y={activity_code:C,format:"pdf"};return r&&(y.scoring_result_id=r),await Q.get(`/participants/${a}/final-report`,{params:y,responseType:"blob"})}},Ke=rt("metrics",()=>{const a=k([]),C=k(!1),r=k(null),y=k(null),N=300*1e3,$=J(()=>y.value?Date.now()-y.value>N:!0),L=J(()=>a.value.length>0);async function x({force:w=!1,activeOnly:R=!1}={}){if(!w&&L.value&&!$.value)return a.value;if(C.value)return new Promise(M=>{const V=setInterval(()=>{C.value||(clearInterval(V),M(a.value))},50)});C.value=!0,r.value=null;try{const M=await ye.listMetricDefs(R);return a.value=M,y.value=Date.now(),M}catch(M){const V=it(M,"Ошибка загрузки метрик");throw r.value=V.message,M.normalizedError=V,M}finally{C.value=!1}}function D(w){return a.value.find(R=>R.id===w)}function q(w){const R=D(w);return R?.name_ru||R?.name||w}function W(){y.value=null}function O(w){const R=a.value.findIndex(M=>M.id===w.id);R!==-1&&(a.value[R]=w)}function p(w){a.value=a.value.filter(R=>R.id!==w)}function I(w){a.value.push(w)}return{metricDefs:a,loading:C,error:r,isStale:$,hasData:L,fetchMetricDefs:x,getMetricDefById:D,getMetricName:q,invalidateCache:W,updateInCache:O,removeFromCache:p,addToCache:I}});function ge(a,C=1){if(a==null||a==="")return"";const r=typeof a=="string"?parseFloat(a):a;return isNaN(r)?"":r.toLocaleString("ru-RU",{minimumFractionDigits:C,maximumFractionDigits:C})}function ie(a){if(a==null||a==="")return null;const r=String(a).trim().replace(",","."),y=parseFloat(r);return isNaN(y)?null:y}function xt(a){return ie(a)}function Ze(a,C=1){return ge(a,C)}const Dt={key:0,class:"error-message"},Rt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(a,{emit:C}){const r=a,y=C,N=k(null),$=k(""),L=k(!1),x=k(!1),D=k(""),q=J(()=>ie($.value)),W=J(()=>{const f=q.value;return f===null||f<=r.min}),O=J(()=>{const f=q.value;return f===null||f>=r.max}),p=f=>{if(f==null||f===""){$.value="";return}L.value?$.value=String(f).replace(".",","):$.value=ge(f,r.precision)},I=f=>{if(f==null||f==="")return x.value=!1,D.value="",!0;const S=ie(f);return S===null?(x.value=!0,D.value="Некорректное число",!1):S<r.min?(x.value=!0,D.value=`Значение должно быть не меньше ${ge(r.min,r.precision)}`,!1):S>r.max?(x.value=!0,D.value=`Значение должно быть не больше ${ge(r.max,r.precision)}`,!1):(x.value=!1,D.value="",!0)},w=f=>{const S=f.replace(/[^\d,.-]/g,"");let m=!1;const B=S.split("").filter(T=>T===","||T==="."?m?!1:(m=!0,!0):!0).join("").replace(".",",");$.value=B;const j=ie(B);j!==null?y("update:modelValue",j):(B===""||B==="-")&&y("update:modelValue",null)},R=()=>{L.value=!1;const f=ie($.value);if(I($.value)){if(f!==null){const S=Math.round(f*Math.pow(10,r.precision))/Math.pow(10,r.precision),m=Math.max(r.min,Math.min(r.max,S));y("update:modelValue",m),p(m),y("change",m)}}else if(f!==null&&(f<r.min||f>r.max)){const S=Math.max(r.min,Math.min(r.max,f));y("update:modelValue",S),p(S),y("change",S),x.value=!1,D.value=""}y("blur")},M=()=>{L.value=!0,q.value!==null&&($.value=String(q.value).replace(".",","))},V=()=>{const f=q.value||0,S=Math.min(r.max,f+r.step),m=Math.round(S*Math.pow(10,r.precision))/Math.pow(10,r.precision);y("update:modelValue",m),y("change",m),p(m)},c=()=>{const f=q.value||0,S=Math.max(r.min,f-r.step),m=Math.round(S*Math.pow(10,r.precision))/Math.pow(10,r.precision);y("update:modelValue",m),y("change",m),p(m)};return ne(()=>r.modelValue,f=>{p(f)},{immediate:!0}),p(r.modelValue),(f,S)=>{const m=d("el-button"),B=d("el-button-group"),j=d("el-input");return o(),F(ee,null,[t(j,{ref_key:"inputRef",ref:N,modelValue:$.value,"onUpdate:modelValue":S[0]||(S[0]=T=>$.value=T),placeholder:a.placeholder,disabled:a.disabled,class:Xe({"is-invalid":x.value}),onInput:w,onBlur:R,onFocus:M},ut({_:2},[a.showControls?{name:"append",fn:e(()=>[t(B,null,{default:e(()=>[t(m,{icon:v(ct),disabled:a.disabled||W.value,onClick:c},null,8,["icon","disabled"]),t(m,{icon:v(dt),disabled:a.disabled||O.value,onClick:V},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),x.value?(o(),F("div",Dt,g(D.value),1)):P("",!0)],64)}}},Mt=ue(Rt,[["__scopeId","data-v-f31d5553"]]),Vt={class:"card-header"},It={class:"card-header-left"},At={class:"card-header-actions"},Ft={class:"metrics-filter"},Tt={class:"metrics-stats"},Nt={class:"metrics-count"},zt={key:0,class:"metric-description"},Pt={key:0,class:"metrics-info"},Lt={class:"info-row"},Ot={key:0,class:"info-row"},Ut={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null},reportExtractWarning:{type:String,default:null}},emits:["metrics-updated"],setup(a,{emit:C}){const r=a,y=C,N=k(!1),$=k(!1),L=k(!1),x=k(null),D=k(!1),q=k(0),W=k(0),O=k([]),p=k([]),I=k({metrics:{}}),w=k({}),R=k("metrics"),M=k(null),V=J(()=>{if(!O.value||O.value.length===0)return[];if(D.value)return O.value;const h=new Set(p.value.filter(i=>{const l=parseFloat(String(i.value).replace(",","."));return!isNaN(l)&&l>0}).map(i=>i.metric_def_id));return O.value.filter(i=>{const l=h.has(i.id),X=I.value.metrics[i.id],Z=X!=null&&X!==""&&parseFloat(String(X).replace(",","."))>0;return l||Z})}),c=J(()=>!p.value||p.value.length===0?[]:[...new Set(p.value.map(h=>h.source))]),f=J(()=>{if(!p.value||p.value.length===0)return null;const h=p.value.map(i=>i.updated_at||i.created_at).filter(Boolean).map(i=>new Date(i));return h.length===0?null:new Date(Math.max(...h))}),S=async()=>{N.value=!0,x.value=null;try{const h=await ye.getMetricTemplate(r.reportId);q.value=h.filled_count||0,W.value=h.missing_count||0;const i=h.items||[];p.value=i.filter(l=>l.value!==null).map(l=>({metric_def_id:l.metric_def.id,value:l.value,source:l.source,confidence:l.confidence,notes:l.notes,updated_at:l.updated_at})),O.value=i.map(l=>({id:l.metric_def.id,code:l.metric_def.code,name:l.metric_def.name,name_ru:l.metric_def.name_ru,unit:l.metric_def.unit,min_value:l.metric_def.min_value,max_value:l.metric_def.max_value,description:l.metric_def.description})),I.value.metrics={},i.forEach(l=>{const X=l.metric_def.id;l.value!==null?I.value.metrics[X]=ie(l.value):I.value.metrics[X]=null}),w.value=JSON.parse(JSON.stringify(I.value.metrics))}catch(h){console.error("Failed to load metrics:",h),x.value="Не удалось загрузить метрики"}finally{N.value=!1}},m=async()=>{await S(),U.success("Метрики обновлены")},B=()=>{M.value||(M.value=setInterval(async()=>{await S()},5e3))},j=()=>{M.value&&(clearInterval(M.value),M.value=null)},T=()=>{L.value=!0,D.value=!0,w.value=JSON.parse(JSON.stringify(I.value.metrics))},te=()=>{I.value.metrics=JSON.parse(JSON.stringify(w.value)),L.value=!1,x.value=null},H=async()=>{$.value=!0,x.value=null;try{const h=[],i=[];for(const[K,le]of Object.entries(I.value.metrics)){const se=w.value[K],pe=se!=null&&se!=="";if(le!=null&&le!==""){const oe=xt(le);oe!==null&&h.push({metric_def_id:K,value:oe,source:"MANUAL",notes:null})}else pe&&i.push(K)}const X=(await Promise.allSettled(i.map(K=>ye.clearExtractedMetric(r.reportId,K)))).filter(K=>K.status==="fulfilled"||K.status==="rejected"&&K.reason?.response?.status===404).length;h.length>0&&await ye.bulkCreateExtractedMetrics(r.reportId,h);const Z=[];h.length>0&&Z.push(`сохранено: ${h.length}`),X>0&&Z.push(`сброшено: ${X}`),Z.length===0?U.info("Нет изменений для сохранения"):U.success(`Метрики обновлены (${Z.join(", ")})`),L.value=!1,await S(),y("metrics-updated")}catch(h){console.error("Failed to save metrics:",h);let i="Не удалось сохранить метрики";h.response?.data?.detail&&(typeof h.response.data.detail=="string"?i=h.response.data.detail:Array.isArray(h.response.data.detail)&&(i=h.response.data.detail.map(l=>l.msg||l.message).join(", "))),x.value=i,U.error(i)}finally{$.value=!1}},ce=h=>{switch(h){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},Y=h=>{switch(h){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return h}},de=$t;return Ae(async()=>{}),qe(()=>{j()}),ne(()=>r.reportId,async h=>{h&&await S()}),ne(()=>r.reportStatus,async(h,i)=>{i||await S(),h==="PROCESSING"?(B(),i&&i!=="PROCESSING"&&await S()):(j(),h==="EXTRACTED"&&i&&i!=="EXTRACTED"&&await S())},{immediate:!0}),(h,i)=>{const l=d("el-icon"),X=d("el-tag"),Z=d("el-button"),K=d("el-alert"),le=d("el-switch"),se=d("el-form-item"),pe=d("el-col"),oe=d("el-row"),me=d("el-form"),be=d("el-divider"),ke=d("el-tab-pane"),Ce=d("el-tabs"),_e=d("el-card");return o(),b(_e,{class:"metrics-editor"},{header:e(()=>[u("div",Vt,[u("div",It,[i[5]||(i[5]=u("span",null,"Метрики отчёта",-1)),a.reportStatus==="PROCESSING"?(o(),b(X,{key:0,type:"warning",size:"small",class:"status-tag"},{default:e(()=>[t(l,{class:"is-loading"},{default:e(()=>[t(v(we))]),_:1}),i[3]||(i[3]=_(" Извлечение... ",-1))]),_:1})):a.reportStatus==="EXTRACTED"?(o(),b(X,{key:1,type:"success",size:"small",class:"status-tag"},{default:e(()=>[...i[4]||(i[4]=[_(" Извлечено ",-1)])]),_:1})):P("",!0)]),u("div",At,[L.value?P("",!0):(o(),b(Z,{key:0,size:"small",loading:N.value,onClick:m},{default:e(()=>[t(l,null,{default:e(()=>[t(v(Ge))]),_:1}),i[6]||(i[6]=_(" Обновить ",-1))]),_:1},8,["loading"])),L.value?(o(),F(ee,{key:2},[t(Z,{size:"small",onClick:te},{default:e(()=>[...i[8]||(i[8]=[_(" Отмена ",-1)])]),_:1}),t(Z,{type:"primary",size:"small",loading:$.value,onClick:H},{default:e(()=>[...i[9]||(i[9]=[_(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(o(),b(Z,{key:1,type:"primary",size:"small",onClick:T},{default:e(()=>[...i[7]||(i[7]=[_(" Редактировать ",-1)])]),_:1}))])])]),default:e(()=>[x.value?(o(),b(K,{key:0,type:"error",title:x.value,closable:"",style:{"margin-bottom":"16px"},onClose:i[0]||(i[0]=G=>x.value=null)},null,8,["title"])):P("",!0),r.reportExtractWarning&&r.reportStatus==="EXTRACTED"?(o(),b(K,{key:1,type:"warning",title:r.reportExtractWarning,closable:!1,style:{"margin-bottom":"16px"}},null,8,["title"])):P("",!0),!p.value||p.value.length===0?(o(),b(K,{key:2,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...i[10]||(i[10]=[_(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):P("",!0),t(Ce,{modelValue:R.value,"onUpdate:modelValue":i[2]||(i[2]=G=>R.value=G),type:"card"},{default:e(()=>[t(ke,{label:"Метрики",name:"metrics"},{default:e(()=>[u("div",Ft,[t(le,{modelValue:D.value,"onUpdate:modelValue":i[1]||(i[1]=G=>D.value=G),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),u("div",Tt,[t(X,{type:"success",size:"small"},{default:e(()=>[_(" Заполнено: "+g(q.value),1)]),_:1}),t(X,{type:"info",size:"small"},{default:e(()=>[_(" Не заполнено: "+g(W.value),1)]),_:1}),u("span",Nt," Показано: "+g(V.value.length)+" из "+g(O.value.length),1)])]),t(me,{ref:"formRef",model:I.value,"label-position":"top",disabled:!L.value},{default:e(()=>[t(oe,{gutter:20},{default:e(()=>[(o(!0),F(ee,null,ae(V.value,G=>(o(),b(pe,{key:G.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(se,{label:v(kt)(G),prop:`metrics.${G.id}`},{default:e(()=>[t(Mt,{modelValue:I.value.metrics[G.id],"onUpdate:modelValue":$e=>I.value.metrics[G.id]=$e,min:G.min_value||1,max:G.max_value||10,precision:1,step:.1,disabled:!L.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),G.description?(o(),F("div",zt,g(G.description),1)):P("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),p.value&&p.value.length>0?(o(),F("div",Pt,[t(be),u("div",Lt,[i[11]||(i[11]=u("span",{class:"info-label"},"Источник данных:",-1)),(o(!0),F(ee,null,ae(c.value,G=>(o(),b(X,{key:G,type:ce(G),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[_(g(Y(G)),1)]),_:2},1032,["type"]))),128))]),f.value?(o(),F("div",Ot,[i[12]||(i[12]=u("span",{class:"info-label"},"Последнее обновление:",-1)),u("span",null,g(v(de)(f.value)),1)])):P("",!0)])):P("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Bt=ue(Ut,[["__scopeId","data-v-ab75caac"]]),Xt={class:"report-list"},qt={class:"report-list__controls"},Gt={class:"controls-left"},jt={class:"controls-right"},Jt={class:"filename"},Wt={class:"status-cell"},Ht={key:1,class:"report-list__cards"},Kt={class:"report-card__header"},Zt={class:"report-card__status"},Qt={class:"report-card__body"},Yt={class:"report-card__field"},ea={class:"field-value field-value--filename"},ta={class:"report-card__field"},aa={class:"field-value"},la={class:"report-card__actions"},sa={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(a,{emit:C}){const r=a,y=C,N=je(),$=Je(),{isMobile:L}=We();Ae(()=>{N.query.status&&(x.value=N.query.status),N.query.sort&&(D.value=N.query.sort)});const x=k(""),D=k("desc"),q=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];ne([x,D],([V,c])=>{const f={...N.query};V?f.status=V:delete f.status,c?f.sort=c:delete f.sort,$.replace({query:f})});const W=()=>{},O=()=>{D.value=D.value==="desc"?"asc":"desc"},p=J(()=>{let V=[...r.reports];return x.value&&(V=V.filter(c=>c.status===x.value)),V.sort((c,f)=>{const S=new Date(c.uploaded_at),m=new Date(f.uploaded_at);return D.value==="desc"?m-S:S-m}),V}),I=J(()=>x.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),w=V=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[V]||V,R=V=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[V]||"info",M=async({action:V,report:c})=>{switch(V){case"view":y("view",c.id);break;case"edit":y("edit",c.id);break;case"extract":y("extract",c.id);break;case"download":y("download",c.id);break;case"delete":try{await mt.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),y("delete",c.id)}catch{}break}};return(V,c)=>{const f=d("el-option"),S=d("el-select"),m=d("el-icon"),B=d("el-button"),j=d("el-table-column"),T=d("el-tag"),te=d("el-dropdown-item"),H=d("el-dropdown-menu"),ce=d("el-dropdown"),Y=d("el-table"),de=d("el-card"),h=d("el-empty"),i=Fe("loading");return o(),F("div",Xt,[u("div",qt,[u("div",Gt,[t(S,{modelValue:x.value,"onUpdate:modelValue":c[0]||(c[0]=l=>x.value=l),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:W},{default:e(()=>[t(f,{label:"Все статусы",value:""}),(o(),F(ee,null,ae(q,l=>t(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),u("div",jt,[t(B,{type:D.value==="desc"?"primary":"default",size:"small",onClick:O},{default:e(()=>[t(m,null,{default:e(()=>[t(v(pt))]),_:1}),_(" "+g(D.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),v(L)?fe((o(),F("div",Ht,[(o(!0),F(ee,null,ae(p.value,l=>(o(),b(de,{key:l.id,class:"report-card",shadow:"hover"},{header:e(()=>[u("div",Kt,[u("div",Zt,[l.status==="PROCESSING"?(o(),b(m,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):l.status==="EXTRACTED"?(o(),b(m,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(De))]),_:1})):l.status==="FAILED"?(o(),b(m,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(Re))]),_:1})):(o(),b(m,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(Me))]),_:1})),t(T,{type:R(l.status),size:"small"},{default:e(()=>[_(g(w(l.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[u("div",la,[l.status==="EXTRACTED"?(o(),b(B,{key:0,type:"success",size:"small",onClick:X=>M({action:"edit",report:l})},{default:e(()=>[t(m,null,{default:e(()=>[t(v(ze))]),_:1}),c[10]||(c[10]=_(" Редактировать ",-1))]),_:1},8,["onClick"])):P("",!0),l.status==="PROCESSING"||l.status==="EXTRACTED"?(o(),b(B,{key:1,type:"info",size:"small",onClick:X=>M({action:"view",report:l})},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Pe))]),_:1}),c[11]||(c[11]=_(" Просмотр ",-1))]),_:1},8,["onClick"])):P("",!0),t(B,{type:"primary",size:"small",onClick:X=>M({action:"extract",report:l})},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Le))]),_:1}),_(" "+g(l.status==="FAILED"?"Повторить":l.status==="PROCESSING"?"Перезапустить":l.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(B,{size:"small",onClick:X=>M({action:"download",report:l})},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Ve))]),_:1}),c[12]||(c[12]=_(" Скачать ",-1))]),_:1},8,["onClick"]),t(B,{type:"danger",size:"small",onClick:X=>M({action:"delete",report:l})},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Ie))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[u("div",Qt,[u("div",Yt,[c[8]||(c[8]=u("span",{class:"field-label"},"Файл:",-1)),u("span",ea,g(l.file_ref?.filename||"Без названия"),1)]),u("div",ta,[c[9]||(c[9]=u("span",{class:"field-label"},"Дата загрузки:",-1)),u("span",aa,g(v(he)(l.uploaded_at)),1)])])]),_:2},1024))),128)),!p.value.length&&!a.loading?(o(),b(h,{key:0,description:I.value,"image-size":120},{default:e(()=>[x.value?P("",!0):(o(),b(B,{key:0,type:"primary",onClick:c[1]||(c[1]=l=>V.$emit("upload"))},{default:e(()=>[...c[13]||(c[13]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):P("",!0)])),[[i,a.loading]]):fe((o(),b(Y,{key:0,data:p.value,class:"report-list__table",stripe:"","empty-text":I.value},{default:e(()=>[t(j,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:l})=>[u("span",Jt,g(l.file_ref?.filename||"Без названия"),1)]),_:1}),t(j,{prop:"status",label:"Статус",width:"200"},{default:e(({row:l})=>[u("div",Wt,[l.status==="PROCESSING"?(o(),b(m,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):l.status==="EXTRACTED"?(o(),b(m,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(De))]),_:1})):l.status==="FAILED"?(o(),b(m,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(Re))]),_:1})):(o(),b(m,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(Me))]),_:1})),t(T,{type:R(l.status),size:"default"},{default:e(()=>[_(g(w(l.status)),1)]),_:2},1032,["type"])])]),_:1}),t(j,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:l})=>[_(g(v(he)(l.uploaded_at)),1)]),_:1}),t(j,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:l})=>[t(ce,{trigger:"click",onCommand:M},{dropdown:e(()=>[t(H,null,{default:e(()=>[l.status==="EXTRACTED"?(o(),b(te,{key:0,command:{action:"edit",report:l}},{default:e(()=>[t(m,null,{default:e(()=>[t(v(ze))]),_:1}),c[4]||(c[4]=_(" Редактировать метрики ",-1))]),_:1},8,["command"])):P("",!0),l.status==="PROCESSING"||l.status==="EXTRACTED"?(o(),b(te,{key:1,command:{action:"view",report:l}},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Pe))]),_:1}),c[5]||(c[5]=_(" Просмотр метрик ",-1))]),_:1},8,["command"])):P("",!0),t(te,{command:{action:"extract",report:l}},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Le))]),_:1}),_(" "+g(l.status==="FAILED"?"Повторить извлечение":l.status==="PROCESSING"?"Перезапустить извлечение":l.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(te,{divided:"",command:{action:"download",report:l}},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Ve))]),_:1}),c[6]||(c[6]=_(" Скачать ",-1))]),_:1},8,["command"]),t(te,{command:{action:"delete",report:l},class:"dropdown-item--danger"},{default:e(()=>[t(m,null,{default:e(()=>[t(v(Ie))]),_:1}),c[7]||(c[7]=_(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(B,{type:"primary",size:"small"},{default:e(()=>[c[3]||(c[3]=_(" Действия ",-1)),t(m,{class:"el-icon--right"},{default:e(()=>[t(v(ft))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[i,a.loading]]),!p.value.length&&!a.loading&&!v(L)?(o(),b(h,{key:2,description:I.value,"image-size":120},{default:e(()=>[x.value?P("",!0):(o(),b(B,{key:0,type:"primary",onClick:c[2]||(c[2]=l=>V.$emit("upload"))},{default:e(()=>[...c[14]||(c[14]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):P("",!0)])}}},na=ue(sa,[["__scopeId","data-v-49005412"]]),oa={class:"metrics-drawer"},ra={class:"drawer-actions"},ia={key:1},ua={key:1},ca={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(a,{emit:C}){const r=a,y=C,N=Ke(),$=k(!1),L=k([]),x=J(()=>N.metricDefs),D=J(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),q=w=>{y("update:modelValue",w)},W=async()=>{try{await N.fetchMetricDefs({activeOnly:!0})}catch(w){console.error("Error loading metric definitions:",w)}},O=async()=>{$.value=!0;try{const w=await He.getMetrics(r.participantId);L.value=w.metrics||[]}catch(w){console.error("Error loading participant metrics:",w),U.error("Ошибка загрузки метрик участника")}finally{$.value=!1}},p=w=>{if(!w)return"—";const R=x.value?.find(V=>V.code===w);return Ct(R,w,{warn:()=>{}})},I=w=>w>=.8?"var(--el-color-success)":w>=.6?"var(--el-color-warning)":"var(--el-color-danger)";return ne(()=>r.participantId,async w=>{w&&r.modelValue&&(await W(),await O())}),ne(()=>r.modelValue,async w=>{w&&r.participantId&&(await W(),await O())}),(w,R)=>{const M=d("el-icon"),V=d("el-button"),c=d("el-table-column"),f=d("el-tag"),S=d("el-table"),m=d("el-empty"),B=d("el-drawer"),j=Fe("loading");return o(),b(B,{"model-value":a.modelValue,title:`Метрики участника: ${a.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":q},{default:e(()=>[fe((o(),F("div",oa,[u("div",ra,[t(V,{type:"primary",size:"small",onClick:O},{default:e(()=>[t(M,null,{default:e(()=>[t(v(Ge))]),_:1}),R[0]||(R[0]=_(" Обновить ",-1))]),_:1})]),t(S,{data:L.value,stripe:"","empty-text":D.value},{default:e(()=>[t(c,{prop:"metric_code",label:"Код метрики",width:"200"}),t(c,{label:"Название метрики","min-width":"250"},{default:e(({row:T})=>[_(g(p(T.metric_code)),1)]),_:1}),t(c,{prop:"value",label:"Значение",width:"120"},{default:e(({row:T})=>[t(f,{type:"success"},{default:e(()=>[_(g(v(Ze)(T.value)),1)]),_:2},1024)]),_:1}),t(c,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:T})=>[T.confidence!==null?(o(),F("span",{key:0,style:_t({color:I(T.confidence)})},g((T.confidence*100).toFixed(0))+"% ",5)):(o(),F("span",ia,"—"))]),_:1}),t(c,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:T})=>[_(g(v(he)(T.updated_at)),1)]),_:1}),t(c,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:T})=>[T.last_source_report_id?(o(),b(f,{key:0,size:"small"},{default:e(()=>[...R[1]||(R[1]=[_(" Из отчёта ",-1)])]),_:1})):(o(),F("span",ua,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!L.value.length&&!$.value?(o(),b(m,{key:0,description:D.value},null,8,["description"])):P("",!0)])),[[j,$.value]])]),_:1},8,["model-value","title"])}}},da=ue(ca,[["__scopeId","data-v-ce564aa7"]]),pa={class:"scoring-result"},fa={class:"score-value"},ma={class:"score-number"},_a={key:0,class:"top-competencies-section"},va={class:"competencies-list"},ya={class:"competency-rank"},ga={class:"competency-info"},wa={class:"competency-name"},ha={class:"competency-details"},ba={class:"score-details"},ka={class:"score-section"},Ca={key:0},$a={class:"score-section"},Sa={key:0},Ea={key:1,class:"final-report-actions"},xa={__name:"ScoringResultCard",props:{result:{type:Object,required:!0}},emits:["download-pdf"],setup(a){const C=a,r=J(()=>{const N=C.result.score_pct;return N>=70?"success":N>=40?"warning":"exception"}),y=(N,$=1)=>Ze(N,$);return(N,$)=>{const L=d("el-progress"),x=d("el-icon"),D=d("el-tag"),q=d("el-empty"),W=d("el-button"),O=d("el-card");return o(),b(O,{class:"scoring-card"},{default:e(()=>[u("h4",null,g(a.result.prof_activity_name),1),u("div",pa,[u("div",fa,[u("span",ma,g(a.result.score_pct)+"%",1),t(L,{percentage:a.result.score_pct,status:r.value},null,8,["percentage","status"])]),a.result.top_competencies&&a.result.top_competencies.length?(o(),F("div",_a,[u("h5",null,[t(x,null,{default:e(()=>[t(v(vt))]),_:1}),$[1]||($[1]=_(" Топ-5 компетенций по совместимости: ",-1))]),u("div",va,[(o(!0),F(ee,null,ae(a.result.top_competencies,(p,I)=>(o(),F("div",{key:I,class:"competency-item"},[u("span",ya,g(I+1),1),u("div",ga,[u("span",wa,g(p.metric_name_ru||p.metric_name),1),u("div",ha,[t(D,{size:"small",type:"success"},{default:e(()=>[_(" Значение: "+g(y(p.value)),1)]),_:2},1024),t(D,{size:"small",type:"info"},{default:e(()=>[_(" Вес: "+g(y(p.weight,2)),1)]),_:2},1024),t(D,{size:"small",type:"warning"},{default:e(()=>[_(" Вклад: "+g(y(p.contribution,2)),1)]),_:2},1024)])])]))),128))])])):P("",!0),u("div",ba,[u("div",ka,[$[2]||($[2]=u("h5",null,"Сильные стороны:",-1)),a.result.strengths&&a.result.strengths.length?(o(),F("ul",Ca,[(o(!0),F(ee,null,ae(a.result.strengths,(p,I)=>(o(),F("li",{key:I},[u("strong",null,g(p.metric_name),1),_(" — "+g(y(p.value))+" (вес "+g(y(p.weight,2))+") ",1)]))),128))])):(o(),b(q,{key:1,description:"Нет данных","image-size":60}))]),u("div",$a,[$[3]||($[3]=u("h5",null,"Зоны развития:",-1)),a.result.dev_areas&&a.result.dev_areas.length?(o(),F("ul",Sa,[(o(!0),F(ee,null,ae(a.result.dev_areas,(p,I)=>(o(),F("li",{key:I},[u("strong",null,g(p.metric_name),1),_(" — "+g(y(p.value))+" (вес "+g(y(p.weight,2))+") ",1)]))),128))])):(o(),b(q,{key:1,description:"Нет данных","image-size":60}))])]),a.result.prof_activity_code?(o(),F("div",Ea,[t(W,{type:"primary",size:"small",onClick:$[0]||($[0]=p=>N.$emit("download-pdf",a.result))},{default:e(()=>[t(x,null,{default:e(()=>[t(v(Ve))]),_:1}),$[4]||($[4]=_(" Скачать PDF ",-1))]),_:1})])):P("",!0)])]),_:1})}}},Da=ue(xa,[["__scopeId","data-v-f7e8b35c"]]),Ra={class:"participant-detail"},Ma={class:"card-header"},Va={class:"header-actions"},Ia={class:"section-header"},Aa={key:0,class:"batch-files-list"},Fa={class:"batch-files-header"},Ta={class:"batch-file-info"},Na={class:"batch-file-name"},za={class:"batch-file-size"},Pa={key:0,class:"batch-file-error"},La={class:"activity-code-hint"},Be=20*1024*1024,xe=10,Oa={__name:"ParticipantDetailView",setup(a){const C=Je(),r=je(),y=Et(),N=Ke(),$=k(!1),L=k(!1),{isMobile:x}=We(),D=k(!1),q=k(!1),W=k(!1),O=J(()=>y.currentParticipant),p=k([]),I=k(null),w=k([]),R=k(null);J(()=>N.metricDefs);const M=k(null),V=J(()=>p.value.some(s=>s.status==="PROCESSING")),c=J(()=>R.value&&p.value.find(n=>n.id===R.value)?.status||null),f=J(()=>R.value&&p.value.find(n=>n.id===R.value)?.extract_warning||null),S=k(!1),m=k(!1),B=k(!1),j=k(!1),T=k(null),te=k([]),H=k([]);let ce=0;const Y=yt({activityCode:""}),de=async()=>{$.value=!0;try{await y.getParticipant(r.params.id)}catch{U.error("Участник не найден"),C.push("/participants")}finally{$.value=!1}},h=async({silent:s=!1}={})=>{s||(L.value=!0);try{const n=await He.getReports(r.params.id);p.value=n.items||[]}catch(n){console.error("Error loading reports:",n),U.error("Ошибка загрузки списка отчётов")}finally{s||(L.value=!1)}},i=s=>{if(!s)return s;const n=Array.isArray(s.recommendations)?s.recommendations:[];let z=s.recommendations_status||s.recommendationsStatus||null;z||(z=n.length>0?"ready":"pending");const A=Number(s.score_pct),re=Number.isNaN(A)?s.score_pct:A;return{...s,score_pct:re,recommendations:n,recommendations_status:z,recommendations_error:s.recommendations_error||s.recommendationsError||null,top_competencies:s.top_competencies||[]}},l=async()=>{D.value=!0;try{const s=await St.list();w.value=s||[]}catch{U.error("Ошибка загрузки профессиональных областей")}finally{D.value=!1}},X=async()=>{try{await N.fetchMetricDefs({activeOnly:!0})}catch(s){console.error("Error loading metric definitions:",s)}},Z=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",K=s=>s.name.toLowerCase().endsWith(".docx")?s.size>Be?`Размер файла превышает ${Z(Be)}`:null:"Только файлы формата .docx",le=(s,n)=>{const z=s.raw;if(H.value.length>=xe){U.warning(`Максимальное количество файлов: ${xe}`),T.value&&T.value.clearFiles();return}const A=K(z);if(A){U.error(A),T.value&&T.value.clearFiles();return}H.value.push({id:++ce,file:z,name:z.name,size:z.size,status:"pending",progress:0,error:null,reportId:null}),T.value&&T.value.clearFiles()},se=s=>{H.value=H.value.filter(n=>n.id!==s)},pe=async s=>{s.status="uploading",s.progress=0;try{const n=await ve.upload(r.params.id,s.file);s.status="success",s.reportId=n.id}catch(n){s.status="error",s.error=n.response?.data?.detail||"Ошибка загрузки"}},oe=async()=>{const s=H.value.filter(n=>n.status==="pending");if(s.length===0){U.warning("Нет файлов для загрузки");return}q.value=!0;try{await Promise.allSettled(s.map(A=>pe(A)));const n=H.value.filter(A=>A.status==="success").length,z=H.value.filter(A=>A.status==="error").length;z===0?(U.success(`Загружено ${n} отчётов`),S.value=!1,me()):U.warning(`Загружено: ${n}, ошибок: ${z}`),await h()}finally{q.value=!1}},me=()=>{H.value=[],te.value=[],T.value&&T.value.clearFiles()},be=async s=>{try{const n=await ve.download(s),z=window.URL.createObjectURL(new Blob([n.data])),A=document.createElement("a");A.href=z,A.setAttribute("download",`report_${s}.docx`),document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(z),U.success("Отчёт скачан")}catch{U.error("Ошибка скачивания отчёта")}},ke=async s=>{try{await ve.extract(s),U.success("Извлечение метрик запущено"),await h()}catch{U.error("Ошибка запуска извлечения метрик")}},Ce=()=>{M.value||(M.value=setInterval(async()=>{try{await h({silent:!0})}catch(s){console.error("Auto-refresh error:",s)}},3e3))},_e=()=>{M.value&&(clearInterval(M.value),M.value=null)};ne(V,s=>{s?Ce():_e()});const G=async s=>{R.value=s,await ht(),B.value=!0},$e=async()=>{U.success("Метрики обновлены"),await h({silent:!0})},Qe=async s=>{try{await ve.delete(s),U.success("Отчёт удалён"),await h()}catch{U.error("Ошибка удаления отчёта")}},Ye=async()=>{if(!Y.activityCode){U.warning("Выберите профессиональную область");return}W.value=!0;try{const s=await Ue.calculate(r.params.id,Y.activityCode);I.value=i({id:s.scoring_result_id,participant_id:r.params.id,prof_activity_code:s.prof_activity_code||Y.activityCode,prof_activity_name:s.prof_activity_name,score_pct:parseFloat(s.score_pct),strengths:s.strengths||[],dev_areas:s.dev_areas||[],top_competencies:s.top_competencies||[],recommendations:s.recommendations||[],recommendations_status:s.recommendations_status||((s.recommendations||[]).length>0?"ready":"pending"),recommendations_error:s.recommendations_error||null,created_at:new Date().toISOString()}),U.success("Расчёт пригодности выполнен"),m.value=!1,Y.activityCode=""}catch(s){console.error("Scoring calculation error:",s);const n=s.response?.data?.detail||"Ошибка расчёта пригодности";U.error(n)}finally{W.value=!1}},et=async s=>{if(!s.prof_activity_code){U.warning("Код профессиональной деятельности не найден");return}try{const n=await Ue.downloadFinalReportPdf(r.params.id,s.prof_activity_code,s.id),z=window.URL.createObjectURL(new Blob([n.data])),A=document.createElement("a");A.href=z,A.setAttribute("download",`final_report_${s.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(z),U.success("Отчёт PDF скачан")}catch(n){const z=n.response?.data?.detail||"Ошибка загрузки PDF отчёта";U.error(z)}};return Ae(async()=>{await Promise.all([de(),h(),l(),X()])}),qe(()=>{_e()}),(s,n)=>{const z=d("el-button"),A=d("el-icon"),re=d("el-descriptions-item"),tt=d("el-descriptions"),Se=d("el-card"),at=d("el-upload"),Ee=d("el-dialog"),lt=d("el-option"),st=d("el-select"),nt=d("el-form-item"),Te=d("el-alert"),ot=d("el-form"),Ne=Fe("loading");return o(),b(bt,null,{default:e(()=>[fe((o(),F("div",Ra,[O.value?(o(),b(Se,{key:0,class:"detail-card"},{header:e(()=>[u("div",Ma,[u("h2",null,g(O.value.full_name),1),u("div",Va,[t(z,{onClick:n[0]||(n[0]=E=>v(C).back())},{default:e(()=>[...n[12]||(n[12]=[_(" Назад ",-1)])]),_:1}),t(z,{type:"info",onClick:n[1]||(n[1]=E=>j.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(v(gt))]),_:1}),n[13]||(n[13]=_(" Метрики ",-1))]),_:1}),t(z,{type:"primary",onClick:n[2]||(n[2]=E=>m.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(v(wt))]),_:1}),n[14]||(n[14]=_(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(tt,{column:v(x)?1:2,border:""},{default:e(()=>[t(re,{label:"ФИО"},{default:e(()=>[_(g(O.value.full_name),1)]),_:1}),t(re,{label:"Дата рождения"},{default:e(()=>[_(g(O.value.birth_date||"Не указана"),1)]),_:1}),t(re,{label:"Внешний ID"},{default:e(()=>[_(g(O.value.external_id||"Не указан"),1)]),_:1}),t(re,{label:"Дата создания"},{default:e(()=>[_(g(v(he)(O.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):P("",!0),t(Se,{class:"section-card"},{header:e(()=>[u("div",Ia,[n[16]||(n[16]=u("h3",null,"Отчёты",-1)),t(z,{type:"primary",onClick:n[3]||(n[3]=E=>S.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(v(Oe))]),_:1}),n[15]||(n[15]=_(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(na,{reports:p.value,loading:L.value,onView:G,onEdit:G,onExtract:ke,onDownload:be,onDelete:Qe,onUpload:n[4]||(n[4]=E=>S.value=!0)},null,8,["reports","loading"])]),_:1}),I.value?(o(),b(Se,{key:1,class:"section-card"},{header:e(()=>[...n[17]||(n[17]=[u("h3",null,"Результат оценки пригодности",-1)])]),default:e(()=>[t(Da,{result:I.value,onDownloadPdf:et},null,8,["result"])]),_:1})):P("",!0),t(Ee,{modelValue:S.value,"onUpdate:modelValue":n[6]||(n[6]=E=>S.value=E),title:"Загрузить отчёты",width:v(x)?"95%":"600px","destroy-on-close":"",onClose:me},{footer:e(()=>[t(z,{onClick:n[5]||(n[5]=E=>S.value=!1)},{default:e(()=>[...n[20]||(n[20]=[_(" Отмена ",-1)])]),_:1}),t(z,{type:"primary",loading:q.value,disabled:!H.value.some(E=>E.status==="pending"),onClick:oe},{default:e(()=>[_(" Загрузить все ("+g(H.value.filter(E=>E.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(at,{ref_key:"uploadRef",ref:T,"auto-upload":!1,multiple:"",accept:".docx","on-change":le,"show-file-list":!1,drag:""},{tip:e(()=>[...n[18]||(n[18]=[u("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(A,{class:"el-icon--upload"},{default:e(()=>[t(v(Oe))]),_:1}),n[19]||(n[19]=u("div",{class:"el-upload__text"},[_(" Перетащите файлы сюда или "),u("em",null,"нажмите для выбора")],-1))]),_:1},512),H.value.length?(o(),F("div",Aa,[u("div",Fa," Выбрано файлов: "+g(H.value.length)+"/"+g(xe),1),(o(!0),F(ee,null,ae(H.value,E=>(o(),F("div",{key:E.id,class:Xe(["batch-file-item","batch-file-item--"+E.status])},[E.status==="pending"?(o(),b(A,{key:0,class:"batch-file-icon"},{default:e(()=>[t(v(Me))]),_:1})):E.status==="uploading"?(o(),b(A,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(v(we))]),_:1})):E.status==="success"?(o(),b(A,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(v(De))]),_:1})):E.status==="error"?(o(),b(A,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(v(Re))]),_:1})):P("",!0),u("div",Ta,[u("span",Na,g(E.name),1),u("span",za,g(Z(E.size)),1),E.error?(o(),F("span",Pa,g(E.error),1)):P("",!0)]),E.status==="pending"||E.status==="error"?(o(),b(z,{key:4,type:"danger",icon:v(Ie),circle:"",size:"small",onClick:Ua=>se(E.id)},null,8,["icon","onClick"])):P("",!0)],2))),128))])):P("",!0)]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:m.value,"onUpdate:modelValue":n[9]||(n[9]=E=>m.value=E),title:"Рассчитать профессиональную пригодность",width:v(x)?"95%":"500px","destroy-on-close":""},{footer:e(()=>[t(z,{onClick:n[8]||(n[8]=E=>m.value=!1)},{default:e(()=>[...n[21]||(n[21]=[_(" Отмена ",-1)])]),_:1}),t(z,{type:"primary",loading:W.value,disabled:!Y.activityCode||p.value.length===0,onClick:Ye},{default:e(()=>[...n[22]||(n[22]=[_(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(ot,{model:Y,"label-position":"top"},{default:e(()=>[t(nt,{label:"Профессиональная область",required:""},{default:e(()=>[fe((o(),b(st,{modelValue:Y.activityCode,"onUpdate:modelValue":n[7]||(n[7]=E=>Y.activityCode=E),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(o(!0),F(ee,null,ae(w.value,E=>(o(),b(lt,{key:E.code,label:E.name,value:E.code},{default:e(()=>[u("span",null,g(E.name),1),u("span",La,g(E.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[Ne,D.value]])]),_:1}),t(Te,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),p.value.length===0?(o(),b(Te,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):P("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:B.value,"onUpdate:modelValue":n[10]||(n[10]=E=>B.value=E),title:"Метрики отчёта",width:"90%",top:"5vh","destroy-on-close":""},{default:e(()=>[R.value?(o(),b(Bt,{key:0,"report-id":R.value,"report-status":c.value,"report-extract-warning":f.value,onMetricsUpdated:$e},null,8,["report-id","report-status","report-extract-warning"])):P("",!0)]),_:1},8,["modelValue"]),t(da,{modelValue:j.value,"onUpdate:modelValue":n[11]||(n[11]=E=>j.value=E),"participant-id":O.value?.id,"participant-name":O.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[Ne,$.value]])]),_:1})}}},Wa=ue(Oa,[["__scopeId","data-v-ed9dbc59"]]);export{Wa as default};
