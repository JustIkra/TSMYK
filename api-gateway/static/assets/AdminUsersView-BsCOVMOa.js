import{A as P}from"./AppLayout-DYB8i-PD.js";import{N as _,a2 as T,m as E,D as g,l as L,O as R,H as G,E as p,v as f,w as s,r as h,I as H,o as m,a as w,d as u,J as M,B as y,u as k,f as v,c as S,x as V,M as I}from"./index-B5SOunuZ.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={async getPendingUsers(){return(await _.get("/admin/pending-users")).data},async getAllUsers(){return(await _.get("/admin/users")).data},async approveUser(o){return(await _.post(`/admin/approve/${o}`)).data},async makeAdmin(o){return(await _.post(`/admin/make-admin/${o}`)).data},async deleteUser(o){return(await _.delete(`/admin/users/${o}`)).data},async revokeAdmin(o){return(await _.post(`/admin/revoke-admin/${o}`)).data}},O=T("admin",()=>{const o=E([]),t=E([]),d=E(!1),i=E(null);async function z(){d.value=!0,i.value=null;try{const n=await A.getPendingUsers();return o.value=n,n}catch(n){const a=g(n,"Ошибка загрузки пользователей");throw i.value=a.message,n.normalizedError=a,n}finally{d.value=!1}}async function C(){d.value=!0,i.value=null;try{const n=await A.getAllUsers();return t.value=n,n}catch(n){const a=g(n,"Ошибка загрузки списка пользователей");throw i.value=a.message,n.normalizedError=a,n}finally{d.value=!1}}async function D(n){d.value=!0,i.value=null;try{const a=await A.approveUser(n);return o.value=o.value.filter(e=>e.id!==n),t.value=t.value.map(e=>e.id===n?a:e),a}catch(a){const e=g(a,"Ошибка одобрения пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{d.value=!1}}async function $(n){d.value=!0,i.value=null;try{const a=await A.makeAdmin(n);return t.value=t.value.map(e=>e.id===n?a:e),a}catch(a){const e=g(a,"Ошибка назначения прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{d.value=!1}}async function c(n){d.value=!0,i.value=null;try{const a=await A.deleteUser(n);return t.value=t.value.filter(e=>e.id!==n),o.value=o.value.filter(e=>e.id!==n),a}catch(a){const e=g(a,"Ошибка удаления пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{d.value=!1}}async function l(n){d.value=!0,i.value=null;try{const a=await A.revokeAdmin(n);return t.value=t.value.map(e=>e.id===n?a:e),a}catch(a){const e=g(a,"Ошибка снятия прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{d.value=!1}}return{pendingUsers:o,users:t,loading:d,error:i,fetchPendingUsers:z,fetchAllUsers:C,approveUser:D,makeAdmin:$,revokeAdmin:l,deleteUser:c}}),j={class:"admin-users-view"},q={class:"actions-group"},F={key:0,class:"actions-column"},K={key:1,class:"actions-column"},Q={__name:"AdminUsersView",setup(o){const t=O(),d=L(),i=R(()=>t.users),z=async c=>{try{await t.approveUser(c.id),p.success(`Пользователь ${c.email} одобрен`)}catch{p.error(t.error||"Ошибка одобрения пользователя")}},C=async c=>{try{await t.makeAdmin(c.id),p.success(`Пользователь ${c.email} назначен администратором`)}catch{p.error(t.error||"Ошибка назначения прав администратора")}},D=async c=>{try{await t.revokeAdmin(c.id),p.success(`Права администратора сняты с ${c.email}`)}catch{p.error(t.error||"Ошибка снятия прав администратора")}},$=async c=>{if(c.id===d.user?.id){p.error("Нельзя удалить собственную учётную запись администратора");return}try{await I.confirm(`Вы уверены, что хотите удалить пользователя ${c.email}?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning",confirmButtonClass:"el-button--danger"}),await t.deleteUser(c.id),p.success(`Пользователь ${c.email} удалён`)}catch(l){if(l==="cancel")return;p.error(t.error||"Ошибка удаления пользователя")}};return G(async()=>{try{await t.fetchPendingUsers(),await t.fetchAllUsers()}catch{p.error(t.error||"Ошибка загрузки пользователей")}}),(c,l)=>{const n=h("el-card"),a=h("el-empty"),e=h("el-table-column"),U=h("el-tag"),b=h("el-button"),N=h("el-table"),B=H("loading");return m(),f(P,null,{default:s(()=>[w("div",j,[u(n,{class:"header-card"},{default:s(()=>[...l[0]||(l[0]=[w("h1",null,"Управление пользователями",-1),w("p",null,"Одобрение новых пользователей, назначение админов и удаление учётных записей",-1)])]),_:1}),M((m(),f(n,{class:"users-card"},{default:s(()=>[w("h3",null,"Ожидают одобрения ("+y(k(t).pendingUsers.length)+")",1),k(t).pendingUsers.length===0?(m(),f(a,{key:0,description:"Нет пользователей, ожидающих одобрения"})):(m(),f(N,{key:1,data:k(t).pendingUsers,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Статус",width:"120"},{default:s(({row:r})=>[u(U,{type:"warning"},{default:s(()=>[v(y(r.status),1)]),_:2},1024)]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:r})=>[v(y(new Date(r.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"150",fixed:"right"},{default:s(({row:r})=>[w("div",q,[u(b,{type:"success",size:"small",onClick:x=>z(r)},{default:s(()=>[...l[1]||(l[1]=[v(" Одобрить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,k(t).loading]]),M((m(),f(n,{class:"users-card"},{default:s(()=>[w("h3",null,"Все пользователи ("+y(i.value.length)+")",1),i.value.length===0?(m(),f(a,{key:0,description:"Пользователи не найдены"})):(m(),f(N,{key:1,data:i.value,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Роль",width:"120"},{default:s(({row:r})=>[u(U,{type:r.role==="ADMIN"?"danger":"info"},{default:s(()=>[v(y(r.role),1)]),_:2},1032,["type"])]),_:1}),u(e,{label:"Статус",width:"140"},{default:s(({row:r})=>[u(U,{type:r.status==="ACTIVE"?"success":r.status==="PENDING"?"warning":"info"},{default:s(()=>[v(y(r.status),1)]),_:2},1032,["type"])]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:r})=>[v(y(new Date(r.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"160",align:"center"},{default:s(({row:r})=>[r.id===k(d).user?.id?(m(),S("div",F,[u(U,{type:"info"},{default:s(()=>[...l[2]||(l[2]=[v("Это вы",-1)])]),_:1})])):(m(),S("div",K,[r.role!=="ADMIN"?(m(),f(b,{key:0,type:"warning",onClick:x=>C(r)},{default:s(()=>[...l[3]||(l[3]=[v(" В админы ",-1)])]),_:1},8,["onClick"])):V("",!0),r.role==="ADMIN"?(m(),f(b,{key:1,type:"info",onClick:x=>D(r)},{default:s(()=>[...l[4]||(l[4]=[v(" Снять админа ",-1)])]),_:1},8,["onClick"])):V("",!0),u(b,{type:"danger",onClick:x=>$(r)},{default:s(()=>[...l[5]||(l[5]=[v(" Удалить ",-1)])]),_:1},8,["onClick"])]))]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,k(t).loading]])])]),_:1})}}},Z=J(Q,[["__scopeId","data-v-650294e4"]]);export{Z as default};
