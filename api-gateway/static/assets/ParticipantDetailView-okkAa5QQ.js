import{P as H,m as v,Q,p as se,r as p,c as C,o as l,d as t,x as V,R as $t,w as e,u as _,S as Rt,L as Dt,z as Ge,B as y,F as Z,H as je,v as m,f,C as Y,a as d,T as Re,U as Et,V as St,W as xt,X as Mt,M as tt,Y as Vt,E as F,q as at,e as st,I as nt,J as Je,K as ve,Z as It,k as Pe,_ as Oe,g as Be,$ as At,a0 as Ke,a1 as Ze,h as Qe,a2 as qe,a3 as Xe,O as Ft,a4 as lt,n as Nt,a5 as zt,t as Lt,a6 as Ye,G as Tt}from"./index-DeozQkGC.js";import{A as Ut}from"./AppLayout-Cbd1SLMa.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Pt,m as _e,g as Ot,p as Bt}from"./metricNames-CJ8-RwwD.js";import{p as ot,u as qt}from"./participants-CLMfH9sA.js";const me={async upload(i,k){const u=new FormData;return u.append("file",k),(await H.post(`/participants/${i}/reports`,u,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(i){return await H.get(`/reports/${i}/download`,{responseType:"blob"})},async getById(i){return(await H.get(`/reports/${i}`)).data},async delete(i){return(await H.delete(`/reports/${i}`)).data},async extract(i){return(await H.post(`/reports/${i}/extract`)).data},async getMetrics(i){return(await H.get(`/reports/${i}/metrics`)).data},async getList(i){return(await H.get(`/participants/${i}/reports`)).data},async getReportImages(i){return(await H.get(`/reports/${i}/images`)).data}},Te={async calculate(i,k){return(await H.post(`/scoring/participants/${i}/calculate`,null,{params:{activity_code:k}})).data},async getHistory(i,k=10){return(await H.get(`/scoring/participants/${i}/scores`,{params:{limit:k}})).data},async getById(i){return(await H.get(`/scoring-results/${i}`)).data},async generateRecommendations(i){return(await H.post(`/reports/${i}/recommendations`)).data},async getFinalReport(i,k,u="json"){const E={params:{activity_code:k,format:u}};u==="html"&&(E.responseType="text");const T=await H.get(`/participants/${i}/final-report`,E);return T.data},async downloadFinalReportPdf(i,k){return await H.get(`/participants/${i}/final-report`,{params:{activity_code:k,format:"pdf"},responseType:"blob"})}};function $e(i,k=1){if(i==null||i==="")return"";const u=typeof i=="string"?parseFloat(i):i;return isNaN(u)?"":u.toLocaleString("ru-RU",{minimumFractionDigits:k,maximumFractionDigits:k})}function de(i){if(i==null||i==="")return null;const u=String(i).trim().replace(",","."),E=parseFloat(u);return isNaN(E)?null:E}function Xt(i){return de(i)}function fe(i,k=1){return $e(i,k)}const Gt={key:0,class:"error-message"},jt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(i,{emit:k}){const u=i,E=k,T=v(null),N=v(""),U=v(!1),x=v(!1),I=v(""),R=Q(()=>de(N.value)),P=Q(()=>{const c=R.value;return c===null||c<=u.min}),G=Q(()=>{const c=R.value;return c===null||c>=u.max}),B=c=>{if(c==null||c===""){N.value="";return}U.value?N.value=String(c).replace(".",","):N.value=$e(c,u.precision)},q=c=>{if(c==null||c==="")return x.value=!1,I.value="",!0;const o=de(c);return o===null?(x.value=!0,I.value="Некорректное число",!1):o<u.min?(x.value=!0,I.value=`Значение должно быть не меньше ${$e(u.min,u.precision)}`,!1):o>u.max?(x.value=!0,I.value=`Значение должно быть не больше ${$e(u.max,u.precision)}`,!1):(x.value=!1,I.value="",!0)},b=c=>{const o=c.replace(/[^\d,.-]/g,"");let w=!1;const L=o.split("").filter(D=>D===","||D==="."?w?!1:(w=!0,!0):!0).join("").replace(".",",");N.value=L;const h=de(L);h!==null?E("update:modelValue",h):(L===""||L==="-")&&E("update:modelValue",null)},M=()=>{U.value=!1;const c=de(N.value);if(q(N.value)){if(c!==null){const o=Math.round(c*Math.pow(10,u.precision))/Math.pow(10,u.precision),w=Math.max(u.min,Math.min(u.max,o));E("update:modelValue",w),B(w),E("change",w)}}else if(c!==null&&(c<u.min||c>u.max)){const o=Math.max(u.min,Math.min(u.max,c));E("update:modelValue",o),B(o),E("change",o),x.value=!1,I.value=""}E("blur")},j=()=>{U.value=!0,R.value!==null&&(N.value=String(R.value).replace(".",","))},J=()=>{const c=R.value||0,o=Math.min(u.max,c+u.step),w=Math.round(o*Math.pow(10,u.precision))/Math.pow(10,u.precision);E("update:modelValue",w),E("change",w),B(w)},z=()=>{const c=R.value||0,o=Math.max(u.min,c-u.step),w=Math.round(o*Math.pow(10,u.precision))/Math.pow(10,u.precision);E("update:modelValue",w),E("change",w),B(w)};return se(()=>u.modelValue,c=>{B(c)},{immediate:!0}),B(u.modelValue),(c,o)=>{const w=p("el-button"),L=p("el-button-group"),h=p("el-input");return l(),C(Z,null,[t(h,{ref_key:"inputRef",ref:T,modelValue:N.value,"onUpdate:modelValue":o[0]||(o[0]=D=>N.value=D),placeholder:i.placeholder,disabled:i.disabled,class:Ge({"is-invalid":x.value}),onInput:b,onBlur:M,onFocus:j},$t({_:2},[i.showControls?{name:"append",fn:e(()=>[t(L,null,{default:e(()=>[t(w,{icon:_(Rt),disabled:i.disabled||P.value,onClick:z},null,8,["icon","disabled"]),t(w,{icon:_(Dt),disabled:i.disabled||G.value,onClick:J},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),x.value?(l(),C("div",Gt,y(I.value),1)):V("",!0)],64)}}},Jt=ge(jt,[["__scopeId","data-v-74ef628d"]]),Wt={class:"card-header"},Ht={key:1},Kt={key:0,class:"metric-description"},Zt={key:0,class:"metrics-info"},Qt={class:"info-row"},Yt={key:0,class:"info-row"},ea={key:0,class:"loading-container"},ta={key:1,class:"no-images"},aa={key:2,class:"images-container"},sa={class:"image-controls"},na={class:"image-slide"},la=["src","alt"],oa={class:"image-info"},ra={class:"image-filename"},ia={key:0,class:"image-page"},ua={__name:"MetricsEditor",props:{reportId:{type:String,required:!0}},emits:["metrics-updated"],setup(i,{emit:k}){const u=i,E=k,T=v(!1),N=v(!1),U=v(!1),x=v(null),I=v([]),R=v([]),P=v({metrics:{}}),G=v({}),B=v("metrics"),q=v([]),b=v(!1),M=v(1),j=v(!1),J=v(null),z=v(500),c=Q(()=>!R.value||R.value.length===0?[]:[...new Set(R.value.map(n=>n.source))]),o=Q(()=>!R.value||R.value.length===0?null:new Date),w=async()=>{try{const n=await _e.listMetricDefs(!0);I.value=n.items||[]}catch(n){console.error("Failed to load metric definitions:",n),x.value="Не удалось загрузить определения метрик"}},L=async()=>{T.value=!0,x.value=null;try{const n=await _e.listExtractedMetrics(u.reportId);R.value=n.items||[],P.value.metrics={},R.value.forEach(g=>{P.value.metrics[g.metric_def_id]=de(g.value)}),G.value=JSON.parse(JSON.stringify(P.value.metrics))}catch(n){console.error("Failed to load metrics:",n),x.value="Не удалось загрузить метрики"}finally{T.value=!1}},h=()=>{U.value=!0,G.value=JSON.parse(JSON.stringify(P.value.metrics))},D=()=>{P.value.metrics=JSON.parse(JSON.stringify(G.value)),U.value=!1,x.value=null},W=async()=>{N.value=!0,x.value=null;try{const n=[];for(const[g,X]of Object.entries(P.value.metrics))if(X!=null&&X!==""){const te=Xt(X);te!==null&&n.push({metric_def_id:g,value:te,source:"MANUAL",notes:null})}if(n.length===0){F.warning("Не введено ни одного значения метрики"),N.value=!1;return}await _e.bulkCreateExtractedMetrics(u.reportId,n),F.success(`Успешно сохранено ${n.length} метрик`),U.value=!1,await L(),E("metrics-updated")}catch(n){console.error("Failed to save metrics:",n);let g="Не удалось сохранить метрики";n.response?.data?.detail&&(typeof n.response.data.detail=="string"?g=n.response.data.detail:Array.isArray(n.response.data.detail)&&(g=n.response.data.detail.map(X=>X.msg||X.message).join(", "))),x.value=g,F.error(g)}finally{N.value=!1}},le=n=>{switch(n){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},O=n=>{switch(n){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return n}},ce=n=>new Date(n).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),K=async()=>{b.value=!0,x.value=null;try{q.value=await me.getReportImages(u.reportId)}catch(n){console.error("Failed to load report images:",n),x.value="Не удалось загрузить изображения отчёта",F.error("Не удалось загрузить изображения отчёта")}finally{b.value=!1}},oe=()=>{M.value<2&&(M.value=Math.min(2,M.value+.25))},pe=()=>{M.value>.5&&(M.value=Math.max(.5,M.value-.25))},re=()=>{M.value=1},ne=()=>{j.value=!j.value,j.value?z.value=window.innerHeight-100:z.value=500};return je(async()=>{await w(),await L()}),se(()=>u.reportId,async n=>{n&&(await L(),q.value=[])}),se(B,async n=>{n==="images"&&q.value.length===0&&!b.value&&await K()}),(n,g)=>{const X=p("el-button"),te=p("el-alert"),De=p("el-form-item"),Ee=p("el-col"),ye=p("el-row"),Se=p("el-form"),xe=p("el-divider"),Me=p("el-tag"),we=p("el-tab-pane"),ae=p("el-icon"),be=p("el-empty"),Ve=p("el-button-group"),Ie=p("el-carousel-item"),Ae=p("el-carousel"),he=p("el-tabs"),Fe=p("el-card");return l(),m(Fe,{class:"metrics-editor"},{header:e(()=>[d("div",Wt,[g[5]||(g[5]=d("span",null,"Ручной ввод метрик",-1)),U.value?(l(),C("div",Ht,[t(X,{size:"small",onClick:D},{default:e(()=>[...g[3]||(g[3]=[f(" Отмена ",-1)])]),_:1}),t(X,{type:"primary",size:"small",loading:N.value,onClick:W},{default:e(()=>[...g[4]||(g[4]=[f(" Сохранить ",-1)])]),_:1},8,["loading"])])):(l(),m(X,{key:0,type:"primary",size:"small",onClick:h},{default:e(()=>[...g[2]||(g[2]=[f(" Редактировать ",-1)])]),_:1}))])]),default:e(()=>[x.value?(l(),m(te,{key:0,type:"error",title:x.value,closable:"",style:{"margin-bottom":"16px"},onClose:g[0]||(g[0]=A=>x.value=null)},null,8,["title"])):V("",!0),!R.value||R.value.length===0?(l(),m(te,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...g[6]||(g[6]=[f(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):V("",!0),t(he,{modelValue:B.value,"onUpdate:modelValue":g[1]||(g[1]=A=>B.value=A),type:"card"},{default:e(()=>[t(we,{label:"Метрики",name:"metrics"},{default:e(()=>[t(Se,{ref:"formRef",model:P.value,"label-position":"top",disabled:!U.value},{default:e(()=>[t(ye,{gutter:20},{default:e(()=>[(l(!0),C(Z,null,Y(I.value,A=>(l(),m(Ee,{key:A.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(De,{label:_(Pt)(A),prop:`metrics.${A.id}`},{default:e(()=>[t(Jt,{modelValue:P.value.metrics[A.id],"onUpdate:modelValue":ke=>P.value.metrics[A.id]=ke,min:A.min_value||1,max:A.max_value||10,precision:1,step:.1,disabled:!U.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),A.description?(l(),C("div",Kt,y(A.description),1)):V("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),R.value&&R.value.length>0?(l(),C("div",Zt,[t(xe),d("div",Qt,[g[7]||(g[7]=d("span",{class:"info-label"},"Источник данных:",-1)),(l(!0),C(Z,null,Y(c.value,A=>(l(),m(Me,{key:A,type:le(A),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[f(y(O(A)),1)]),_:2},1032,["type"]))),128))]),o.value?(l(),C("div",Yt,[g[8]||(g[8]=d("span",{class:"info-label"},"Последнее обновление:",-1)),d("span",null,y(ce(o.value)),1)])):V("",!0)])):V("",!0)]),_:1}),t(we,{label:"Изображения отчёта",name:"images"},{default:e(()=>[b.value?(l(),C("div",ea,[t(ae,{class:"is-loading"},{default:e(()=>[t(_(Re))]),_:1}),g[9]||(g[9]=d("span",{style:{"margin-left":"8px"}},"Загрузка изображений...",-1))])):q.value.length===0?(l(),C("div",ta,[t(be,{description:"Изображения отсутствуют"},{image:e(()=>[t(ae,{size:60,color:"var(--el-color-info)"},{default:e(()=>[t(_(Et))]),_:1})]),_:1})])):(l(),C("div",aa,[d("div",sa,[t(Ve,null,{default:e(()=>[t(X,{onClick:pe,disabled:M.value<=.5},{default:e(()=>[t(ae,null,{default:e(()=>[t(_(St))]),_:1})]),_:1},8,["disabled"]),t(X,{onClick:re},{default:e(()=>[f(y(Math.round(M.value*100))+"% ",1)]),_:1}),t(X,{onClick:oe,disabled:M.value>=2},{default:e(()=>[t(ae,null,{default:e(()=>[t(_(xt))]),_:1})]),_:1},8,["disabled"])]),_:1}),t(X,{onClick:ne,style:{"margin-left":"12px"}},{default:e(()=>[t(ae,null,{default:e(()=>[t(_(Mt))]),_:1}),g[10]||(g[10]=f(" Полноэкранный режим ",-1))]),_:1})]),d("div",{ref_key:"carouselContainer",ref:J,class:Ge(["carousel-wrapper",{fullscreen:j.value}])},[t(Ae,{height:z.value+"px",arrow:"always","indicator-position":"outside"},{default:e(()=>[(l(!0),C(Z,null,Y(q.value,A=>(l(),m(Ie,{key:A.id},{default:e(()=>[d("div",na,[d("div",{class:"image-wrapper",style:tt({transform:`scale(${M.value})`})},[d("img",{src:A.data_url,alt:A.filename,class:"report-image"},null,8,la)],4),d("div",oa,[d("span",ra,y(A.filename),1),A.page_number?(l(),C("span",ia," Страница "+y(A.page_number),1)):V("",!0)])])]),_:2},1024))),128))]),_:1},8,["height"]),j.value?(l(),m(X,{key:0,class:"exit-fullscreen",onClick:ne,circle:""},{default:e(()=>[t(ae,null,{default:e(()=>[t(_(Vt))]),_:1})]),_:1})):V("",!0)],2)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},da=ge(ua,[["__scopeId","data-v-ae4b8311"]]),ca={class:"report-list"},pa={class:"report-list__controls"},ma={class:"controls-left"},fa={class:"controls-right"},_a={class:"filename"},va={class:"status-cell"},ga={key:1,class:"report-list__cards"},ya={class:"report-card__header"},wa={class:"report-card__status"},ba={class:"report-card__body"},ha={class:"report-card__field"},ka={class:"field-value field-value--filename"},Ca={class:"report-card__field"},$a={class:"field-value"},Ra={class:"report-card__actions"},Da={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(i,{emit:k}){const u=i,E=k,T=at(),N=st(),U=v(window.innerWidth<=768),x=()=>{U.value=window.innerWidth<=768};je(()=>{window.addEventListener("resize",x),T.query.status&&(I.value=T.query.status),T.query.sort&&(R.value=T.query.sort)}),nt(()=>{window.removeEventListener("resize",x)});const I=v(""),R=v("desc"),P=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];se([I,R],([c,o])=>{const w={...T.query};c?w.status=c:delete w.status,o?w.sort=o:delete w.sort,N.replace({query:w})});const G=()=>{},B=()=>{R.value=R.value==="desc"?"asc":"desc"},q=Q(()=>{let c=[...u.reports];return I.value&&(c=c.filter(o=>o.status===I.value)),c.sort((o,w)=>{const L=new Date(o.uploaded_at),h=new Date(w.uploaded_at);return R.value==="desc"?h-L:L-h}),c}),b=Q(()=>I.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),M=c=>{if(!c)return"—";const o=new Date(c);return Number.isNaN(o.getTime())?"—":o.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},j=c=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[c]||c,J=c=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[c]||"info",z=async({action:c,report:o})=>{switch(c){case"view":E("view",o.id);break;case"edit":E("edit",o.id);break;case"extract":E("extract",o.id);break;case"download":E("download",o.id);break;case"delete":try{await Ft.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),E("delete",o.id)}catch{}break}};return(c,o)=>{const w=p("el-option"),L=p("el-select"),h=p("el-icon"),D=p("el-button"),W=p("el-table-column"),le=p("el-tag"),O=p("el-dropdown-item"),ce=p("el-dropdown-menu"),K=p("el-dropdown"),oe=p("el-table"),pe=p("el-card"),re=p("el-empty"),ne=Je("loading");return l(),C("div",ca,[d("div",pa,[d("div",ma,[t(L,{modelValue:I.value,"onUpdate:modelValue":o[0]||(o[0]=n=>I.value=n),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:G},{default:e(()=>[t(w,{label:"Все статусы",value:""}),(l(),C(Z,null,Y(P,n=>t(w,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),d("div",fa,[t(D,{type:R.value==="desc"?"primary":"default",size:"small",onClick:B},{default:e(()=>[t(h,null,{default:e(()=>[t(_(It))]),_:1}),f(" "+y(R.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),U.value?ve((l(),C("div",ga,[(l(!0),C(Z,null,Y(q.value,n=>(l(),m(pe,{key:n.id,class:"report-card",shadow:"hover"},{header:e(()=>[d("div",ya,[d("div",wa,[n.status==="PROCESSING"?(l(),m(h,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(_(Re))]),_:1})):n.status==="EXTRACTED"?(l(),m(h,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(_(Pe))]),_:1})):n.status==="FAILED"?(l(),m(h,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(_(Oe))]),_:1})):(l(),m(h,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(_(Be))]),_:1})),t(le,{type:J(n.status),size:"small"},{default:e(()=>[f(y(j(n.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[d("div",Ra,[n.status==="EXTRACTED"?(l(),m(D,{key:0,type:"success",size:"small",onClick:g=>z({action:"edit",report:n})},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Ke))]),_:1}),o[10]||(o[10]=f(" Редактировать ",-1))]),_:1},8,["onClick"])):V("",!0),n.status==="PROCESSING"||n.status==="EXTRACTED"?(l(),m(D,{key:1,type:"info",size:"small",onClick:g=>z({action:"view",report:n})},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Ze))]),_:1}),o[11]||(o[11]=f(" Просмотр ",-1))]),_:1},8,["onClick"])):V("",!0),t(D,{type:"primary",size:"small",onClick:g=>z({action:"extract",report:n})},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Qe))]),_:1}),f(" "+y(n.status==="FAILED"?"Повторить":n.status==="PROCESSING"?"Перезапустить":n.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(D,{size:"small",onClick:g=>z({action:"download",report:n})},{default:e(()=>[t(h,null,{default:e(()=>[t(_(qe))]),_:1}),o[12]||(o[12]=f(" Скачать ",-1))]),_:1},8,["onClick"]),t(D,{type:"danger",size:"small",onClick:g=>z({action:"delete",report:n})},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Xe))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[d("div",ba,[d("div",ha,[o[8]||(o[8]=d("span",{class:"field-label"},"Файл:",-1)),d("span",ka,y(n.file_ref?.filename||"Без названия"),1)]),d("div",Ca,[o[9]||(o[9]=d("span",{class:"field-label"},"Дата загрузки:",-1)),d("span",$a,y(M(n.uploaded_at)),1)])])]),_:2},1024))),128)),!q.value.length&&!i.loading?(l(),m(re,{key:0,description:b.value,"image-size":120},{default:e(()=>[I.value?V("",!0):(l(),m(D,{key:0,type:"primary",onClick:o[1]||(o[1]=n=>c.$emit("upload"))},{default:e(()=>[...o[13]||(o[13]=[f(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):V("",!0)])),[[ne,i.loading]]):ve((l(),m(oe,{key:0,data:q.value,class:"report-list__table",stripe:"","empty-text":b.value},{default:e(()=>[t(W,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:n})=>[d("span",_a,y(n.file_ref?.filename||"Без названия"),1)]),_:1}),t(W,{prop:"status",label:"Статус",width:"200"},{default:e(({row:n})=>[d("div",va,[n.status==="PROCESSING"?(l(),m(h,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(_(Re))]),_:1})):n.status==="EXTRACTED"?(l(),m(h,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(_(Pe))]),_:1})):n.status==="FAILED"?(l(),m(h,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(_(Oe))]),_:1})):(l(),m(h,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(_(Be))]),_:1})),t(le,{type:J(n.status),size:"default"},{default:e(()=>[f(y(j(n.status)),1)]),_:2},1032,["type"])])]),_:1}),t(W,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:n})=>[f(y(M(n.uploaded_at)),1)]),_:1}),t(W,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:n})=>[t(K,{trigger:"click",onCommand:z},{dropdown:e(()=>[t(ce,null,{default:e(()=>[n.status==="EXTRACTED"?(l(),m(O,{key:0,command:{action:"edit",report:n}},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Ke))]),_:1}),o[4]||(o[4]=f(" Редактировать метрики ",-1))]),_:1},8,["command"])):V("",!0),n.status==="PROCESSING"||n.status==="EXTRACTED"?(l(),m(O,{key:1,command:{action:"view",report:n}},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Ze))]),_:1}),o[5]||(o[5]=f(" Просмотр метрик ",-1))]),_:1},8,["command"])):V("",!0),t(O,{command:{action:"extract",report:n}},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Qe))]),_:1}),f(" "+y(n.status==="FAILED"?"Повторить извлечение":n.status==="PROCESSING"?"Перезапустить извлечение":n.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(O,{divided:"",command:{action:"download",report:n}},{default:e(()=>[t(h,null,{default:e(()=>[t(_(qe))]),_:1}),o[6]||(o[6]=f(" Скачать ",-1))]),_:1},8,["command"]),t(O,{command:{action:"delete",report:n},class:"dropdown-item--danger"},{default:e(()=>[t(h,null,{default:e(()=>[t(_(Xe))]),_:1}),o[7]||(o[7]=f(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(D,{type:"primary",size:"small"},{default:e(()=>[o[3]||(o[3]=f(" Действия ",-1)),t(h,{class:"el-icon--right"},{default:e(()=>[t(_(At))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[ne,i.loading]]),!q.value.length&&!i.loading&&!U.value?(l(),m(re,{key:2,description:b.value,"image-size":120},{default:e(()=>[I.value?V("",!0):(l(),m(D,{key:0,type:"primary",onClick:o[2]||(o[2]=n=>c.$emit("upload"))},{default:e(()=>[...o[14]||(o[14]=[f(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):V("",!0)])}}},Ea=ge(Da,[["__scopeId","data-v-0ed222e2"]]),Sa={class:"metrics-drawer"},xa={class:"drawer-actions"},Ma={key:1},Va={key:1},Ia={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(i,{emit:k}){const u=i,E=k,T=v(!1),N=v([]),U=v([]),x=Q(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),I=b=>{E("update:modelValue",b)},R=async()=>{try{const b=await _e.listMetricDefs(!0);U.value=b.items||[]}catch(b){console.error("Error loading metric definitions:",b)}},P=async()=>{T.value=!0;try{const b=await ot.getMetrics(u.participantId);N.value=b.metrics||[]}catch(b){console.error("Error loading participant metrics:",b),F.error("Ошибка загрузки метрик участника")}finally{T.value=!1}},G=b=>{if(!b)return"—";const M=U.value.find(J=>J.code===b);return Ot(M,b,{warn:()=>{}})},B=b=>b>=.8?"var(--el-color-success)":b>=.6?"var(--el-color-warning)":"var(--el-color-danger)",q=b=>{if(!b)return"—";const M=new Date(b);return Number.isNaN(M.getTime())?"—":M.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return se(()=>u.participantId,async b=>{b&&u.modelValue&&(await R(),await P())}),se(()=>u.modelValue,async b=>{b&&u.participantId&&(await R(),await P())}),(b,M)=>{const j=p("el-icon"),J=p("el-button"),z=p("el-table-column"),c=p("el-tag"),o=p("el-table"),w=p("el-empty"),L=p("el-drawer"),h=Je("loading");return l(),m(L,{"model-value":i.modelValue,title:`Метрики участника: ${i.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":I},{default:e(()=>[ve((l(),C("div",Sa,[d("div",xa,[t(J,{type:"primary",size:"small",onClick:P},{default:e(()=>[t(j,null,{default:e(()=>[t(_(lt))]),_:1}),M[0]||(M[0]=f(" Обновить ",-1))]),_:1})]),t(o,{data:N.value,stripe:"","empty-text":x.value},{default:e(()=>[t(z,{prop:"metric_code",label:"Код метрики",width:"200"}),t(z,{label:"Название метрики","min-width":"250"},{default:e(({row:D})=>[f(y(G(D.metric_code)),1)]),_:1}),t(z,{prop:"value",label:"Значение",width:"120"},{default:e(({row:D})=>[t(c,{type:"success"},{default:e(()=>[f(y(_(fe)(D.value)),1)]),_:2},1024)]),_:1}),t(z,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:D})=>[D.confidence!==null?(l(),C("span",{key:0,style:tt({color:B(D.confidence)})},y((D.confidence*100).toFixed(0))+"% ",5)):(l(),C("span",Ma,"—"))]),_:1}),t(z,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:D})=>[f(y(q(D.updated_at)),1)]),_:1}),t(z,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:D})=>[D.last_source_report_id?(l(),m(c,{key:0,size:"small"},{default:e(()=>[...M[1]||(M[1]=[f(" Из отчёта ",-1)])]),_:1})):(l(),C("span",Va,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!N.value.length&&!T.value?(l(),m(w,{key:0,description:x.value},null,8,["description"])):V("",!0)])),[[h,T.value]])]),_:1},8,["model-value","title"])}}},Aa=ge(Ia,[["__scopeId","data-v-93720633"]]),Fa={class:"participant-detail"},Na={class:"card-header"},za={class:"header-actions"},La={class:"section-header"},Ta={class:"scoring-result"},Ua={class:"score-value"},Pa={class:"score-number"},Oa={class:"score-details"},Ba={class:"score-section"},qa={key:0},Xa={class:"score-section"},Ga={key:0},ja={class:"score-section recommendations-status-section"},Ja={class:"recommendations-pending-alert"},Wa={key:0,class:"final-report-actions"},Ha={key:0,class:"batch-files-list"},Ka={class:"batch-files-header"},Za={class:"batch-file-info"},Qa={class:"batch-file-name"},Ya={class:"batch-file-size"},es={key:0,class:"batch-file-error"},ts={class:"activity-code-hint"},et=20*1024*1024,Ue=10,as={__name:"ParticipantDetailView",setup(i){const k=st(),u=at(),E=qt(),T=v(!1),N=v(!1),U=v(window.innerWidth<=768),x=()=>{U.value=window.innerWidth<=768},I=v(!1),R=v(!1),P=v(!1),G=Q(()=>E.currentParticipant),B=v([]),q=v([]),b=v([]),M=v([]),j=v(null),J=v(null),z=v(null),c=Q(()=>B.value.some(a=>a.status==="PROCESSING")),o=Q(()=>q.value.some(a=>a.recommendations_status==="pending")),w=v(!1),L=v(!1),h=v(!1),D=v(!1),W=v(null),le=v([]),O=v([]);let ce=0;const K=Nt({activityCode:""}),oe=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},pe=a=>a>=80?"success":a>=60?"":"warning",re=a=>({pending:"Формируются",ready:"Готовы",error:"Ошибка",disabled:"Отключены"})[a]||a,ne=a=>({pending:"info",ready:"success",error:"danger",disabled:"warning"})[a]||"info",n=async()=>{T.value=!0;try{await E.getParticipant(u.params.id)}catch{F.error("Участник не найден"),k.push("/participants")}finally{T.value=!1}},g=async({silent:a=!1}={})=>{a||(N.value=!0);try{const s=await ot.getReports(u.params.id);B.value=s.items||[]}catch(s){console.error("Error loading reports:",s),F.error("Ошибка загрузки списка отчётов")}finally{a||(N.value=!1)}},X=a=>{if(!a)return a;const s=Array.isArray(a.recommendations)?a.recommendations:[];let S=a.recommendations_status||a.recommendationsStatus||null;S||(S=s.length>0?"ready":"pending");const $=Number(a.score_pct),ie=Number.isNaN($)?a.score_pct:$;return{...a,score_pct:ie,recommendations:s,recommendations_status:S,recommendations_error:a.recommendations_error||a.recommendationsError||null}},te=async()=>{try{const a=await Te.getHistory(u.params.id),s=Array.isArray(a.items)?a.items:[];q.value=s.map(X)}catch(a){console.error("Error loading scoring results:",a)}},De=async()=>{I.value=!0;try{const a=await Bt.list();b.value=a||[]}catch{F.error("Ошибка загрузки профессиональных областей")}finally{I.value=!1}},Ee=async()=>{try{const a=await _e.listMetricDefs(!0);M.value=a.items||[]}catch(a){console.error("Error loading metric definitions:",a)}},ye=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",Se=a=>a.name.toLowerCase().endsWith(".docx")?a.size>et?`Размер файла превышает ${ye(et)}`:null:"Только файлы формата .docx",xe=(a,s)=>{const S=a.raw;if(O.value.length>=Ue){F.warning(`Максимальное количество файлов: ${Ue}`),W.value&&W.value.clearFiles();return}const $=Se(S);if($){F.error($),W.value&&W.value.clearFiles();return}O.value.push({id:++ce,file:S,name:S.name,size:S.size,status:"pending",progress:0,error:null,reportId:null}),W.value&&W.value.clearFiles()},Me=a=>{O.value=O.value.filter(s=>s.id!==a)},we=async a=>{a.status="uploading",a.progress=0;try{const s=await me.upload(u.params.id,a.file);a.status="success",a.reportId=s.id}catch(s){a.status="error",a.error=s.response?.data?.detail||"Ошибка загрузки"}},ae=async()=>{const a=O.value.filter(s=>s.status==="pending");if(a.length===0){F.warning("Нет файлов для загрузки");return}R.value=!0;try{await Promise.allSettled(a.map($=>we($)));const s=O.value.filter($=>$.status==="success").length,S=O.value.filter($=>$.status==="error").length;S===0?(F.success(`Загружено ${s} отчётов`),w.value=!1,be()):F.warning(`Загружено: ${s}, ошибок: ${S}`),await g()}finally{R.value=!1}},be=()=>{O.value=[],le.value=[],W.value&&W.value.clearFiles()},Ve=async a=>{try{const s=await me.download(a),S=window.URL.createObjectURL(new Blob([s.data])),$=document.createElement("a");$.href=S,$.setAttribute("download",`report_${a}.docx`),document.body.appendChild($),$.click(),$.remove(),window.URL.revokeObjectURL(S),F.success("Отчёт скачан")}catch{F.error("Ошибка скачивания отчёта")}},Ie=async a=>{try{await me.extract(a),F.success("Извлечение метрик запущено"),await g()}catch{F.error("Ошибка запуска извлечения метрик")}},Ae=()=>{J.value||(J.value=setInterval(async()=>{try{await g({silent:!0})}catch(a){console.error("Auto-refresh error:",a)}},3e3))},he=()=>{J.value&&(clearInterval(J.value),J.value=null)},Fe=()=>{z.value||(z.value=setInterval(async()=>{try{await te()}catch(a){console.error("Recommendations auto-refresh error:",a)}},15e3))},A=()=>{z.value&&(clearInterval(z.value),z.value=null)};se(c,a=>{a?Ae():he()}),se(o,a=>{a?Fe():A()});const ke=async a=>{j.value=a,await Tt(),h.value=!0},rt=async()=>{F.success("Метрики обновлены")},it=async a=>{try{await me.delete(a),F.success("Отчёт удалён"),await g()}catch{F.error("Ошибка удаления отчёта")}},ut=async()=>{if(!K.activityCode){F.warning("Выберите профессиональную область");return}P.value=!0;try{const a=await Te.calculate(u.params.id,K.activityCode),s=X({id:a.scoring_result_id,participant_id:u.params.id,prof_activity_code:a.prof_activity_code||K.activityCode,prof_activity_name:a.prof_activity_name,score_pct:parseFloat(a.score_pct),strengths:a.strengths||[],dev_areas:a.dev_areas||[],recommendations:a.recommendations||[],recommendations_status:a.recommendations_status||((a.recommendations||[]).length>0?"ready":"pending"),recommendations_error:a.recommendations_error||null,created_at:new Date().toISOString()});q.value.unshift(s),F.success("Расчёт пригодности выполнен"),L.value=!1,K.activityCode=""}catch(a){console.error("Scoring calculation error:",a);const s=a.response?.data?.detail||"Ошибка расчёта пригодности";F.error(s)}finally{P.value=!1}},dt=async a=>{if(!a.prof_activity_code){F.warning("Код профессиональной деятельности не найден");return}try{const s=await Te.downloadFinalReportPdf(u.params.id,a.prof_activity_code),S=window.URL.createObjectURL(new Blob([s.data])),$=document.createElement("a");$.href=S,$.setAttribute("download",`final_report_${a.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild($),$.click(),$.remove(),window.URL.revokeObjectURL(S),F.success("Отчёт PDF скачан")}catch(s){const S=s.response?.data?.detail||"Ошибка загрузки PDF отчёта";F.error(S)}},We=a=>a?.recommendations_status==="ready"||a?.recommendations_status==="disabled",ct=a=>a?.recommendations_status==="pending"?"Дождитесь завершения генерации рекомендаций":a?.recommendations_status==="error"?"Ошибка генерации рекомендаций. Попробуйте пересчитать пригодность":"",pt=a=>a?.recommendations_error?`Ошибка генерации: ${a.recommendations_error}`:"Не удалось получить рекомендации";return je(async()=>{window.addEventListener("resize",x),await n(),await g(),await te(),await De(),await Ee()}),nt(()=>{window.removeEventListener("resize",x),he(),A()}),(a,s)=>{const S=p("el-button"),$=p("el-icon"),ie=p("el-descriptions-item"),mt=p("el-descriptions"),Ce=p("el-card"),ft=p("el-progress"),Ne=p("el-empty"),_t=p("el-tag"),ue=p("el-alert"),vt=p("el-tooltip"),gt=p("el-timeline-item"),yt=p("el-timeline"),wt=p("el-upload"),ze=p("el-dialog"),bt=p("el-option"),ht=p("el-select"),kt=p("el-form-item"),Ct=p("el-form"),He=Je("loading");return l(),m(Ut,null,{default:e(()=>[ve((l(),C("div",Fa,[G.value?(l(),m(Ce,{key:0,class:"detail-card"},{header:e(()=>[d("div",Na,[d("h2",null,y(G.value.full_name),1),d("div",za,[t(S,{onClick:s[0]||(s[0]=r=>_(k).back())},{default:e(()=>[...s[12]||(s[12]=[f(" Назад ",-1)])]),_:1}),t(S,{type:"info",onClick:s[1]||(s[1]=r=>D.value=!0)},{default:e(()=>[t($,null,{default:e(()=>[t(_(zt))]),_:1}),s[13]||(s[13]=f(" Метрики ",-1))]),_:1}),t(S,{type:"primary",onClick:s[2]||(s[2]=r=>L.value=!0)},{default:e(()=>[t($,null,{default:e(()=>[t(_(Lt))]),_:1}),s[14]||(s[14]=f(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(mt,{column:U.value?1:2,border:""},{default:e(()=>[t(ie,{label:"ФИО"},{default:e(()=>[f(y(G.value.full_name),1)]),_:1}),t(ie,{label:"Дата рождения"},{default:e(()=>[f(y(G.value.birth_date||"Не указана"),1)]),_:1}),t(ie,{label:"Внешний ID"},{default:e(()=>[f(y(G.value.external_id||"Не указан"),1)]),_:1}),t(ie,{label:"Дата создания"},{default:e(()=>[f(y(oe(G.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):V("",!0),t(Ce,{class:"section-card"},{header:e(()=>[d("div",La,[s[16]||(s[16]=d("h3",null,"Отчёты",-1)),t(S,{type:"primary",onClick:s[3]||(s[3]=r=>w.value=!0)},{default:e(()=>[t($,null,{default:e(()=>[t(_(Ye))]),_:1}),s[15]||(s[15]=f(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(Ea,{reports:B.value,loading:N.value,onView:ke,onEdit:ke,onExtract:Ie,onDownload:Ve,onDelete:it,onUpload:s[4]||(s[4]=r=>w.value=!0)},null,8,["reports","loading"])]),_:1}),q.value.length>0?(l(),m(Ce,{key:1,class:"section-card"},{header:e(()=>[...s[17]||(s[17]=[d("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(yt,null,{default:e(()=>[(l(!0),C(Z,null,Y(q.value,r=>(l(),m(gt,{key:r.id,timestamp:oe(r.created_at),placement:"top"},{default:e(()=>[t(Ce,null,{default:e(()=>[d("h4",null,y(r.prof_activity_name),1),d("div",Ta,[d("div",Ua,[d("span",Pa,y(r.score_pct)+"%",1),t(ft,{percentage:r.score_pct,status:pe(r.score_pct)},null,8,["percentage","status"])]),d("div",Oa,[d("div",Ba,[s[18]||(s[18]=d("h5",null,"Сильные стороны:",-1)),r.strengths&&r.strengths.length?(l(),C("ul",qa,[(l(!0),C(Z,null,Y(r.strengths,(ee,Le)=>(l(),C("li",{key:Le},[d("strong",null,y(ee.metric_name),1),f(" — "+y(_(fe)(ee.value))+" (вес "+y(_(fe)(ee.weight,2))+") ",1)]))),128))])):(l(),m(Ne,{key:1,description:"Нет данных","image-size":60}))]),d("div",Xa,[s[19]||(s[19]=d("h5",null,"Зоны развития:",-1)),r.dev_areas&&r.dev_areas.length?(l(),C("ul",Ga,[(l(!0),C(Z,null,Y(r.dev_areas,(ee,Le)=>(l(),C("li",{key:Le},[d("strong",null,y(ee.metric_name),1),f(" — "+y(_(fe)(ee.value))+" (вес "+y(_(fe)(ee.weight,2))+") ",1)]))),128))])):(l(),m(Ne,{key:1,description:"Нет данных","image-size":60}))]),d("div",ja,[d("h5",null,[s[20]||(s[20]=f(" Рекомендации: ",-1)),r.recommendations_status?(l(),m(_t,{key:0,type:ne(r.recommendations_status),size:"small",class:"recommendation-status-tag"},{default:e(()=>[f(y(re(r.recommendations_status)),1)]),_:2},1032,["type"])):V("",!0)]),r.recommendations_status==="pending"?(l(),m(ue,{key:0,type:"info",closable:!1,"show-icon":""},{title:e(()=>[d("div",Ja,[t($,{class:"is-loading"},{default:e(()=>[t(_(lt))]),_:1}),s[21]||(s[21]=d("span",null,"Рекомендации формируются...",-1))])]),default:e(()=>[...s[22]||(s[22]=[f(" Кнопка «Скачать PDF» станет доступна после завершения генерации. ",-1)])]),_:1})):r.recommendations_status==="ready"?(l(),m(ue,{key:1,title:"Рекомендации готовы",type:"success",closable:!1,"show-icon":""},{default:e(()=>[...s[23]||(s[23]=[f(" Персональные рекомендации доступны в итоговом PDF-отчёте. ",-1)])]),_:1})):r.recommendations_status==="error"?(l(),m(ue,{key:2,title:pt(r),type:"error",closable:!1,"show-icon":""},{default:e(()=>[...s[24]||(s[24]=[f(" Не удалось сформировать рекомендации. Попробуйте пересчитать пригодность. ",-1)])]),_:1},8,["title"])):r.recommendations_status==="disabled"?(l(),m(ue,{key:3,title:"Генерация рекомендаций отключена",type:"warning",closable:!1,"show-icon":""},{default:e(()=>[...s[25]||(s[25]=[f(" Генерация рекомендаций отключена для данного окружения. ",-1)])]),_:1})):(l(),m(Ne,{key:4,description:"Статус рекомендаций неизвестен","image-size":60}))])]),r.prof_activity_code?(l(),C("div",Wa,[t(vt,{disabled:We(r),content:ct(r),placement:"top"},{default:e(()=>[d("span",null,[t(S,{type:"primary",size:"small",disabled:!We(r),loading:r.recommendations_status==="pending",onClick:ee=>dt(r)},{default:e(()=>[r.recommendations_status!=="pending"?(l(),m($,{key:0},{default:e(()=>[t(_(qe))]),_:1})):V("",!0),f(" "+y(r.recommendations_status==="pending"?"Формируется...":"Скачать PDF"),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},1032,["disabled","content"])])):V("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):V("",!0),t(ze,{modelValue:w.value,"onUpdate:modelValue":s[6]||(s[6]=r=>w.value=r),title:"Загрузить отчёты",width:U.value?"95%":"600px",onClose:be},{footer:e(()=>[t(S,{onClick:s[5]||(s[5]=r=>w.value=!1)},{default:e(()=>[...s[28]||(s[28]=[f(" Отмена ",-1)])]),_:1}),t(S,{type:"primary",loading:R.value,disabled:!O.value.some(r=>r.status==="pending"),onClick:ae},{default:e(()=>[f(" Загрузить все ("+y(O.value.filter(r=>r.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(wt,{ref_key:"uploadRef",ref:W,"auto-upload":!1,multiple:"",accept:".docx","on-change":xe,"show-file-list":!1,drag:""},{tip:e(()=>[...s[26]||(s[26]=[d("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t($,{class:"el-icon--upload"},{default:e(()=>[t(_(Ye))]),_:1}),s[27]||(s[27]=d("div",{class:"el-upload__text"},[f(" Перетащите файлы сюда или "),d("em",null,"нажмите для выбора")],-1))]),_:1},512),O.value.length?(l(),C("div",Ha,[d("div",Ka," Выбрано файлов: "+y(O.value.length)+"/"+y(Ue),1),(l(!0),C(Z,null,Y(O.value,r=>(l(),C("div",{key:r.id,class:Ge(["batch-file-item","batch-file-item--"+r.status])},[r.status==="pending"?(l(),m($,{key:0,class:"batch-file-icon"},{default:e(()=>[t(_(Be))]),_:1})):r.status==="uploading"?(l(),m($,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(_(Re))]),_:1})):r.status==="success"?(l(),m($,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(_(Pe))]),_:1})):r.status==="error"?(l(),m($,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(_(Oe))]),_:1})):V("",!0),d("div",Za,[d("span",Qa,y(r.name),1),d("span",Ya,y(ye(r.size)),1),r.error?(l(),C("span",es,y(r.error),1)):V("",!0)]),r.status==="pending"||r.status==="error"?(l(),m(S,{key:4,type:"danger",icon:_(Xe),circle:"",size:"small",onClick:ee=>Me(r.id)},null,8,["icon","onClick"])):V("",!0)],2))),128))])):V("",!0)]),_:1},8,["modelValue","width"]),t(ze,{modelValue:L.value,"onUpdate:modelValue":s[9]||(s[9]=r=>L.value=r),title:"Рассчитать профессиональную пригодность",width:U.value?"95%":"500px"},{footer:e(()=>[t(S,{onClick:s[8]||(s[8]=r=>L.value=!1)},{default:e(()=>[...s[29]||(s[29]=[f(" Отмена ",-1)])]),_:1}),t(S,{type:"primary",loading:P.value,disabled:!K.activityCode||B.value.length===0,onClick:ut},{default:e(()=>[...s[30]||(s[30]=[f(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(Ct,{model:K,"label-position":"top"},{default:e(()=>[t(kt,{label:"Профессиональная область",required:""},{default:e(()=>[ve((l(),m(ht,{modelValue:K.activityCode,"onUpdate:modelValue":s[7]||(s[7]=r=>K.activityCode=r),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(l(!0),C(Z,null,Y(b.value,r=>(l(),m(bt,{key:r.code,label:r.name,value:r.code},{default:e(()=>[d("span",null,y(r.name),1),d("span",ts,y(r.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[He,I.value]])]),_:1}),t(ue,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),B.value.length===0?(l(),m(ue,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):V("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(ze,{modelValue:h.value,"onUpdate:modelValue":s[10]||(s[10]=r=>h.value=r),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:e(()=>[j.value?(l(),m(da,{key:0,"report-id":j.value,onMetricsUpdated:rt},null,8,["report-id"])):V("",!0)]),_:1},8,["modelValue"]),t(Aa,{modelValue:D.value,"onUpdate:modelValue":s[11]||(s[11]=r=>D.value=r),"participant-id":G.value?.id,"participant-name":G.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[He,T.value]])]),_:1})}}},is=ge(as,[["__scopeId","data-v-02ebd03f"]]);export{is as default};
