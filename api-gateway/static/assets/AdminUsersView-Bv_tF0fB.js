import{A as V}from"./AppLayout-3OTT55om.js";import{N as w,a2 as M,m as k,D as U,l as P,O as B,H as L,E as p,v as m,w as n,r as g,I as R,o as f,a as _,d as i,J as S,B as y,u as h,f as v,x as T}from"./index-BZvuQCMi.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={async getPendingUsers(){return(await w.get("/admin/pending-users")).data},async getAllUsers(){return(await w.get("/admin/users")).data},async approveUser(l){return(await w.post(`/admin/approve/${l}`)).data},async makeAdmin(l){return(await w.post(`/admin/make-admin/${l}`)).data},async deleteUser(l){return(await w.delete(`/admin/users/${l}`)).data}},H=M("admin",()=>{const l=k([]),r=k([]),d=k(!1),o=k(null);async function b(){d.value=!0,o.value=null;try{const a=await A.getPendingUsers();return l.value=a,a}catch(a){const t=U(a,"Ошибка загрузки пользователей");throw o.value=t.message,a.normalizedError=t,a}finally{d.value=!1}}async function z(){d.value=!0,o.value=null;try{const a=await A.getAllUsers();return r.value=a,a}catch(a){const t=U(a,"Ошибка загрузки списка пользователей");throw o.value=t.message,a.normalizedError=t,a}finally{d.value=!1}}async function D(a){d.value=!0,o.value=null;try{const t=await A.approveUser(a);return l.value=l.value.filter(e=>e.id!==a),r.value=r.value.map(e=>e.id===a?t:e),t}catch(t){const e=U(t,"Ошибка одобрения пользователя");throw o.value=e.message,t.normalizedError=e,t}finally{d.value=!1}}async function c(a){d.value=!0,o.value=null;try{const t=await A.makeAdmin(a);return r.value=r.value.map(e=>e.id===a?t:e),t}catch(t){const e=U(t,"Ошибка назначения прав администратора");throw o.value=e.message,t.normalizedError=e,t}finally{d.value=!1}}async function u(a){d.value=!0,o.value=null;try{const t=await A.deleteUser(a);return r.value=r.value.filter(e=>e.id!==a),l.value=l.value.filter(e=>e.id!==a),t}catch(t){const e=U(t,"Ошибка удаления пользователя");throw o.value=e.message,t.normalizedError=e,t}finally{d.value=!1}}return{pendingUsers:l,users:r,loading:d,error:o,fetchPendingUsers:b,fetchAllUsers:z,approveUser:D,makeAdmin:c,deleteUser:u}}),I={class:"admin-users-view"},J={class:"actions-group"},O={class:"actions-group"},j={__name:"AdminUsersView",setup(l){const r=H(),d=P(),o=B(()=>r.users),b=async c=>{try{await r.approveUser(c.id),p.success(`Пользователь ${c.email} одобрен`)}catch{p.error(r.error||"Ошибка одобрения пользователя")}},z=async c=>{try{await r.makeAdmin(c.id),p.success(`Пользователь ${c.email} назначен администратором`)}catch{p.error(r.error||"Ошибка назначения прав администратора")}},D=async c=>{if(c.id===d.user?.id){p.error("Нельзя удалить собственную учётную запись администратора");return}try{await r.deleteUser(c.id),p.success(`Пользователь ${c.email} удалён`)}catch{p.error(r.error||"Ошибка удаления пользователя")}};return L(async()=>{try{await r.fetchPendingUsers(),await r.fetchAllUsers()}catch{p.error(r.error||"Ошибка загрузки пользователей")}}),(c,u)=>{const a=g("el-card"),t=g("el-empty"),e=g("el-table-column"),E=g("el-tag"),C=g("el-button"),N=g("el-table"),$=R("loading");return f(),m(V,null,{default:n(()=>[_("div",I,[i(a,{class:"header-card"},{default:n(()=>[...u[0]||(u[0]=[_("h1",null,"Управление пользователями",-1),_("p",null,"Одобрение новых пользователей, назначение админов и удаление учётных записей",-1)])]),_:1}),S((f(),m(a,{class:"users-card"},{default:n(()=>[_("h3",null,"Ожидают одобрения ("+y(h(r).pendingUsers.length)+")",1),h(r).pendingUsers.length===0?(f(),m(t,{key:0,description:"Нет пользователей, ожидающих одобрения"})):(f(),m(N,{key:1,data:h(r).pendingUsers,stripe:""},{default:n(()=>[i(e,{prop:"email",label:"Email","min-width":"250"}),i(e,{label:"Статус",width:"120"},{default:n(({row:s})=>[i(E,{type:"warning"},{default:n(()=>[v(y(s.status),1)]),_:2},1024)]),_:1}),i(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:n(({row:s})=>[v(y(new Date(s.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),i(e,{label:"Действия",width:"150",fixed:"right"},{default:n(({row:s})=>[_("div",J,[i(C,{type:"success",size:"small",onClick:x=>b(s)},{default:n(()=>[...u[1]||(u[1]=[v(" Одобрить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[$,h(r).loading]]),S((f(),m(a,{class:"users-card"},{default:n(()=>[_("h3",null,"Все пользователи ("+y(o.value.length)+")",1),o.value.length===0?(f(),m(t,{key:0,description:"Пользователи не найдены"})):(f(),m(N,{key:1,data:o.value,stripe:""},{default:n(()=>[i(e,{prop:"email",label:"Email","min-width":"250"}),i(e,{label:"Роль",width:"120"},{default:n(({row:s})=>[i(E,{type:s.role==="ADMIN"?"danger":"info"},{default:n(()=>[v(y(s.role),1)]),_:2},1032,["type"])]),_:1}),i(e,{label:"Статус",width:"140"},{default:n(({row:s})=>[i(E,{type:s.status==="ACTIVE"?"success":s.status==="PENDING"?"warning":"info"},{default:n(()=>[v(y(s.status),1)]),_:2},1032,["type"])]),_:1}),i(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:n(({row:s})=>[v(y(new Date(s.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),i(e,{label:"Действия",width:"220",fixed:"right"},{default:n(({row:s})=>[_("div",O,[s.role!=="ADMIN"?(f(),m(C,{key:0,type:"warning",size:"small",onClick:x=>z(s)},{default:n(()=>[...u[2]||(u[2]=[v(" Сделать админом ",-1)])]),_:1},8,["onClick"])):T("",!0),i(C,{type:"danger",size:"small",disabled:s.id===h(d).user?.id,onClick:x=>D(s)},{default:n(()=>[...u[3]||(u[3]=[v(" Удалить ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[$,h(r).loading]])])]),_:1})}}},Q=G(j,[["__scopeId","data-v-0d1ab0ef"]]);export{Q as default};
