import{P as Z,m as g,Q as ee,p as oe,r as c,c as $,o as l,d as t,x,R as Rt,w as e,u as v,S as Et,L as St,z as Qe,B as y,F as ae,H as Ye,I as et,v as m,f as _,a as u,C as se,T as we,U as Dt,V as xt,W as Mt,X as Vt,M as ut,Y as It,Z as tt,E as F,q as dt,e as ct,J as at,K as he,_ as At,k as Je,$ as We,g as He,a0 as Ft,a1 as lt,a2 as nt,h as ot,a3 as Ke,a4 as Ze,O as Nt,n as Tt,a5 as zt,t as Lt,a6 as rt,G as Pt}from"./index-DXJmNgco.js";import{A as Ut}from"./AppLayout-_jCXN-zl.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Ot,m as ye,g as Bt,p as Xt}from"./metricNames-Bdt_f5ZX.js";import{p as pt,u as Gt}from"./participants-H6HYytwB.js";const ve={async upload(i,k){const r=new FormData;return r.append("file",k),(await Z.post(`/participants/${i}/reports`,r,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(i){return await Z.get(`/reports/${i}/download`,{responseType:"blob"})},async getById(i){return(await Z.get(`/reports/${i}`)).data},async delete(i){return(await Z.delete(`/reports/${i}`)).data},async extract(i){return(await Z.post(`/reports/${i}/extract`)).data},async getMetrics(i){return(await Z.get(`/reports/${i}/metrics`)).data},async getList(i){return(await Z.get(`/participants/${i}/reports`)).data},async getReportImages(i){return(await Z.get(`/reports/${i}/images`)).data}},qe={async calculate(i,k){return(await Z.post(`/scoring/participants/${i}/calculate`,null,{params:{activity_code:k}})).data},async getHistory(i,k=10){return(await Z.get(`/scoring/participants/${i}/scores`,{params:{limit:k}})).data},async getById(i){return(await Z.get(`/scoring-results/${i}`)).data},async generateRecommendations(i){return(await Z.post(`/reports/${i}/recommendations`)).data},async getFinalReport(i,k,r="json"){const R={params:{activity_code:k,format:r}};r==="html"&&(R.responseType="text");const L=await Z.get(`/participants/${i}/final-report`,R);return L.data},async downloadFinalReportPdf(i,k,r=null){const R={activity_code:k,format:"pdf"};return r&&(R.scoring_result_id=r),await Z.get(`/participants/${i}/final-report`,{params:R,responseType:"blob"})}};function Ie(i,k=1){if(i==null||i==="")return"";const r=typeof i=="string"?parseFloat(i):i;return isNaN(r)?"":r.toLocaleString("ru-RU",{minimumFractionDigits:k,maximumFractionDigits:k})}function fe(i){if(i==null||i==="")return null;const r=String(i).trim().replace(",","."),R=parseFloat(r);return isNaN(R)?null:R}function qt(i){return fe(i)}function ge(i,k=1){return Ie(i,k)}const jt={key:0,class:"error-message"},Jt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(i,{emit:k}){const r=i,R=k,L=g(null),N=g(""),U=g(!1),M=g(!1),V=g(""),I=ee(()=>fe(N.value)),P=ee(()=>{const d=I.value;return d===null||d<=r.min}),T=ee(()=>{const d=I.value;return d===null||d>=r.max}),G=d=>{if(d==null||d===""){N.value="";return}U.value?N.value=String(d).replace(".",","):N.value=Ie(d,r.precision)},J=d=>{if(d==null||d==="")return M.value=!1,V.value="",!0;const n=fe(d);return n===null?(M.value=!0,V.value="Некорректное число",!1):n<r.min?(M.value=!0,V.value=`Значение должно быть не меньше ${Ie(r.min,r.precision)}`,!1):n>r.max?(M.value=!0,V.value=`Значение должно быть не больше ${Ie(r.max,r.precision)}`,!1):(M.value=!1,V.value="",!0)},h=d=>{const n=d.replace(/[^\d,.-]/g,"");let C=!1;const X=n.split("").filter(S=>S===","||S==="."?C?!1:(C=!0,!0):!0).join("").replace(".",",");N.value=X;const b=fe(X);b!==null?R("update:modelValue",b):(X===""||X==="-")&&R("update:modelValue",null)},q=()=>{U.value=!1;const d=fe(N.value);if(J(N.value)){if(d!==null){const n=Math.round(d*Math.pow(10,r.precision))/Math.pow(10,r.precision),C=Math.max(r.min,Math.min(r.max,n));R("update:modelValue",C),G(C),R("change",C)}}else if(d!==null&&(d<r.min||d>r.max)){const n=Math.max(r.min,Math.min(r.max,d));R("update:modelValue",n),G(n),R("change",n),M.value=!1,V.value=""}R("blur")},z=()=>{U.value=!0,I.value!==null&&(N.value=String(I.value).replace(".",","))},j=()=>{const d=I.value||0,n=Math.min(r.max,d+r.step),C=Math.round(n*Math.pow(10,r.precision))/Math.pow(10,r.precision);R("update:modelValue",C),R("change",C),G(C)},O=()=>{const d=I.value||0,n=Math.max(r.min,d-r.step),C=Math.round(n*Math.pow(10,r.precision))/Math.pow(10,r.precision);R("update:modelValue",C),R("change",C),G(C)};return oe(()=>r.modelValue,d=>{G(d)},{immediate:!0}),G(r.modelValue),(d,n)=>{const C=c("el-button"),X=c("el-button-group"),b=c("el-input");return l(),$(ae,null,[t(b,{ref_key:"inputRef",ref:L,modelValue:N.value,"onUpdate:modelValue":n[0]||(n[0]=S=>N.value=S),placeholder:i.placeholder,disabled:i.disabled,class:Qe({"is-invalid":M.value}),onInput:h,onBlur:q,onFocus:z},Rt({_:2},[i.showControls?{name:"append",fn:e(()=>[t(X,null,{default:e(()=>[t(C,{icon:v(Et),disabled:i.disabled||P.value,onClick:O},null,8,["icon","disabled"]),t(C,{icon:v(St),disabled:i.disabled||T.value,onClick:j},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),M.value?(l(),$("div",jt,y(V.value),1)):x("",!0)],64)}}},Wt=be(Jt,[["__scopeId","data-v-74ef628d"]]),Ht={class:"card-header"},Kt={class:"card-header-left"},Zt={class:"card-header-actions"},Qt={class:"metrics-filter"},Yt={class:"metrics-count"},ea={key:0,class:"metric-description"},ta={key:0,class:"metrics-info"},aa={class:"info-row"},sa={key:0,class:"info-row"},la={key:0,class:"loading-container"},na={key:1,class:"no-images"},oa={key:2,class:"images-container"},ra={class:"image-controls"},ia={class:"image-slide"},ua=["src","alt"],da={class:"image-info"},ca={class:"image-filename"},pa={key:0,class:"image-page"},ma={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null}},emits:["metrics-updated"],setup(i,{emit:k}){const r=i,R=k,L=g(!1),N=g(!1),U=g(!1),M=g(null),V=g(!1),I=g([]),P=g([]),T=g({metrics:{}}),G=g({}),J=g("metrics"),h=g([]),q=g(!1),z=g(1),j=g(!1),O=g(null),d=g(500),n=g(null),C=ee(()=>{if(!I.value||I.value.length===0)return[];if(V.value)return I.value;const w=new Set(P.value.filter(p=>{const B=parseFloat(String(p.value).replace(",","."));return!isNaN(B)&&B>0}).map(p=>p.metric_def_id));return I.value.filter(p=>{const B=w.has(p.id),Q=T.value.metrics[p.id],Y=Q!=null&&Q!==""&&parseFloat(String(Q).replace(",","."))>0;return B||Y})}),X=ee(()=>!P.value||P.value.length===0?[]:[...new Set(P.value.map(w=>w.source))]),b=ee(()=>!P.value||P.value.length===0?null:new Date),S=async()=>{try{const w=await ye.listMetricDefs(!0);I.value=w.items||[]}catch(w){console.error("Failed to load metric definitions:",w),M.value="Не удалось загрузить определения метрик"}},H=async()=>{L.value=!0,M.value=null;try{const w=await ye.listExtractedMetrics(r.reportId);P.value=w.items||[],T.value.metrics={},P.value.forEach(p=>{T.value.metrics[p.metric_def_id]=fe(p.value)}),G.value=JSON.parse(JSON.stringify(T.value.metrics))}catch(w){console.error("Failed to load metrics:",w),M.value="Не удалось загрузить метрики"}finally{L.value=!1}},K=async()=>{await H(),F.success("Метрики обновлены")},le=()=>{n.value||(n.value=setInterval(async()=>{await H()},5e3))},W=()=>{n.value&&(clearInterval(n.value),n.value=null)},_e=()=>{U.value=!0,V.value=!0,G.value=JSON.parse(JSON.stringify(T.value.metrics))},te=()=>{T.value.metrics=JSON.parse(JSON.stringify(G.value)),U.value=!1,M.value=null},ue=async()=>{N.value=!0,M.value=null;try{const w=[];for(const[p,B]of Object.entries(T.value.metrics))if(B!=null&&B!==""){const Q=qt(B);Q!==null&&w.push({metric_def_id:p,value:Q,source:"MANUAL",notes:null})}if(w.length===0){F.warning("Не введено ни одного значения метрики"),N.value=!1;return}await ye.bulkCreateExtractedMetrics(r.reportId,w),F.success(`Успешно сохранено ${w.length} метрик`),U.value=!1,await H(),R("metrics-updated")}catch(w){console.error("Failed to save metrics:",w);let p="Не удалось сохранить метрики";w.response?.data?.detail&&(typeof w.response.data.detail=="string"?p=w.response.data.detail:Array.isArray(w.response.data.detail)&&(p=w.response.data.detail.map(B=>B.msg||B.message).join(", "))),M.value=p,F.error(p)}finally{N.value=!1}},de=w=>{switch(w){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},ce=w=>{switch(w){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return w}},f=w=>new Date(w).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=async()=>{q.value=!0,M.value=null;try{h.value=await ve.getReportImages(r.reportId)}catch(w){console.error("Failed to load report images:",w),M.value="Не удалось загрузить изображения отчёта",F.error("Не удалось загрузить изображения отчёта")}finally{q.value=!1}},ie=()=>{z.value<2&&(z.value=Math.min(2,z.value+.25))},ke=()=>{z.value>.5&&(z.value=Math.max(.5,z.value-.25))},Ce=()=>{z.value=1},$e=()=>{j.value=!j.value,j.value?d.value=window.innerHeight-100:d.value=500};return Ye(async()=>{await S()}),et(()=>{W()}),oe(()=>r.reportId,async w=>{w&&(await H(),h.value=[])}),oe(()=>r.reportStatus,async(w,p)=>{p||await H(),w==="PROCESSING"?(le(),p&&p!=="PROCESSING"&&await H()):(W(),w==="EXTRACTED"&&p&&p!=="EXTRACTED"&&await H())},{immediate:!0}),oe(J,async w=>{w==="images"&&h.value.length===0&&!q.value&&await re()}),(w,p)=>{const B=c("el-icon"),Q=c("el-tag"),Y=c("el-button"),Re=c("el-alert"),Ae=c("el-switch"),Ee=c("el-form-item"),Fe=c("el-col"),Ne=c("el-row"),Te=c("el-form"),Se=c("el-divider"),De=c("el-tab-pane"),xe=c("el-empty"),Me=c("el-button-group"),ze=c("el-carousel-item"),Le=c("el-carousel"),Pe=c("el-tabs"),Ue=c("el-card");return l(),m(Ue,{class:"metrics-editor"},{header:e(()=>[u("div",Ht,[u("div",Kt,[p[5]||(p[5]=u("span",null,"Метрики отчёта",-1)),i.reportStatus==="PROCESSING"?(l(),m(Q,{key:0,type:"warning",size:"small",class:"status-tag"},{default:e(()=>[t(B,{class:"is-loading"},{default:e(()=>[t(v(we))]),_:1}),p[3]||(p[3]=_(" Извлечение... ",-1))]),_:1})):i.reportStatus==="EXTRACTED"?(l(),m(Q,{key:1,type:"success",size:"small",class:"status-tag"},{default:e(()=>[...p[4]||(p[4]=[_(" Извлечено ",-1)])]),_:1})):x("",!0)]),u("div",Zt,[U.value?x("",!0):(l(),m(Y,{key:0,size:"small",loading:L.value,onClick:K},{default:e(()=>[t(B,null,{default:e(()=>[t(v(tt))]),_:1}),p[6]||(p[6]=_(" Обновить ",-1))]),_:1},8,["loading"])),U.value?(l(),$(ae,{key:2},[t(Y,{size:"small",onClick:te},{default:e(()=>[...p[8]||(p[8]=[_(" Отмена ",-1)])]),_:1}),t(Y,{type:"primary",size:"small",loading:N.value,onClick:ue},{default:e(()=>[...p[9]||(p[9]=[_(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(l(),m(Y,{key:1,type:"primary",size:"small",onClick:_e},{default:e(()=>[...p[7]||(p[7]=[_(" Редактировать ",-1)])]),_:1}))])])]),default:e(()=>[M.value?(l(),m(Re,{key:0,type:"error",title:M.value,closable:"",style:{"margin-bottom":"16px"},onClose:p[0]||(p[0]=A=>M.value=null)},null,8,["title"])):x("",!0),!P.value||P.value.length===0?(l(),m(Re,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...p[10]||(p[10]=[_(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):x("",!0),t(Pe,{modelValue:J.value,"onUpdate:modelValue":p[2]||(p[2]=A=>J.value=A),type:"card"},{default:e(()=>[t(De,{label:"Метрики",name:"metrics"},{default:e(()=>[u("div",Qt,[t(Ae,{modelValue:V.value,"onUpdate:modelValue":p[1]||(p[1]=A=>V.value=A),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),u("span",Yt," Показано: "+y(C.value.length)+" из "+y(I.value.length),1)]),t(Te,{ref:"formRef",model:T.value,"label-position":"top",disabled:!U.value},{default:e(()=>[t(Ne,{gutter:20},{default:e(()=>[(l(!0),$(ae,null,se(C.value,A=>(l(),m(Fe,{key:A.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(Ee,{label:v(Ot)(A),prop:`metrics.${A.id}`},{default:e(()=>[t(Wt,{modelValue:T.value.metrics[A.id],"onUpdate:modelValue":Oe=>T.value.metrics[A.id]=Oe,min:A.min_value||1,max:A.max_value||10,precision:1,step:.1,disabled:!U.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),A.description?(l(),$("div",ea,y(A.description),1)):x("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),P.value&&P.value.length>0?(l(),$("div",ta,[t(Se),u("div",aa,[p[11]||(p[11]=u("span",{class:"info-label"},"Источник данных:",-1)),(l(!0),$(ae,null,se(X.value,A=>(l(),m(Q,{key:A,type:de(A),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[_(y(ce(A)),1)]),_:2},1032,["type"]))),128))]),b.value?(l(),$("div",sa,[p[12]||(p[12]=u("span",{class:"info-label"},"Последнее обновление:",-1)),u("span",null,y(f(b.value)),1)])):x("",!0)])):x("",!0)]),_:1}),t(De,{label:"Изображения отчёта",name:"images"},{default:e(()=>[q.value?(l(),$("div",la,[t(B,{class:"is-loading"},{default:e(()=>[t(v(we))]),_:1}),p[13]||(p[13]=u("span",{style:{"margin-left":"8px"}},"Загрузка изображений...",-1))])):h.value.length===0?(l(),$("div",na,[t(xe,{description:"Изображения отсутствуют"},{image:e(()=>[t(B,{size:60,color:"var(--el-color-info)"},{default:e(()=>[t(v(Dt))]),_:1})]),_:1})])):(l(),$("div",oa,[u("div",ra,[t(Me,null,{default:e(()=>[t(Y,{disabled:z.value<=.5,onClick:ke},{default:e(()=>[t(B,null,{default:e(()=>[t(v(xt))]),_:1})]),_:1},8,["disabled"]),t(Y,{onClick:Ce},{default:e(()=>[_(y(Math.round(z.value*100))+"% ",1)]),_:1}),t(Y,{disabled:z.value>=2,onClick:ie},{default:e(()=>[t(B,null,{default:e(()=>[t(v(Mt))]),_:1})]),_:1},8,["disabled"])]),_:1}),t(Y,{style:{"margin-left":"12px"},onClick:$e},{default:e(()=>[t(B,null,{default:e(()=>[t(v(Vt))]),_:1}),p[14]||(p[14]=_(" Полноэкранный режим ",-1))]),_:1})]),u("div",{ref_key:"carouselContainer",ref:O,class:Qe(["carousel-wrapper",{fullscreen:j.value}])},[t(Le,{height:d.value+"px",arrow:"always","indicator-position":"outside"},{default:e(()=>[(l(!0),$(ae,null,se(h.value,A=>(l(),m(ze,{key:A.id},{default:e(()=>[u("div",ia,[u("div",{class:"image-wrapper",style:ut({transform:`scale(${z.value})`})},[u("img",{src:A.data_url,alt:A.filename,class:"report-image"},null,8,ua)],4),u("div",da,[u("span",ca,y(A.filename),1),A.page_number?(l(),$("span",pa," Страница "+y(A.page_number),1)):x("",!0)])])]),_:2},1024))),128))]),_:1},8,["height"]),j.value?(l(),m(Y,{key:0,class:"exit-fullscreen",circle:"",onClick:$e},{default:e(()=>[t(B,null,{default:e(()=>[t(v(It))]),_:1})]),_:1})):x("",!0)],2)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},fa=be(ma,[["__scopeId","data-v-de7f8fbf"]]),_a={class:"report-list"},va={class:"report-list__controls"},ga={class:"controls-left"},ya={class:"controls-right"},wa={class:"filename"},ha={class:"status-cell"},ba={key:1,class:"report-list__cards"},ka={class:"report-card__header"},Ca={class:"report-card__status"},$a={class:"report-card__body"},Ra={class:"report-card__field"},Ea={class:"field-value field-value--filename"},Sa={class:"report-card__field"},Da={class:"field-value"},xa={class:"report-card__actions"},Ma={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(i,{emit:k}){const r=i,R=k,L=dt(),N=ct(),U=g(window.innerWidth<=768),M=()=>{U.value=window.innerWidth<=768};Ye(()=>{window.addEventListener("resize",M),L.query.status&&(V.value=L.query.status),L.query.sort&&(I.value=L.query.sort)}),et(()=>{window.removeEventListener("resize",M)});const V=g(""),I=g("desc"),P=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];oe([V,I],([d,n])=>{const C={...L.query};d?C.status=d:delete C.status,n?C.sort=n:delete C.sort,N.replace({query:C})});const T=()=>{},G=()=>{I.value=I.value==="desc"?"asc":"desc"},J=ee(()=>{let d=[...r.reports];return V.value&&(d=d.filter(n=>n.status===V.value)),d.sort((n,C)=>{const X=new Date(n.uploaded_at),b=new Date(C.uploaded_at);return I.value==="desc"?b-X:X-b}),d}),h=ee(()=>V.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),q=d=>{if(!d)return"—";const n=new Date(d);return Number.isNaN(n.getTime())?"—":n.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},z=d=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[d]||d,j=d=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[d]||"info",O=async({action:d,report:n})=>{switch(d){case"view":R("view",n.id);break;case"edit":R("edit",n.id);break;case"extract":R("extract",n.id);break;case"download":R("download",n.id);break;case"delete":try{await Nt.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),R("delete",n.id)}catch{}break}};return(d,n)=>{const C=c("el-option"),X=c("el-select"),b=c("el-icon"),S=c("el-button"),H=c("el-table-column"),K=c("el-tag"),le=c("el-dropdown-item"),W=c("el-dropdown-menu"),_e=c("el-dropdown"),te=c("el-table"),ue=c("el-card"),de=c("el-empty"),ce=at("loading");return l(),$("div",_a,[u("div",va,[u("div",ga,[t(X,{modelValue:V.value,"onUpdate:modelValue":n[0]||(n[0]=f=>V.value=f),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:T},{default:e(()=>[t(C,{label:"Все статусы",value:""}),(l(),$(ae,null,se(P,f=>t(C,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),u("div",ya,[t(S,{type:I.value==="desc"?"primary":"default",size:"small",onClick:G},{default:e(()=>[t(b,null,{default:e(()=>[t(v(At))]),_:1}),_(" "+y(I.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),U.value?he((l(),$("div",ba,[(l(!0),$(ae,null,se(J.value,f=>(l(),m(ue,{key:f.id,class:"report-card",shadow:"hover"},{header:e(()=>[u("div",ka,[u("div",Ca,[f.status==="PROCESSING"?(l(),m(b,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):f.status==="EXTRACTED"?(l(),m(b,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):f.status==="FAILED"?(l(),m(b,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(We))]),_:1})):(l(),m(b,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(He))]),_:1})),t(K,{type:j(f.status),size:"small"},{default:e(()=>[_(y(z(f.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[u("div",xa,[f.status==="EXTRACTED"?(l(),m(S,{key:0,type:"success",size:"small",onClick:re=>O({action:"edit",report:f})},{default:e(()=>[t(b,null,{default:e(()=>[t(v(lt))]),_:1}),n[10]||(n[10]=_(" Редактировать ",-1))]),_:1},8,["onClick"])):x("",!0),f.status==="PROCESSING"||f.status==="EXTRACTED"?(l(),m(S,{key:1,type:"info",size:"small",onClick:re=>O({action:"view",report:f})},{default:e(()=>[t(b,null,{default:e(()=>[t(v(nt))]),_:1}),n[11]||(n[11]=_(" Просмотр ",-1))]),_:1},8,["onClick"])):x("",!0),t(S,{type:"primary",size:"small",onClick:re=>O({action:"extract",report:f})},{default:e(()=>[t(b,null,{default:e(()=>[t(v(ot))]),_:1}),_(" "+y(f.status==="FAILED"?"Повторить":f.status==="PROCESSING"?"Перезапустить":f.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(S,{size:"small",onClick:re=>O({action:"download",report:f})},{default:e(()=>[t(b,null,{default:e(()=>[t(v(Ke))]),_:1}),n[12]||(n[12]=_(" Скачать ",-1))]),_:1},8,["onClick"]),t(S,{type:"danger",size:"small",onClick:re=>O({action:"delete",report:f})},{default:e(()=>[t(b,null,{default:e(()=>[t(v(Ze))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[u("div",$a,[u("div",Ra,[n[8]||(n[8]=u("span",{class:"field-label"},"Файл:",-1)),u("span",Ea,y(f.file_ref?.filename||"Без названия"),1)]),u("div",Sa,[n[9]||(n[9]=u("span",{class:"field-label"},"Дата загрузки:",-1)),u("span",Da,y(q(f.uploaded_at)),1)])])]),_:2},1024))),128)),!J.value.length&&!i.loading?(l(),m(de,{key:0,description:h.value,"image-size":120},{default:e(()=>[V.value?x("",!0):(l(),m(S,{key:0,type:"primary",onClick:n[1]||(n[1]=f=>d.$emit("upload"))},{default:e(()=>[...n[13]||(n[13]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):x("",!0)])),[[ce,i.loading]]):he((l(),m(te,{key:0,data:J.value,class:"report-list__table",stripe:"","empty-text":h.value},{default:e(()=>[t(H,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:f})=>[u("span",wa,y(f.file_ref?.filename||"Без названия"),1)]),_:1}),t(H,{prop:"status",label:"Статус",width:"200"},{default:e(({row:f})=>[u("div",ha,[f.status==="PROCESSING"?(l(),m(b,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):f.status==="EXTRACTED"?(l(),m(b,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):f.status==="FAILED"?(l(),m(b,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(We))]),_:1})):(l(),m(b,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(He))]),_:1})),t(K,{type:j(f.status),size:"default"},{default:e(()=>[_(y(z(f.status)),1)]),_:2},1032,["type"])])]),_:1}),t(H,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:f})=>[_(y(q(f.uploaded_at)),1)]),_:1}),t(H,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:f})=>[t(_e,{trigger:"click",onCommand:O},{dropdown:e(()=>[t(W,null,{default:e(()=>[f.status==="EXTRACTED"?(l(),m(le,{key:0,command:{action:"edit",report:f}},{default:e(()=>[t(b,null,{default:e(()=>[t(v(lt))]),_:1}),n[4]||(n[4]=_(" Редактировать метрики ",-1))]),_:1},8,["command"])):x("",!0),f.status==="PROCESSING"||f.status==="EXTRACTED"?(l(),m(le,{key:1,command:{action:"view",report:f}},{default:e(()=>[t(b,null,{default:e(()=>[t(v(nt))]),_:1}),n[5]||(n[5]=_(" Просмотр метрик ",-1))]),_:1},8,["command"])):x("",!0),t(le,{command:{action:"extract",report:f}},{default:e(()=>[t(b,null,{default:e(()=>[t(v(ot))]),_:1}),_(" "+y(f.status==="FAILED"?"Повторить извлечение":f.status==="PROCESSING"?"Перезапустить извлечение":f.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(le,{divided:"",command:{action:"download",report:f}},{default:e(()=>[t(b,null,{default:e(()=>[t(v(Ke))]),_:1}),n[6]||(n[6]=_(" Скачать ",-1))]),_:1},8,["command"]),t(le,{command:{action:"delete",report:f},class:"dropdown-item--danger"},{default:e(()=>[t(b,null,{default:e(()=>[t(v(Ze))]),_:1}),n[7]||(n[7]=_(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(S,{type:"primary",size:"small"},{default:e(()=>[n[3]||(n[3]=_(" Действия ",-1)),t(b,{class:"el-icon--right"},{default:e(()=>[t(v(Ft))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[ce,i.loading]]),!J.value.length&&!i.loading&&!U.value?(l(),m(de,{key:2,description:h.value,"image-size":120},{default:e(()=>[V.value?x("",!0):(l(),m(S,{key:0,type:"primary",onClick:n[2]||(n[2]=f=>d.$emit("upload"))},{default:e(()=>[...n[14]||(n[14]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):x("",!0)])}}},Va=be(Ma,[["__scopeId","data-v-0ed222e2"]]),Ia={class:"metrics-drawer"},Aa={class:"drawer-actions"},Fa={key:1},Na={key:1},Ta={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(i,{emit:k}){const r=i,R=k,L=g(!1),N=g([]),U=g([]),M=ee(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),V=h=>{R("update:modelValue",h)},I=async()=>{try{const h=await ye.listMetricDefs(!0);U.value=h.items||[]}catch(h){console.error("Error loading metric definitions:",h)}},P=async()=>{L.value=!0;try{const h=await pt.getMetrics(r.participantId);N.value=h.metrics||[]}catch(h){console.error("Error loading participant metrics:",h),F.error("Ошибка загрузки метрик участника")}finally{L.value=!1}},T=h=>{if(!h)return"—";const q=U.value.find(j=>j.code===h);return Bt(q,h,{warn:()=>{}})},G=h=>h>=.8?"var(--el-color-success)":h>=.6?"var(--el-color-warning)":"var(--el-color-danger)",J=h=>{if(!h)return"—";const q=new Date(h);return Number.isNaN(q.getTime())?"—":q.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return oe(()=>r.participantId,async h=>{h&&r.modelValue&&(await I(),await P())}),oe(()=>r.modelValue,async h=>{h&&r.participantId&&(await I(),await P())}),(h,q)=>{const z=c("el-icon"),j=c("el-button"),O=c("el-table-column"),d=c("el-tag"),n=c("el-table"),C=c("el-empty"),X=c("el-drawer"),b=at("loading");return l(),m(X,{"model-value":i.modelValue,title:`Метрики участника: ${i.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":V},{default:e(()=>[he((l(),$("div",Ia,[u("div",Aa,[t(j,{type:"primary",size:"small",onClick:P},{default:e(()=>[t(z,null,{default:e(()=>[t(v(tt))]),_:1}),q[0]||(q[0]=_(" Обновить ",-1))]),_:1})]),t(n,{data:N.value,stripe:"","empty-text":M.value},{default:e(()=>[t(O,{prop:"metric_code",label:"Код метрики",width:"200"}),t(O,{label:"Название метрики","min-width":"250"},{default:e(({row:S})=>[_(y(T(S.metric_code)),1)]),_:1}),t(O,{prop:"value",label:"Значение",width:"120"},{default:e(({row:S})=>[t(d,{type:"success"},{default:e(()=>[_(y(v(ge)(S.value)),1)]),_:2},1024)]),_:1}),t(O,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:S})=>[S.confidence!==null?(l(),$("span",{key:0,style:ut({color:G(S.confidence)})},y((S.confidence*100).toFixed(0))+"% ",5)):(l(),$("span",Fa,"—"))]),_:1}),t(O,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:S})=>[_(y(J(S.updated_at)),1)]),_:1}),t(O,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:S})=>[S.last_source_report_id?(l(),m(d,{key:0,size:"small"},{default:e(()=>[...q[1]||(q[1]=[_(" Из отчёта ",-1)])]),_:1})):(l(),$("span",Na,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!N.value.length&&!L.value?(l(),m(C,{key:0,description:M.value},null,8,["description"])):x("",!0)])),[[b,L.value]])]),_:1},8,["model-value","title"])}}},za=be(Ta,[["__scopeId","data-v-93720633"]]),La={class:"participant-detail"},Pa={class:"card-header"},Ua={class:"header-actions"},Oa={class:"section-header"},Ba={class:"scoring-result"},Xa={class:"score-value"},Ga={class:"score-number"},qa={class:"score-details"},ja={class:"score-section"},Ja={key:0},Wa={class:"score-section"},Ha={key:0},Ka={class:"score-section recommendations-status-section"},Za={class:"recommendations-pending-alert"},Qa={key:0,class:"final-report-actions"},Ya={key:0,class:"batch-files-list"},es={class:"batch-files-header"},ts={class:"batch-file-info"},as={class:"batch-file-name"},ss={class:"batch-file-size"},ls={key:0,class:"batch-file-error"},ns={class:"activity-code-hint"},it=20*1024*1024,je=10,os={__name:"ParticipantDetailView",setup(i){const k=ct(),r=dt(),R=Gt(),L=g(!1),N=g(!1),U=g(window.innerWidth<=768),M=()=>{U.value=window.innerWidth<=768},V=g(!1),I=g(!1),P=g(!1),T=ee(()=>R.currentParticipant),G=g([]),J=g([]),h=g([]),q=g([]),z=g(null),j=g(null),O=g(null),d=ee(()=>G.value.some(a=>a.status==="PROCESSING")),n=ee(()=>z.value&&G.value.find(s=>s.id===z.value)?.status||null),C=ee(()=>J.value.some(a=>a.recommendations_status==="pending")),X=g(!1),b=g(!1),S=g(!1),H=g(!1),K=g(null),le=g([]),W=g([]);let _e=0;const te=Tt({activityCode:""}),ue=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},de=a=>a>=80?"success":a>=60?"":"warning",ce=a=>({pending:"Формируются",ready:"Готовы",error:"Ошибка",disabled:"Отключены"})[a]||a,f=a=>({pending:"info",ready:"success",error:"danger",disabled:"warning"})[a]||"info",re=async()=>{L.value=!0;try{await R.getParticipant(r.params.id)}catch{F.error("Участник не найден"),k.push("/participants")}finally{L.value=!1}},ie=async({silent:a=!1}={})=>{a||(N.value=!0);try{const s=await pt.getReports(r.params.id);G.value=s.items||[]}catch(s){console.error("Error loading reports:",s),F.error("Ошибка загрузки списка отчётов")}finally{a||(N.value=!1)}},ke=a=>{if(!a)return a;const s=Array.isArray(a.recommendations)?a.recommendations:[];let D=a.recommendations_status||a.recommendationsStatus||null;D||(D=s.length>0?"ready":"pending");const E=Number(a.score_pct),pe=Number.isNaN(E)?a.score_pct:E;return{...a,score_pct:pe,recommendations:s,recommendations_status:D,recommendations_error:a.recommendations_error||a.recommendationsError||null}},Ce=async()=>{try{const a=await qe.getHistory(r.params.id),s=Array.isArray(a.items)?a.items:[];J.value=s.map(ke)}catch(a){console.error("Error loading scoring results:",a)}},$e=async()=>{V.value=!0;try{const a=await Xt.list();h.value=a||[]}catch{F.error("Ошибка загрузки профессиональных областей")}finally{V.value=!1}},w=async()=>{try{const a=await ye.listMetricDefs(!0);q.value=a.items||[]}catch(a){console.error("Error loading metric definitions:",a)}},p=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",B=a=>a.name.toLowerCase().endsWith(".docx")?a.size>it?`Размер файла превышает ${p(it)}`:null:"Только файлы формата .docx",Q=(a,s)=>{const D=a.raw;if(W.value.length>=je){F.warning(`Максимальное количество файлов: ${je}`),K.value&&K.value.clearFiles();return}const E=B(D);if(E){F.error(E),K.value&&K.value.clearFiles();return}W.value.push({id:++_e,file:D,name:D.name,size:D.size,status:"pending",progress:0,error:null,reportId:null}),K.value&&K.value.clearFiles()},Y=a=>{W.value=W.value.filter(s=>s.id!==a)},Re=async a=>{a.status="uploading",a.progress=0;try{const s=await ve.upload(r.params.id,a.file);a.status="success",a.reportId=s.id}catch(s){a.status="error",a.error=s.response?.data?.detail||"Ошибка загрузки"}},Ae=async()=>{const a=W.value.filter(s=>s.status==="pending");if(a.length===0){F.warning("Нет файлов для загрузки");return}I.value=!0;try{await Promise.allSettled(a.map(E=>Re(E)));const s=W.value.filter(E=>E.status==="success").length,D=W.value.filter(E=>E.status==="error").length;D===0?(F.success(`Загружено ${s} отчётов`),X.value=!1,Ee()):F.warning(`Загружено: ${s}, ошибок: ${D}`),await ie()}finally{I.value=!1}},Ee=()=>{W.value=[],le.value=[],K.value&&K.value.clearFiles()},Fe=async a=>{try{const s=await ve.download(a),D=window.URL.createObjectURL(new Blob([s.data])),E=document.createElement("a");E.href=D,E.setAttribute("download",`report_${a}.docx`),document.body.appendChild(E),E.click(),E.remove(),window.URL.revokeObjectURL(D),F.success("Отчёт скачан")}catch{F.error("Ошибка скачивания отчёта")}},Ne=async a=>{try{await ve.extract(a),F.success("Извлечение метрик запущено"),await ie()}catch{F.error("Ошибка запуска извлечения метрик")}},Te=()=>{j.value||(j.value=setInterval(async()=>{try{await ie({silent:!0})}catch(a){console.error("Auto-refresh error:",a)}},3e3))},Se=()=>{j.value&&(clearInterval(j.value),j.value=null)},De=()=>{O.value||(O.value=setInterval(async()=>{try{await Ce()}catch(a){console.error("Recommendations auto-refresh error:",a)}},15e3))},xe=()=>{O.value&&(clearInterval(O.value),O.value=null)};oe(d,a=>{a?Te():Se()}),oe(C,a=>{a?De():xe()});const Me=async a=>{z.value=a,await Pt(),S.value=!0},ze=async()=>{F.success("Метрики обновлены"),await ie({silent:!0})},Le=async a=>{try{await ve.delete(a),F.success("Отчёт удалён"),await ie()}catch{F.error("Ошибка удаления отчёта")}},Pe=async()=>{if(!te.activityCode){F.warning("Выберите профессиональную область");return}P.value=!0;try{const a=await qe.calculate(r.params.id,te.activityCode),s=ke({id:a.scoring_result_id,participant_id:r.params.id,prof_activity_code:a.prof_activity_code||te.activityCode,prof_activity_name:a.prof_activity_name,score_pct:parseFloat(a.score_pct),strengths:a.strengths||[],dev_areas:a.dev_areas||[],recommendations:a.recommendations||[],recommendations_status:a.recommendations_status||((a.recommendations||[]).length>0?"ready":"pending"),recommendations_error:a.recommendations_error||null,created_at:new Date().toISOString()});J.value.unshift(s),F.success("Расчёт пригодности выполнен"),b.value=!1,te.activityCode=""}catch(a){console.error("Scoring calculation error:",a);const s=a.response?.data?.detail||"Ошибка расчёта пригодности";F.error(s)}finally{P.value=!1}},Ue=async a=>{if(!a.prof_activity_code){F.warning("Код профессиональной деятельности не найден");return}try{const s=await qe.downloadFinalReportPdf(r.params.id,a.prof_activity_code,a.id),D=window.URL.createObjectURL(new Blob([s.data])),E=document.createElement("a");E.href=D,E.setAttribute("download",`final_report_${a.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(E),E.click(),E.remove(),window.URL.revokeObjectURL(D),F.success("Отчёт PDF скачан")}catch(s){const D=s.response?.data?.detail||"Ошибка загрузки PDF отчёта";F.error(D)}},A=a=>a?.recommendations_status==="ready"||a?.recommendations_status==="disabled",Oe=a=>a?.recommendations_status==="pending"?"Дождитесь завершения генерации рекомендаций":a?.recommendations_status==="error"?"Ошибка генерации рекомендаций. Попробуйте пересчитать пригодность":"",mt=a=>a?.recommendations_error?`Ошибка генерации: ${a.recommendations_error}`:"Не удалось получить рекомендации";return Ye(async()=>{window.addEventListener("resize",M),await re(),await ie(),await Ce(),await $e(),await w()}),et(()=>{window.removeEventListener("resize",M),Se(),xe()}),(a,s)=>{const D=c("el-button"),E=c("el-icon"),pe=c("el-descriptions-item"),ft=c("el-descriptions"),Ve=c("el-card"),_t=c("el-progress"),Be=c("el-empty"),vt=c("el-tag"),me=c("el-alert"),gt=c("el-tooltip"),yt=c("el-timeline-item"),wt=c("el-timeline"),ht=c("el-upload"),Xe=c("el-dialog"),bt=c("el-option"),kt=c("el-select"),Ct=c("el-form-item"),$t=c("el-form"),st=at("loading");return l(),m(Ut,null,{default:e(()=>[he((l(),$("div",La,[T.value?(l(),m(Ve,{key:0,class:"detail-card"},{header:e(()=>[u("div",Pa,[u("h2",null,y(T.value.full_name),1),u("div",Ua,[t(D,{onClick:s[0]||(s[0]=o=>v(k).back())},{default:e(()=>[...s[12]||(s[12]=[_(" Назад ",-1)])]),_:1}),t(D,{type:"info",onClick:s[1]||(s[1]=o=>H.value=!0)},{default:e(()=>[t(E,null,{default:e(()=>[t(v(zt))]),_:1}),s[13]||(s[13]=_(" Метрики ",-1))]),_:1}),t(D,{type:"primary",onClick:s[2]||(s[2]=o=>b.value=!0)},{default:e(()=>[t(E,null,{default:e(()=>[t(v(Lt))]),_:1}),s[14]||(s[14]=_(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(ft,{column:U.value?1:2,border:""},{default:e(()=>[t(pe,{label:"ФИО"},{default:e(()=>[_(y(T.value.full_name),1)]),_:1}),t(pe,{label:"Дата рождения"},{default:e(()=>[_(y(T.value.birth_date||"Не указана"),1)]),_:1}),t(pe,{label:"Внешний ID"},{default:e(()=>[_(y(T.value.external_id||"Не указан"),1)]),_:1}),t(pe,{label:"Дата создания"},{default:e(()=>[_(y(ue(T.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):x("",!0),t(Ve,{class:"section-card"},{header:e(()=>[u("div",Oa,[s[16]||(s[16]=u("h3",null,"Отчёты",-1)),t(D,{type:"primary",onClick:s[3]||(s[3]=o=>X.value=!0)},{default:e(()=>[t(E,null,{default:e(()=>[t(v(rt))]),_:1}),s[15]||(s[15]=_(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(Va,{reports:G.value,loading:N.value,onView:Me,onEdit:Me,onExtract:Ne,onDownload:Fe,onDelete:Le,onUpload:s[4]||(s[4]=o=>X.value=!0)},null,8,["reports","loading"])]),_:1}),J.value.length>0?(l(),m(Ve,{key:1,class:"section-card"},{header:e(()=>[...s[17]||(s[17]=[u("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(wt,null,{default:e(()=>[(l(!0),$(ae,null,se(J.value,o=>(l(),m(yt,{key:o.id,timestamp:ue(o.created_at),placement:"top"},{default:e(()=>[t(Ve,null,{default:e(()=>[u("h4",null,y(o.prof_activity_name),1),u("div",Ba,[u("div",Xa,[u("span",Ga,y(o.score_pct)+"%",1),t(_t,{percentage:o.score_pct,status:de(o.score_pct)},null,8,["percentage","status"])]),u("div",qa,[u("div",ja,[s[18]||(s[18]=u("h5",null,"Сильные стороны:",-1)),o.strengths&&o.strengths.length?(l(),$("ul",Ja,[(l(!0),$(ae,null,se(o.strengths,(ne,Ge)=>(l(),$("li",{key:Ge},[u("strong",null,y(ne.metric_name),1),_(" — "+y(v(ge)(ne.value))+" (вес "+y(v(ge)(ne.weight,2))+") ",1)]))),128))])):(l(),m(Be,{key:1,description:"Нет данных","image-size":60}))]),u("div",Wa,[s[19]||(s[19]=u("h5",null,"Зоны развития:",-1)),o.dev_areas&&o.dev_areas.length?(l(),$("ul",Ha,[(l(!0),$(ae,null,se(o.dev_areas,(ne,Ge)=>(l(),$("li",{key:Ge},[u("strong",null,y(ne.metric_name),1),_(" — "+y(v(ge)(ne.value))+" (вес "+y(v(ge)(ne.weight,2))+") ",1)]))),128))])):(l(),m(Be,{key:1,description:"Нет данных","image-size":60}))]),u("div",Ka,[u("h5",null,[s[20]||(s[20]=_(" Рекомендации: ",-1)),o.recommendations_status?(l(),m(vt,{key:0,type:f(o.recommendations_status),size:"small",class:"recommendation-status-tag"},{default:e(()=>[_(y(ce(o.recommendations_status)),1)]),_:2},1032,["type"])):x("",!0)]),o.recommendations_status==="pending"?(l(),m(me,{key:0,type:"info",closable:!1,"show-icon":""},{title:e(()=>[u("div",Za,[t(E,{class:"is-loading"},{default:e(()=>[t(v(tt))]),_:1}),s[21]||(s[21]=u("span",null,"Рекомендации формируются...",-1))])]),default:e(()=>[...s[22]||(s[22]=[_(" Кнопка «Скачать PDF» станет доступна после завершения генерации. ",-1)])]),_:1})):o.recommendations_status==="ready"?(l(),m(me,{key:1,title:"Рекомендации готовы",type:"success",closable:!1,"show-icon":""},{default:e(()=>[...s[23]||(s[23]=[_(" Персональные рекомендации доступны в итоговом PDF-отчёте. ",-1)])]),_:1})):o.recommendations_status==="error"?(l(),m(me,{key:2,title:mt(o),type:"error",closable:!1,"show-icon":""},{default:e(()=>[...s[24]||(s[24]=[_(" Не удалось сформировать рекомендации. Попробуйте пересчитать пригодность. ",-1)])]),_:1},8,["title"])):o.recommendations_status==="disabled"?(l(),m(me,{key:3,title:"Генерация рекомендаций отключена",type:"warning",closable:!1,"show-icon":""},{default:e(()=>[...s[25]||(s[25]=[_(" Генерация рекомендаций отключена для данного окружения. ",-1)])]),_:1})):(l(),m(Be,{key:4,description:"Статус рекомендаций неизвестен","image-size":60}))])]),o.prof_activity_code?(l(),$("div",Qa,[t(gt,{disabled:A(o),content:Oe(o),placement:"top"},{default:e(()=>[u("span",null,[t(D,{type:"primary",size:"small",disabled:!A(o),loading:o.recommendations_status==="pending",onClick:ne=>Ue(o)},{default:e(()=>[o.recommendations_status!=="pending"?(l(),m(E,{key:0},{default:e(()=>[t(v(Ke))]),_:1})):x("",!0),_(" "+y(o.recommendations_status==="pending"?"Формируется...":"Скачать PDF"),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},1032,["disabled","content"])])):x("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):x("",!0),t(Xe,{modelValue:X.value,"onUpdate:modelValue":s[6]||(s[6]=o=>X.value=o),title:"Загрузить отчёты",width:U.value?"95%":"600px",onClose:Ee},{footer:e(()=>[t(D,{onClick:s[5]||(s[5]=o=>X.value=!1)},{default:e(()=>[...s[28]||(s[28]=[_(" Отмена ",-1)])]),_:1}),t(D,{type:"primary",loading:I.value,disabled:!W.value.some(o=>o.status==="pending"),onClick:Ae},{default:e(()=>[_(" Загрузить все ("+y(W.value.filter(o=>o.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(ht,{ref_key:"uploadRef",ref:K,"auto-upload":!1,multiple:"",accept:".docx","on-change":Q,"show-file-list":!1,drag:""},{tip:e(()=>[...s[26]||(s[26]=[u("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(E,{class:"el-icon--upload"},{default:e(()=>[t(v(rt))]),_:1}),s[27]||(s[27]=u("div",{class:"el-upload__text"},[_(" Перетащите файлы сюда или "),u("em",null,"нажмите для выбора")],-1))]),_:1},512),W.value.length?(l(),$("div",Ya,[u("div",es," Выбрано файлов: "+y(W.value.length)+"/"+y(je),1),(l(!0),$(ae,null,se(W.value,o=>(l(),$("div",{key:o.id,class:Qe(["batch-file-item","batch-file-item--"+o.status])},[o.status==="pending"?(l(),m(E,{key:0,class:"batch-file-icon"},{default:e(()=>[t(v(He))]),_:1})):o.status==="uploading"?(l(),m(E,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(v(we))]),_:1})):o.status==="success"?(l(),m(E,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):o.status==="error"?(l(),m(E,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(v(We))]),_:1})):x("",!0),u("div",ts,[u("span",as,y(o.name),1),u("span",ss,y(p(o.size)),1),o.error?(l(),$("span",ls,y(o.error),1)):x("",!0)]),o.status==="pending"||o.status==="error"?(l(),m(D,{key:4,type:"danger",icon:v(Ze),circle:"",size:"small",onClick:ne=>Y(o.id)},null,8,["icon","onClick"])):x("",!0)],2))),128))])):x("",!0)]),_:1},8,["modelValue","width"]),t(Xe,{modelValue:b.value,"onUpdate:modelValue":s[9]||(s[9]=o=>b.value=o),title:"Рассчитать профессиональную пригодность",width:U.value?"95%":"500px"},{footer:e(()=>[t(D,{onClick:s[8]||(s[8]=o=>b.value=!1)},{default:e(()=>[...s[29]||(s[29]=[_(" Отмена ",-1)])]),_:1}),t(D,{type:"primary",loading:P.value,disabled:!te.activityCode||G.value.length===0,onClick:Pe},{default:e(()=>[...s[30]||(s[30]=[_(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t($t,{model:te,"label-position":"top"},{default:e(()=>[t(Ct,{label:"Профессиональная область",required:""},{default:e(()=>[he((l(),m(kt,{modelValue:te.activityCode,"onUpdate:modelValue":s[7]||(s[7]=o=>te.activityCode=o),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(l(!0),$(ae,null,se(h.value,o=>(l(),m(bt,{key:o.code,label:o.name,value:o.code},{default:e(()=>[u("span",null,y(o.name),1),u("span",ns,y(o.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[st,V.value]])]),_:1}),t(me,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),G.value.length===0?(l(),m(me,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):x("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Xe,{modelValue:S.value,"onUpdate:modelValue":s[10]||(s[10]=o=>S.value=o),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:e(()=>[z.value?(l(),m(fa,{key:0,"report-id":z.value,"report-status":n.value,onMetricsUpdated:ze},null,8,["report-id","report-status"])):x("",!0)]),_:1},8,["modelValue"]),t(za,{modelValue:H.value,"onUpdate:modelValue":s[11]||(s[11]=o=>H.value=o),"participant-id":T.value?.id,"participant-name":T.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[st,L.value]])]),_:1})}}},ps=be(os,[["__scopeId","data-v-55553c13"]]);export{ps as default};
