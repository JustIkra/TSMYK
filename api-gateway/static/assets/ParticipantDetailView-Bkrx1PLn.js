import{P as K,m as g,Q as Y,p as ne,r as c,c as $,o as n,d as t,x as A,R as $t,w as e,u as v,S as Rt,L as St,z as je,B as y,F as ee,H as Je,v as m,f,C as te,a as u,T as Se,U as Et,V as xt,W as Dt,X as Mt,M as at,Y as Vt,E as N,q as st,e as nt,I as lt,J as We,K as ye,Z as It,k as Oe,_ as Be,g as qe,$ as At,a0 as Ze,a1 as Qe,h as Ye,a2 as Xe,a3 as Ge,O as Ft,a4 as ot,n as Nt,a5 as zt,t as Lt,a6 as et,G as Tt}from"./index-zkfbsJOA.js";import{A as Ut}from"./AppLayout-CXdU4nmx.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Pt,m as ge,g as Ot,p as Bt}from"./metricNames-CxH-jaOC.js";import{p as rt,u as qt}from"./participants-BrOMXVXU.js";const _e={async upload(r,C){const i=new FormData;return i.append("file",C),(await K.post(`/participants/${r}/reports`,i,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(r){return await K.get(`/reports/${r}/download`,{responseType:"blob"})},async getById(r){return(await K.get(`/reports/${r}`)).data},async delete(r){return(await K.delete(`/reports/${r}`)).data},async extract(r){return(await K.post(`/reports/${r}/extract`)).data},async getMetrics(r){return(await K.get(`/reports/${r}/metrics`)).data},async getList(r){return(await K.get(`/participants/${r}/reports`)).data},async getReportImages(r){return(await K.get(`/reports/${r}/images`)).data}},Ue={async calculate(r,C){return(await K.post(`/scoring/participants/${r}/calculate`,null,{params:{activity_code:C}})).data},async getHistory(r,C=10){return(await K.get(`/scoring/participants/${r}/scores`,{params:{limit:C}})).data},async getById(r){return(await K.get(`/scoring-results/${r}`)).data},async generateRecommendations(r){return(await K.post(`/reports/${r}/recommendations`)).data},async getFinalReport(r,C,i="json"){const x={params:{activity_code:C,format:i}};i==="html"&&(x.responseType="text");const U=await K.get(`/participants/${r}/final-report`,x);return U.data},async downloadFinalReportPdf(r,C){return await K.get(`/participants/${r}/final-report`,{params:{activity_code:C,format:"pdf"},responseType:"blob"})}};function Re(r,C=1){if(r==null||r==="")return"";const i=typeof r=="string"?parseFloat(r):r;return isNaN(i)?"":i.toLocaleString("ru-RU",{minimumFractionDigits:C,maximumFractionDigits:C})}function ce(r){if(r==null||r==="")return null;const i=String(r).trim().replace(",","."),x=parseFloat(i);return isNaN(x)?null:x}function Xt(r){return ce(r)}function ve(r,C=1){return Re(r,C)}const Gt={key:0,class:"error-message"},jt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(r,{emit:C}){const i=r,x=C,U=g(null),z=g(""),P=g(!1),M=g(!1),V=g(""),R=Y(()=>ce(z.value)),O=Y(()=>{const d=R.value;return d===null||d<=i.min}),j=Y(()=>{const d=R.value;return d===null||d>=i.max}),X=d=>{if(d==null||d===""){z.value="";return}P.value?z.value=String(d).replace(".",","):z.value=Re(d,i.precision)},G=d=>{if(d==null||d==="")return M.value=!1,V.value="",!0;const l=ce(d);return l===null?(M.value=!0,V.value="Некорректное число",!1):l<i.min?(M.value=!0,V.value=`Значение должно быть не меньше ${Re(i.min,i.precision)}`,!1):l>i.max?(M.value=!0,V.value=`Значение должно быть не больше ${Re(i.max,i.precision)}`,!1):(M.value=!1,V.value="",!0)},h=d=>{const l=d.replace(/[^\d,.-]/g,"");let b=!1;const B=l.split("").filter(E=>E===","||E==="."?b?!1:(b=!0,!0):!0).join("").replace(".",",");z.value=B;const k=ce(B);k!==null?x("update:modelValue",k):(B===""||B==="-")&&x("update:modelValue",null)},I=()=>{P.value=!1;const d=ce(z.value);if(G(z.value)){if(d!==null){const l=Math.round(d*Math.pow(10,i.precision))/Math.pow(10,i.precision),b=Math.max(i.min,Math.min(i.max,l));x("update:modelValue",b),X(b),x("change",b)}}else if(d!==null&&(d<i.min||d>i.max)){const l=Math.max(i.min,Math.min(i.max,d));x("update:modelValue",l),X(l),x("change",l),M.value=!1,V.value=""}x("blur")},J=()=>{P.value=!0,R.value!==null&&(z.value=String(R.value).replace(".",","))},W=()=>{const d=R.value||0,l=Math.min(i.max,d+i.step),b=Math.round(l*Math.pow(10,i.precision))/Math.pow(10,i.precision);x("update:modelValue",b),x("change",b),X(b)},L=()=>{const d=R.value||0,l=Math.max(i.min,d-i.step),b=Math.round(l*Math.pow(10,i.precision))/Math.pow(10,i.precision);x("update:modelValue",b),x("change",b),X(b)};return ne(()=>i.modelValue,d=>{X(d)},{immediate:!0}),X(i.modelValue),(d,l)=>{const b=c("el-button"),B=c("el-button-group"),k=c("el-input");return n(),$(ee,null,[t(k,{ref_key:"inputRef",ref:U,modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=E=>z.value=E),placeholder:r.placeholder,disabled:r.disabled,class:je({"is-invalid":M.value}),onInput:h,onBlur:I,onFocus:J},$t({_:2},[r.showControls?{name:"append",fn:e(()=>[t(B,null,{default:e(()=>[t(b,{icon:v(Rt),disabled:r.disabled||O.value,onClick:L},null,8,["icon","disabled"]),t(b,{icon:v(St),disabled:r.disabled||j.value,onClick:W},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),M.value?(n(),$("div",Gt,y(V.value),1)):A("",!0)],64)}}},Jt=we(jt,[["__scopeId","data-v-74ef628d"]]),Wt={class:"card-header"},Ht={key:1},Kt={key:0,class:"metric-description"},Zt={key:0,class:"metrics-info"},Qt={class:"info-row"},Yt={key:0,class:"info-row"},ea={key:0,class:"loading-container"},ta={key:1,class:"no-images"},aa={key:2,class:"images-container"},sa={class:"image-controls"},na={class:"image-slide"},la=["src","alt"],oa={class:"image-info"},ra={class:"image-filename"},ia={key:0,class:"image-page"},ua={__name:"MetricsEditor",props:{reportId:{type:String,required:!0}},emits:["metrics-updated"],setup(r,{emit:C}){const i=r,x=C,U=g(!1),z=g(!1),P=g(!1),M=g(null),V=g([]),R=g([]),O=g({metrics:{}}),j=g({}),X=g("metrics"),G=g([]),h=g(!1),I=g(1),J=g(!1),W=g(null),L=g(500),d=Y(()=>{if(!V.value||V.value.length===0)return[];const _=new Set(R.value.filter(w=>{const T=parseFloat(String(w.value).replace(",","."));return!isNaN(T)&&T>0}).map(w=>w.metric_def_id));return V.value.filter(w=>{const T=_.has(w.id),Q=O.value.metrics[w.id],fe=Q!=null&&Q!==""&&parseFloat(String(Q).replace(",","."))>0;return T||fe})}),l=Y(()=>!R.value||R.value.length===0?[]:[...new Set(R.value.map(_=>_.source))]),b=Y(()=>!R.value||R.value.length===0?null:new Date),B=async()=>{try{const _=await ge.listMetricDefs(!0);V.value=_.items||[]}catch(_){console.error("Failed to load metric definitions:",_),M.value="Не удалось загрузить определения метрик"}},k=async()=>{U.value=!0,M.value=null;try{const _=await ge.listExtractedMetrics(i.reportId);R.value=_.items||[],O.value.metrics={},R.value.forEach(w=>{O.value.metrics[w.metric_def_id]=ce(w.value)}),j.value=JSON.parse(JSON.stringify(O.value.metrics))}catch(_){console.error("Failed to load metrics:",_),M.value="Не удалось загрузить метрики"}finally{U.value=!1}},E=()=>{P.value=!0,j.value=JSON.parse(JSON.stringify(O.value.metrics))},H=()=>{O.value.metrics=JSON.parse(JSON.stringify(j.value)),P.value=!1,M.value=null},le=async()=>{z.value=!0,M.value=null;try{const _=[];for(const[w,T]of Object.entries(O.value.metrics))if(T!=null&&T!==""){const Q=Xt(T);Q!==null&&_.push({metric_def_id:w,value:Q,source:"MANUAL",notes:null})}if(_.length===0){N.warning("Не введено ни одного значения метрики"),z.value=!1;return}await ge.bulkCreateExtractedMetrics(i.reportId,_),N.success(`Успешно сохранено ${_.length} метрик`),P.value=!1,await k(),x("metrics-updated")}catch(_){console.error("Failed to save metrics:",_);let w="Не удалось сохранить метрики";_.response?.data?.detail&&(typeof _.response.data.detail=="string"?w=_.response.data.detail:Array.isArray(_.response.data.detail)&&(w=_.response.data.detail.map(T=>T.msg||T.message).join(", "))),M.value=w,N.error(w)}finally{z.value=!1}},q=_=>{switch(_){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},pe=_=>{switch(_){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return _}},Z=_=>new Date(_).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),oe=async()=>{h.value=!0,M.value=null;try{G.value=await _e.getReportImages(i.reportId)}catch(_){console.error("Failed to load report images:",_),M.value="Не удалось загрузить изображения отчёта",N.error("Не удалось загрузить изображения отчёта")}finally{h.value=!1}},me=()=>{I.value<2&&(I.value=Math.min(2,I.value+.25))},re=()=>{I.value>.5&&(I.value=Math.max(.5,I.value-.25))},ie=()=>{I.value=1},p=()=>{J.value=!J.value,J.value?L.value=window.innerHeight-100:L.value=500};return Je(async()=>{await B(),await k()}),ne(()=>i.reportId,async _=>{_&&(await k(),G.value=[])}),ne(X,async _=>{_==="images"&&G.value.length===0&&!h.value&&await oe()}),(_,w)=>{const T=c("el-button"),Q=c("el-alert"),fe=c("el-form-item"),be=c("el-col"),Ee=c("el-row"),xe=c("el-form"),De=c("el-divider"),Me=c("el-tag"),he=c("el-tab-pane"),ae=c("el-icon"),Ve=c("el-empty"),Ie=c("el-button-group"),Ae=c("el-carousel-item"),ke=c("el-carousel"),Fe=c("el-tabs"),Ce=c("el-card");return n(),m(Ce,{class:"metrics-editor"},{header:e(()=>[u("div",Wt,[w[5]||(w[5]=u("span",null,"Ручной ввод метрик",-1)),P.value?(n(),$("div",Ht,[t(T,{size:"small",onClick:H},{default:e(()=>[...w[3]||(w[3]=[f(" Отмена ",-1)])]),_:1}),t(T,{type:"primary",size:"small",loading:z.value,onClick:le},{default:e(()=>[...w[4]||(w[4]=[f(" Сохранить ",-1)])]),_:1},8,["loading"])])):(n(),m(T,{key:0,type:"primary",size:"small",onClick:E},{default:e(()=>[...w[2]||(w[2]=[f(" Редактировать ",-1)])]),_:1}))])]),default:e(()=>[M.value?(n(),m(Q,{key:0,type:"error",title:M.value,closable:"",style:{"margin-bottom":"16px"},onClose:w[0]||(w[0]=F=>M.value=null)},null,8,["title"])):A("",!0),!R.value||R.value.length===0?(n(),m(Q,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...w[6]||(w[6]=[f(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):A("",!0),t(Fe,{modelValue:X.value,"onUpdate:modelValue":w[1]||(w[1]=F=>X.value=F),type:"card"},{default:e(()=>[t(he,{label:"Метрики",name:"metrics"},{default:e(()=>[t(xe,{ref:"formRef",model:O.value,"label-position":"top",disabled:!P.value},{default:e(()=>[t(Ee,{gutter:20},{default:e(()=>[(n(!0),$(ee,null,te(d.value,F=>(n(),m(be,{key:F.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(fe,{label:v(Pt)(F),prop:`metrics.${F.id}`},{default:e(()=>[t(Jt,{modelValue:O.value.metrics[F.id],"onUpdate:modelValue":Ne=>O.value.metrics[F.id]=Ne,min:F.min_value||1,max:F.max_value||10,precision:1,step:.1,disabled:!P.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),F.description?(n(),$("div",Kt,y(F.description),1)):A("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),R.value&&R.value.length>0?(n(),$("div",Zt,[t(De),u("div",Qt,[w[7]||(w[7]=u("span",{class:"info-label"},"Источник данных:",-1)),(n(!0),$(ee,null,te(l.value,F=>(n(),m(Me,{key:F,type:q(F),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[f(y(pe(F)),1)]),_:2},1032,["type"]))),128))]),b.value?(n(),$("div",Yt,[w[8]||(w[8]=u("span",{class:"info-label"},"Последнее обновление:",-1)),u("span",null,y(Z(b.value)),1)])):A("",!0)])):A("",!0)]),_:1}),t(he,{label:"Изображения отчёта",name:"images"},{default:e(()=>[h.value?(n(),$("div",ea,[t(ae,{class:"is-loading"},{default:e(()=>[t(v(Se))]),_:1}),w[9]||(w[9]=u("span",{style:{"margin-left":"8px"}},"Загрузка изображений...",-1))])):G.value.length===0?(n(),$("div",ta,[t(Ve,{description:"Изображения отсутствуют"},{image:e(()=>[t(ae,{size:60,color:"var(--el-color-info)"},{default:e(()=>[t(v(Et))]),_:1})]),_:1})])):(n(),$("div",aa,[u("div",sa,[t(Ie,null,{default:e(()=>[t(T,{disabled:I.value<=.5,onClick:re},{default:e(()=>[t(ae,null,{default:e(()=>[t(v(xt))]),_:1})]),_:1},8,["disabled"]),t(T,{onClick:ie},{default:e(()=>[f(y(Math.round(I.value*100))+"% ",1)]),_:1}),t(T,{disabled:I.value>=2,onClick:me},{default:e(()=>[t(ae,null,{default:e(()=>[t(v(Dt))]),_:1})]),_:1},8,["disabled"])]),_:1}),t(T,{style:{"margin-left":"12px"},onClick:p},{default:e(()=>[t(ae,null,{default:e(()=>[t(v(Mt))]),_:1}),w[10]||(w[10]=f(" Полноэкранный режим ",-1))]),_:1})]),u("div",{ref_key:"carouselContainer",ref:W,class:je(["carousel-wrapper",{fullscreen:J.value}])},[t(ke,{height:L.value+"px",arrow:"always","indicator-position":"outside"},{default:e(()=>[(n(!0),$(ee,null,te(G.value,F=>(n(),m(Ae,{key:F.id},{default:e(()=>[u("div",na,[u("div",{class:"image-wrapper",style:at({transform:`scale(${I.value})`})},[u("img",{src:F.data_url,alt:F.filename,class:"report-image"},null,8,la)],4),u("div",oa,[u("span",ra,y(F.filename),1),F.page_number?(n(),$("span",ia," Страница "+y(F.page_number),1)):A("",!0)])])]),_:2},1024))),128))]),_:1},8,["height"]),J.value?(n(),m(T,{key:0,class:"exit-fullscreen",circle:"",onClick:p},{default:e(()=>[t(ae,null,{default:e(()=>[t(v(Vt))]),_:1})]),_:1})):A("",!0)],2)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},da=we(ua,[["__scopeId","data-v-ad9146a8"]]),ca={class:"report-list"},pa={class:"report-list__controls"},ma={class:"controls-left"},fa={class:"controls-right"},_a={class:"filename"},va={class:"status-cell"},ga={key:1,class:"report-list__cards"},ya={class:"report-card__header"},wa={class:"report-card__status"},ba={class:"report-card__body"},ha={class:"report-card__field"},ka={class:"field-value field-value--filename"},Ca={class:"report-card__field"},$a={class:"field-value"},Ra={class:"report-card__actions"},Sa={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(r,{emit:C}){const i=r,x=C,U=st(),z=nt(),P=g(window.innerWidth<=768),M=()=>{P.value=window.innerWidth<=768};Je(()=>{window.addEventListener("resize",M),U.query.status&&(V.value=U.query.status),U.query.sort&&(R.value=U.query.sort)}),lt(()=>{window.removeEventListener("resize",M)});const V=g(""),R=g("desc"),O=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];ne([V,R],([d,l])=>{const b={...U.query};d?b.status=d:delete b.status,l?b.sort=l:delete b.sort,z.replace({query:b})});const j=()=>{},X=()=>{R.value=R.value==="desc"?"asc":"desc"},G=Y(()=>{let d=[...i.reports];return V.value&&(d=d.filter(l=>l.status===V.value)),d.sort((l,b)=>{const B=new Date(l.uploaded_at),k=new Date(b.uploaded_at);return R.value==="desc"?k-B:B-k}),d}),h=Y(()=>V.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),I=d=>{if(!d)return"—";const l=new Date(d);return Number.isNaN(l.getTime())?"—":l.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},J=d=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[d]||d,W=d=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[d]||"info",L=async({action:d,report:l})=>{switch(d){case"view":x("view",l.id);break;case"edit":x("edit",l.id);break;case"extract":x("extract",l.id);break;case"download":x("download",l.id);break;case"delete":try{await Ft.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),x("delete",l.id)}catch{}break}};return(d,l)=>{const b=c("el-option"),B=c("el-select"),k=c("el-icon"),E=c("el-button"),H=c("el-table-column"),le=c("el-tag"),q=c("el-dropdown-item"),pe=c("el-dropdown-menu"),Z=c("el-dropdown"),oe=c("el-table"),me=c("el-card"),re=c("el-empty"),ie=We("loading");return n(),$("div",ca,[u("div",pa,[u("div",ma,[t(B,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=p=>V.value=p),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:j},{default:e(()=>[t(b,{label:"Все статусы",value:""}),(n(),$(ee,null,te(O,p=>t(b,{key:p.value,label:p.label,value:p.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),u("div",fa,[t(E,{type:R.value==="desc"?"primary":"default",size:"small",onClick:X},{default:e(()=>[t(k,null,{default:e(()=>[t(v(It))]),_:1}),f(" "+y(R.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),P.value?ye((n(),$("div",ga,[(n(!0),$(ee,null,te(G.value,p=>(n(),m(me,{key:p.id,class:"report-card",shadow:"hover"},{header:e(()=>[u("div",ya,[u("div",wa,[p.status==="PROCESSING"?(n(),m(k,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(Se))]),_:1})):p.status==="EXTRACTED"?(n(),m(k,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Oe))]),_:1})):p.status==="FAILED"?(n(),m(k,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(Be))]),_:1})):(n(),m(k,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(qe))]),_:1})),t(le,{type:W(p.status),size:"small"},{default:e(()=>[f(y(J(p.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[u("div",Ra,[p.status==="EXTRACTED"?(n(),m(E,{key:0,type:"success",size:"small",onClick:_=>L({action:"edit",report:p})},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ze))]),_:1}),l[10]||(l[10]=f(" Редактировать ",-1))]),_:1},8,["onClick"])):A("",!0),p.status==="PROCESSING"||p.status==="EXTRACTED"?(n(),m(E,{key:1,type:"info",size:"small",onClick:_=>L({action:"view",report:p})},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Qe))]),_:1}),l[11]||(l[11]=f(" Просмотр ",-1))]),_:1},8,["onClick"])):A("",!0),t(E,{type:"primary",size:"small",onClick:_=>L({action:"extract",report:p})},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ye))]),_:1}),f(" "+y(p.status==="FAILED"?"Повторить":p.status==="PROCESSING"?"Перезапустить":p.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(E,{size:"small",onClick:_=>L({action:"download",report:p})},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Xe))]),_:1}),l[12]||(l[12]=f(" Скачать ",-1))]),_:1},8,["onClick"]),t(E,{type:"danger",size:"small",onClick:_=>L({action:"delete",report:p})},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ge))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[u("div",ba,[u("div",ha,[l[8]||(l[8]=u("span",{class:"field-label"},"Файл:",-1)),u("span",ka,y(p.file_ref?.filename||"Без названия"),1)]),u("div",Ca,[l[9]||(l[9]=u("span",{class:"field-label"},"Дата загрузки:",-1)),u("span",$a,y(I(p.uploaded_at)),1)])])]),_:2},1024))),128)),!G.value.length&&!r.loading?(n(),m(re,{key:0,description:h.value,"image-size":120},{default:e(()=>[V.value?A("",!0):(n(),m(E,{key:0,type:"primary",onClick:l[1]||(l[1]=p=>d.$emit("upload"))},{default:e(()=>[...l[13]||(l[13]=[f(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):A("",!0)])),[[ie,r.loading]]):ye((n(),m(oe,{key:0,data:G.value,class:"report-list__table",stripe:"","empty-text":h.value},{default:e(()=>[t(H,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:p})=>[u("span",_a,y(p.file_ref?.filename||"Без названия"),1)]),_:1}),t(H,{prop:"status",label:"Статус",width:"200"},{default:e(({row:p})=>[u("div",va,[p.status==="PROCESSING"?(n(),m(k,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(Se))]),_:1})):p.status==="EXTRACTED"?(n(),m(k,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Oe))]),_:1})):p.status==="FAILED"?(n(),m(k,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(Be))]),_:1})):(n(),m(k,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(qe))]),_:1})),t(le,{type:W(p.status),size:"default"},{default:e(()=>[f(y(J(p.status)),1)]),_:2},1032,["type"])])]),_:1}),t(H,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:p})=>[f(y(I(p.uploaded_at)),1)]),_:1}),t(H,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:p})=>[t(Z,{trigger:"click",onCommand:L},{dropdown:e(()=>[t(pe,null,{default:e(()=>[p.status==="EXTRACTED"?(n(),m(q,{key:0,command:{action:"edit",report:p}},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ze))]),_:1}),l[4]||(l[4]=f(" Редактировать метрики ",-1))]),_:1},8,["command"])):A("",!0),p.status==="PROCESSING"||p.status==="EXTRACTED"?(n(),m(q,{key:1,command:{action:"view",report:p}},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Qe))]),_:1}),l[5]||(l[5]=f(" Просмотр метрик ",-1))]),_:1},8,["command"])):A("",!0),t(q,{command:{action:"extract",report:p}},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ye))]),_:1}),f(" "+y(p.status==="FAILED"?"Повторить извлечение":p.status==="PROCESSING"?"Перезапустить извлечение":p.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(q,{divided:"",command:{action:"download",report:p}},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Xe))]),_:1}),l[6]||(l[6]=f(" Скачать ",-1))]),_:1},8,["command"]),t(q,{command:{action:"delete",report:p},class:"dropdown-item--danger"},{default:e(()=>[t(k,null,{default:e(()=>[t(v(Ge))]),_:1}),l[7]||(l[7]=f(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(E,{type:"primary",size:"small"},{default:e(()=>[l[3]||(l[3]=f(" Действия ",-1)),t(k,{class:"el-icon--right"},{default:e(()=>[t(v(At))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[ie,r.loading]]),!G.value.length&&!r.loading&&!P.value?(n(),m(re,{key:2,description:h.value,"image-size":120},{default:e(()=>[V.value?A("",!0):(n(),m(E,{key:0,type:"primary",onClick:l[2]||(l[2]=p=>d.$emit("upload"))},{default:e(()=>[...l[14]||(l[14]=[f(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):A("",!0)])}}},Ea=we(Sa,[["__scopeId","data-v-0ed222e2"]]),xa={class:"metrics-drawer"},Da={class:"drawer-actions"},Ma={key:1},Va={key:1},Ia={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(r,{emit:C}){const i=r,x=C,U=g(!1),z=g([]),P=g([]),M=Y(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),V=h=>{x("update:modelValue",h)},R=async()=>{try{const h=await ge.listMetricDefs(!0);P.value=h.items||[]}catch(h){console.error("Error loading metric definitions:",h)}},O=async()=>{U.value=!0;try{const h=await rt.getMetrics(i.participantId);z.value=h.metrics||[]}catch(h){console.error("Error loading participant metrics:",h),N.error("Ошибка загрузки метрик участника")}finally{U.value=!1}},j=h=>{if(!h)return"—";const I=P.value.find(W=>W.code===h);return Ot(I,h,{warn:()=>{}})},X=h=>h>=.8?"var(--el-color-success)":h>=.6?"var(--el-color-warning)":"var(--el-color-danger)",G=h=>{if(!h)return"—";const I=new Date(h);return Number.isNaN(I.getTime())?"—":I.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return ne(()=>i.participantId,async h=>{h&&i.modelValue&&(await R(),await O())}),ne(()=>i.modelValue,async h=>{h&&i.participantId&&(await R(),await O())}),(h,I)=>{const J=c("el-icon"),W=c("el-button"),L=c("el-table-column"),d=c("el-tag"),l=c("el-table"),b=c("el-empty"),B=c("el-drawer"),k=We("loading");return n(),m(B,{"model-value":r.modelValue,title:`Метрики участника: ${r.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":V},{default:e(()=>[ye((n(),$("div",xa,[u("div",Da,[t(W,{type:"primary",size:"small",onClick:O},{default:e(()=>[t(J,null,{default:e(()=>[t(v(ot))]),_:1}),I[0]||(I[0]=f(" Обновить ",-1))]),_:1})]),t(l,{data:z.value,stripe:"","empty-text":M.value},{default:e(()=>[t(L,{prop:"metric_code",label:"Код метрики",width:"200"}),t(L,{label:"Название метрики","min-width":"250"},{default:e(({row:E})=>[f(y(j(E.metric_code)),1)]),_:1}),t(L,{prop:"value",label:"Значение",width:"120"},{default:e(({row:E})=>[t(d,{type:"success"},{default:e(()=>[f(y(v(ve)(E.value)),1)]),_:2},1024)]),_:1}),t(L,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:E})=>[E.confidence!==null?(n(),$("span",{key:0,style:at({color:X(E.confidence)})},y((E.confidence*100).toFixed(0))+"% ",5)):(n(),$("span",Ma,"—"))]),_:1}),t(L,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:E})=>[f(y(G(E.updated_at)),1)]),_:1}),t(L,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:E})=>[E.last_source_report_id?(n(),m(d,{key:0,size:"small"},{default:e(()=>[...I[1]||(I[1]=[f(" Из отчёта ",-1)])]),_:1})):(n(),$("span",Va,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!z.value.length&&!U.value?(n(),m(b,{key:0,description:M.value},null,8,["description"])):A("",!0)])),[[k,U.value]])]),_:1},8,["model-value","title"])}}},Aa=we(Ia,[["__scopeId","data-v-93720633"]]),Fa={class:"participant-detail"},Na={class:"card-header"},za={class:"header-actions"},La={class:"section-header"},Ta={class:"scoring-result"},Ua={class:"score-value"},Pa={class:"score-number"},Oa={class:"score-details"},Ba={class:"score-section"},qa={key:0},Xa={class:"score-section"},Ga={key:0},ja={class:"score-section recommendations-status-section"},Ja={class:"recommendations-pending-alert"},Wa={key:0,class:"final-report-actions"},Ha={key:0,class:"batch-files-list"},Ka={class:"batch-files-header"},Za={class:"batch-file-info"},Qa={class:"batch-file-name"},Ya={class:"batch-file-size"},es={key:0,class:"batch-file-error"},ts={class:"activity-code-hint"},tt=20*1024*1024,Pe=10,as={__name:"ParticipantDetailView",setup(r){const C=nt(),i=st(),x=qt(),U=g(!1),z=g(!1),P=g(window.innerWidth<=768),M=()=>{P.value=window.innerWidth<=768},V=g(!1),R=g(!1),O=g(!1),j=Y(()=>x.currentParticipant),X=g([]),G=g([]),h=g([]),I=g([]),J=g(null),W=g(null),L=g(null),d=Y(()=>X.value.some(a=>a.status==="PROCESSING")),l=Y(()=>G.value.some(a=>a.recommendations_status==="pending")),b=g(!1),B=g(!1),k=g(!1),E=g(!1),H=g(null),le=g([]),q=g([]);let pe=0;const Z=Nt({activityCode:""}),oe=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},me=a=>a>=80?"success":a>=60?"":"warning",re=a=>({pending:"Формируются",ready:"Готовы",error:"Ошибка",disabled:"Отключены"})[a]||a,ie=a=>({pending:"info",ready:"success",error:"danger",disabled:"warning"})[a]||"info",p=async()=>{U.value=!0;try{await x.getParticipant(i.params.id)}catch{N.error("Участник не найден"),C.push("/participants")}finally{U.value=!1}},_=async({silent:a=!1}={})=>{a||(z.value=!0);try{const s=await rt.getReports(i.params.id);X.value=s.items||[]}catch(s){console.error("Error loading reports:",s),N.error("Ошибка загрузки списка отчётов")}finally{a||(z.value=!1)}},w=a=>{if(!a)return a;const s=Array.isArray(a.recommendations)?a.recommendations:[];let D=a.recommendations_status||a.recommendationsStatus||null;D||(D=s.length>0?"ready":"pending");const S=Number(a.score_pct),ue=Number.isNaN(S)?a.score_pct:S;return{...a,score_pct:ue,recommendations:s,recommendations_status:D,recommendations_error:a.recommendations_error||a.recommendationsError||null}},T=async()=>{try{const a=await Ue.getHistory(i.params.id),s=Array.isArray(a.items)?a.items:[];G.value=s.map(w)}catch(a){console.error("Error loading scoring results:",a)}},Q=async()=>{V.value=!0;try{const a=await Bt.list();h.value=a||[]}catch{N.error("Ошибка загрузки профессиональных областей")}finally{V.value=!1}},fe=async()=>{try{const a=await ge.listMetricDefs(!0);I.value=a.items||[]}catch(a){console.error("Error loading metric definitions:",a)}},be=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",Ee=a=>a.name.toLowerCase().endsWith(".docx")?a.size>tt?`Размер файла превышает ${be(tt)}`:null:"Только файлы формата .docx",xe=(a,s)=>{const D=a.raw;if(q.value.length>=Pe){N.warning(`Максимальное количество файлов: ${Pe}`),H.value&&H.value.clearFiles();return}const S=Ee(D);if(S){N.error(S),H.value&&H.value.clearFiles();return}q.value.push({id:++pe,file:D,name:D.name,size:D.size,status:"pending",progress:0,error:null,reportId:null}),H.value&&H.value.clearFiles()},De=a=>{q.value=q.value.filter(s=>s.id!==a)},Me=async a=>{a.status="uploading",a.progress=0;try{const s=await _e.upload(i.params.id,a.file);a.status="success",a.reportId=s.id}catch(s){a.status="error",a.error=s.response?.data?.detail||"Ошибка загрузки"}},he=async()=>{const a=q.value.filter(s=>s.status==="pending");if(a.length===0){N.warning("Нет файлов для загрузки");return}R.value=!0;try{await Promise.allSettled(a.map(S=>Me(S)));const s=q.value.filter(S=>S.status==="success").length,D=q.value.filter(S=>S.status==="error").length;D===0?(N.success(`Загружено ${s} отчётов`),b.value=!1,ae()):N.warning(`Загружено: ${s}, ошибок: ${D}`),await _()}finally{R.value=!1}},ae=()=>{q.value=[],le.value=[],H.value&&H.value.clearFiles()},Ve=async a=>{try{const s=await _e.download(a),D=window.URL.createObjectURL(new Blob([s.data])),S=document.createElement("a");S.href=D,S.setAttribute("download",`report_${a}.docx`),document.body.appendChild(S),S.click(),S.remove(),window.URL.revokeObjectURL(D),N.success("Отчёт скачан")}catch{N.error("Ошибка скачивания отчёта")}},Ie=async a=>{try{await _e.extract(a),N.success("Извлечение метрик запущено"),await _()}catch{N.error("Ошибка запуска извлечения метрик")}},Ae=()=>{W.value||(W.value=setInterval(async()=>{try{await _({silent:!0})}catch(a){console.error("Auto-refresh error:",a)}},3e3))},ke=()=>{W.value&&(clearInterval(W.value),W.value=null)},Fe=()=>{L.value||(L.value=setInterval(async()=>{try{await T()}catch(a){console.error("Recommendations auto-refresh error:",a)}},15e3))},Ce=()=>{L.value&&(clearInterval(L.value),L.value=null)};ne(d,a=>{a?Ae():ke()}),ne(l,a=>{a?Fe():Ce()});const F=async a=>{J.value=a,await Tt(),k.value=!0},Ne=async()=>{N.success("Метрики обновлены")},it=async a=>{try{await _e.delete(a),N.success("Отчёт удалён"),await _()}catch{N.error("Ошибка удаления отчёта")}},ut=async()=>{if(!Z.activityCode){N.warning("Выберите профессиональную область");return}O.value=!0;try{const a=await Ue.calculate(i.params.id,Z.activityCode),s=w({id:a.scoring_result_id,participant_id:i.params.id,prof_activity_code:a.prof_activity_code||Z.activityCode,prof_activity_name:a.prof_activity_name,score_pct:parseFloat(a.score_pct),strengths:a.strengths||[],dev_areas:a.dev_areas||[],recommendations:a.recommendations||[],recommendations_status:a.recommendations_status||((a.recommendations||[]).length>0?"ready":"pending"),recommendations_error:a.recommendations_error||null,created_at:new Date().toISOString()});G.value.unshift(s),N.success("Расчёт пригодности выполнен"),B.value=!1,Z.activityCode=""}catch(a){console.error("Scoring calculation error:",a);const s=a.response?.data?.detail||"Ошибка расчёта пригодности";N.error(s)}finally{O.value=!1}},dt=async a=>{if(!a.prof_activity_code){N.warning("Код профессиональной деятельности не найден");return}try{const s=await Ue.downloadFinalReportPdf(i.params.id,a.prof_activity_code),D=window.URL.createObjectURL(new Blob([s.data])),S=document.createElement("a");S.href=D,S.setAttribute("download",`final_report_${a.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(S),S.click(),S.remove(),window.URL.revokeObjectURL(D),N.success("Отчёт PDF скачан")}catch(s){const D=s.response?.data?.detail||"Ошибка загрузки PDF отчёта";N.error(D)}},He=a=>a?.recommendations_status==="ready"||a?.recommendations_status==="disabled",ct=a=>a?.recommendations_status==="pending"?"Дождитесь завершения генерации рекомендаций":a?.recommendations_status==="error"?"Ошибка генерации рекомендаций. Попробуйте пересчитать пригодность":"",pt=a=>a?.recommendations_error?`Ошибка генерации: ${a.recommendations_error}`:"Не удалось получить рекомендации";return Je(async()=>{window.addEventListener("resize",M),await p(),await _(),await T(),await Q(),await fe()}),lt(()=>{window.removeEventListener("resize",M),ke(),Ce()}),(a,s)=>{const D=c("el-button"),S=c("el-icon"),ue=c("el-descriptions-item"),mt=c("el-descriptions"),$e=c("el-card"),ft=c("el-progress"),ze=c("el-empty"),_t=c("el-tag"),de=c("el-alert"),vt=c("el-tooltip"),gt=c("el-timeline-item"),yt=c("el-timeline"),wt=c("el-upload"),Le=c("el-dialog"),bt=c("el-option"),ht=c("el-select"),kt=c("el-form-item"),Ct=c("el-form"),Ke=We("loading");return n(),m(Ut,null,{default:e(()=>[ye((n(),$("div",Fa,[j.value?(n(),m($e,{key:0,class:"detail-card"},{header:e(()=>[u("div",Na,[u("h2",null,y(j.value.full_name),1),u("div",za,[t(D,{onClick:s[0]||(s[0]=o=>v(C).back())},{default:e(()=>[...s[12]||(s[12]=[f(" Назад ",-1)])]),_:1}),t(D,{type:"info",onClick:s[1]||(s[1]=o=>E.value=!0)},{default:e(()=>[t(S,null,{default:e(()=>[t(v(zt))]),_:1}),s[13]||(s[13]=f(" Метрики ",-1))]),_:1}),t(D,{type:"primary",onClick:s[2]||(s[2]=o=>B.value=!0)},{default:e(()=>[t(S,null,{default:e(()=>[t(v(Lt))]),_:1}),s[14]||(s[14]=f(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(mt,{column:P.value?1:2,border:""},{default:e(()=>[t(ue,{label:"ФИО"},{default:e(()=>[f(y(j.value.full_name),1)]),_:1}),t(ue,{label:"Дата рождения"},{default:e(()=>[f(y(j.value.birth_date||"Не указана"),1)]),_:1}),t(ue,{label:"Внешний ID"},{default:e(()=>[f(y(j.value.external_id||"Не указан"),1)]),_:1}),t(ue,{label:"Дата создания"},{default:e(()=>[f(y(oe(j.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):A("",!0),t($e,{class:"section-card"},{header:e(()=>[u("div",La,[s[16]||(s[16]=u("h3",null,"Отчёты",-1)),t(D,{type:"primary",onClick:s[3]||(s[3]=o=>b.value=!0)},{default:e(()=>[t(S,null,{default:e(()=>[t(v(et))]),_:1}),s[15]||(s[15]=f(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(Ea,{reports:X.value,loading:z.value,onView:F,onEdit:F,onExtract:Ie,onDownload:Ve,onDelete:it,onUpload:s[4]||(s[4]=o=>b.value=!0)},null,8,["reports","loading"])]),_:1}),G.value.length>0?(n(),m($e,{key:1,class:"section-card"},{header:e(()=>[...s[17]||(s[17]=[u("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(yt,null,{default:e(()=>[(n(!0),$(ee,null,te(G.value,o=>(n(),m(gt,{key:o.id,timestamp:oe(o.created_at),placement:"top"},{default:e(()=>[t($e,null,{default:e(()=>[u("h4",null,y(o.prof_activity_name),1),u("div",Ta,[u("div",Ua,[u("span",Pa,y(o.score_pct)+"%",1),t(ft,{percentage:o.score_pct,status:me(o.score_pct)},null,8,["percentage","status"])]),u("div",Oa,[u("div",Ba,[s[18]||(s[18]=u("h5",null,"Сильные стороны:",-1)),o.strengths&&o.strengths.length?(n(),$("ul",qa,[(n(!0),$(ee,null,te(o.strengths,(se,Te)=>(n(),$("li",{key:Te},[u("strong",null,y(se.metric_name),1),f(" — "+y(v(ve)(se.value))+" (вес "+y(v(ve)(se.weight,2))+") ",1)]))),128))])):(n(),m(ze,{key:1,description:"Нет данных","image-size":60}))]),u("div",Xa,[s[19]||(s[19]=u("h5",null,"Зоны развития:",-1)),o.dev_areas&&o.dev_areas.length?(n(),$("ul",Ga,[(n(!0),$(ee,null,te(o.dev_areas,(se,Te)=>(n(),$("li",{key:Te},[u("strong",null,y(se.metric_name),1),f(" — "+y(v(ve)(se.value))+" (вес "+y(v(ve)(se.weight,2))+") ",1)]))),128))])):(n(),m(ze,{key:1,description:"Нет данных","image-size":60}))]),u("div",ja,[u("h5",null,[s[20]||(s[20]=f(" Рекомендации: ",-1)),o.recommendations_status?(n(),m(_t,{key:0,type:ie(o.recommendations_status),size:"small",class:"recommendation-status-tag"},{default:e(()=>[f(y(re(o.recommendations_status)),1)]),_:2},1032,["type"])):A("",!0)]),o.recommendations_status==="pending"?(n(),m(de,{key:0,type:"info",closable:!1,"show-icon":""},{title:e(()=>[u("div",Ja,[t(S,{class:"is-loading"},{default:e(()=>[t(v(ot))]),_:1}),s[21]||(s[21]=u("span",null,"Рекомендации формируются...",-1))])]),default:e(()=>[...s[22]||(s[22]=[f(" Кнопка «Скачать PDF» станет доступна после завершения генерации. ",-1)])]),_:1})):o.recommendations_status==="ready"?(n(),m(de,{key:1,title:"Рекомендации готовы",type:"success",closable:!1,"show-icon":""},{default:e(()=>[...s[23]||(s[23]=[f(" Персональные рекомендации доступны в итоговом PDF-отчёте. ",-1)])]),_:1})):o.recommendations_status==="error"?(n(),m(de,{key:2,title:pt(o),type:"error",closable:!1,"show-icon":""},{default:e(()=>[...s[24]||(s[24]=[f(" Не удалось сформировать рекомендации. Попробуйте пересчитать пригодность. ",-1)])]),_:1},8,["title"])):o.recommendations_status==="disabled"?(n(),m(de,{key:3,title:"Генерация рекомендаций отключена",type:"warning",closable:!1,"show-icon":""},{default:e(()=>[...s[25]||(s[25]=[f(" Генерация рекомендаций отключена для данного окружения. ",-1)])]),_:1})):(n(),m(ze,{key:4,description:"Статус рекомендаций неизвестен","image-size":60}))])]),o.prof_activity_code?(n(),$("div",Wa,[t(vt,{disabled:He(o),content:ct(o),placement:"top"},{default:e(()=>[u("span",null,[t(D,{type:"primary",size:"small",disabled:!He(o),loading:o.recommendations_status==="pending",onClick:se=>dt(o)},{default:e(()=>[o.recommendations_status!=="pending"?(n(),m(S,{key:0},{default:e(()=>[t(v(Xe))]),_:1})):A("",!0),f(" "+y(o.recommendations_status==="pending"?"Формируется...":"Скачать PDF"),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},1032,["disabled","content"])])):A("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):A("",!0),t(Le,{modelValue:b.value,"onUpdate:modelValue":s[6]||(s[6]=o=>b.value=o),title:"Загрузить отчёты",width:P.value?"95%":"600px",onClose:ae},{footer:e(()=>[t(D,{onClick:s[5]||(s[5]=o=>b.value=!1)},{default:e(()=>[...s[28]||(s[28]=[f(" Отмена ",-1)])]),_:1}),t(D,{type:"primary",loading:R.value,disabled:!q.value.some(o=>o.status==="pending"),onClick:he},{default:e(()=>[f(" Загрузить все ("+y(q.value.filter(o=>o.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(wt,{ref_key:"uploadRef",ref:H,"auto-upload":!1,multiple:"",accept:".docx","on-change":xe,"show-file-list":!1,drag:""},{tip:e(()=>[...s[26]||(s[26]=[u("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(S,{class:"el-icon--upload"},{default:e(()=>[t(v(et))]),_:1}),s[27]||(s[27]=u("div",{class:"el-upload__text"},[f(" Перетащите файлы сюда или "),u("em",null,"нажмите для выбора")],-1))]),_:1},512),q.value.length?(n(),$("div",Ha,[u("div",Ka," Выбрано файлов: "+y(q.value.length)+"/"+y(Pe),1),(n(!0),$(ee,null,te(q.value,o=>(n(),$("div",{key:o.id,class:je(["batch-file-item","batch-file-item--"+o.status])},[o.status==="pending"?(n(),m(S,{key:0,class:"batch-file-icon"},{default:e(()=>[t(v(qe))]),_:1})):o.status==="uploading"?(n(),m(S,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(v(Se))]),_:1})):o.status==="success"?(n(),m(S,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(v(Oe))]),_:1})):o.status==="error"?(n(),m(S,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(v(Be))]),_:1})):A("",!0),u("div",Za,[u("span",Qa,y(o.name),1),u("span",Ya,y(be(o.size)),1),o.error?(n(),$("span",es,y(o.error),1)):A("",!0)]),o.status==="pending"||o.status==="error"?(n(),m(D,{key:4,type:"danger",icon:v(Ge),circle:"",size:"small",onClick:se=>De(o.id)},null,8,["icon","onClick"])):A("",!0)],2))),128))])):A("",!0)]),_:1},8,["modelValue","width"]),t(Le,{modelValue:B.value,"onUpdate:modelValue":s[9]||(s[9]=o=>B.value=o),title:"Рассчитать профессиональную пригодность",width:P.value?"95%":"500px"},{footer:e(()=>[t(D,{onClick:s[8]||(s[8]=o=>B.value=!1)},{default:e(()=>[...s[29]||(s[29]=[f(" Отмена ",-1)])]),_:1}),t(D,{type:"primary",loading:O.value,disabled:!Z.activityCode||X.value.length===0,onClick:ut},{default:e(()=>[...s[30]||(s[30]=[f(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(Ct,{model:Z,"label-position":"top"},{default:e(()=>[t(kt,{label:"Профессиональная область",required:""},{default:e(()=>[ye((n(),m(ht,{modelValue:Z.activityCode,"onUpdate:modelValue":s[7]||(s[7]=o=>Z.activityCode=o),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(n(!0),$(ee,null,te(h.value,o=>(n(),m(bt,{key:o.code,label:o.name,value:o.code},{default:e(()=>[u("span",null,y(o.name),1),u("span",ts,y(o.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[Ke,V.value]])]),_:1}),t(de,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),X.value.length===0?(n(),m(de,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):A("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Le,{modelValue:k.value,"onUpdate:modelValue":s[10]||(s[10]=o=>k.value=o),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:e(()=>[J.value?(n(),m(da,{key:0,"report-id":J.value,onMetricsUpdated:Ne},null,8,["report-id"])):A("",!0)]),_:1},8,["modelValue"]),t(Aa,{modelValue:E.value,"onUpdate:modelValue":s[11]||(s[11]=o=>E.value=o),"participant-id":j.value?.id,"participant-name":j.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[Ke,U.value]])]),_:1})}}},is=we(as,[["__scopeId","data-v-02ebd03f"]]);export{is as default};
