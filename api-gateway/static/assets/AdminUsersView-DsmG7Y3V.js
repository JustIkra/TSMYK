import{A as V}from"./AppLayout-BGbCW9HM.js";import{N as _,a2 as P,m as b,D as g,l as T,O as L,H as R,E as p,v as f,w as s,r as h,I as F,o as m,a as w,d as u,J as M,B as y,u as k,f as v,c as G,F as H,x as S,M as I}from"./index-DBqgMp4b.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={async getPendingUsers(){return(await _.get("/admin/pending-users")).data},async getAllUsers(){return(await _.get("/admin/users")).data},async approveUser(o){return(await _.post(`/admin/approve/${o}`)).data},async makeAdmin(o){return(await _.post(`/admin/make-admin/${o}`)).data},async deleteUser(o){return(await _.delete(`/admin/users/${o}`)).data},async revokeAdmin(o){return(await _.post(`/admin/revoke-admin/${o}`)).data}},O=P("admin",()=>{const o=b([]),t=b([]),c=b(!1),i=b(null);async function E(){c.value=!0,i.value=null;try{const r=await A.getPendingUsers();return o.value=r,r}catch(r){const a=g(r,"Ошибка загрузки пользователей");throw i.value=a.message,r.normalizedError=a,r}finally{c.value=!1}}async function C(){c.value=!0,i.value=null;try{const r=await A.getAllUsers();return t.value=r,r}catch(r){const a=g(r,"Ошибка загрузки списка пользователей");throw i.value=a.message,r.normalizedError=a,r}finally{c.value=!1}}async function x(r){c.value=!0,i.value=null;try{const a=await A.approveUser(r);return o.value=o.value.filter(e=>e.id!==r),t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=g(a,"Ошибка одобрения пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{c.value=!1}}async function D(r){c.value=!0,i.value=null;try{const a=await A.makeAdmin(r);return t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=g(a,"Ошибка назначения прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{c.value=!1}}async function d(r){c.value=!0,i.value=null;try{const a=await A.deleteUser(r);return t.value=t.value.filter(e=>e.id!==r),o.value=o.value.filter(e=>e.id!==r),a}catch(a){const e=g(a,"Ошибка удаления пользователя");throw i.value=e.message,a.normalizedError=e,a}finally{c.value=!1}}async function l(r){c.value=!0,i.value=null;try{const a=await A.revokeAdmin(r);return t.value=t.value.map(e=>e.id===r?a:e),a}catch(a){const e=g(a,"Ошибка снятия прав администратора");throw i.value=e.message,a.normalizedError=e,a}finally{c.value=!1}}return{pendingUsers:o,users:t,loading:c,error:i,fetchPendingUsers:E,fetchAllUsers:C,approveUser:x,makeAdmin:D,revokeAdmin:l,deleteUser:d}}),j={class:"admin-users-view"},q={class:"actions-group"},K={__name:"AdminUsersView",setup(o){const t=O(),c=T(),i=L(()=>t.users),E=async d=>{try{await t.approveUser(d.id),p.success(`Пользователь ${d.email} одобрен`)}catch{p.error(t.error||"Ошибка одобрения пользователя")}},C=async d=>{try{await t.makeAdmin(d.id),p.success(`Пользователь ${d.email} назначен администратором`)}catch{p.error(t.error||"Ошибка назначения прав администратора")}},x=async d=>{try{await t.revokeAdmin(d.id),p.success(`Права администратора сняты с ${d.email}`)}catch{p.error(t.error||"Ошибка снятия прав администратора")}},D=async d=>{if(d.id===c.user?.id){p.error("Нельзя удалить собственную учётную запись администратора");return}try{await I.confirm(`Вы уверены, что хотите удалить пользователя ${d.email}?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning",confirmButtonClass:"el-button--danger"}),await t.deleteUser(d.id),p.success(`Пользователь ${d.email} удалён`)}catch(l){if(l==="cancel")return;p.error(t.error||"Ошибка удаления пользователя")}};return R(async()=>{try{await t.fetchPendingUsers(),await t.fetchAllUsers()}catch{p.error(t.error||"Ошибка загрузки пользователей")}}),(d,l)=>{const r=h("el-card"),a=h("el-empty"),e=h("el-table-column"),U=h("el-tag"),z=h("el-button"),N=h("el-table"),B=F("loading");return m(),f(V,null,{default:s(()=>[w("div",j,[u(r,{class:"header-card"},{default:s(()=>[...l[0]||(l[0]=[w("h1",null,"Управление пользователями",-1),w("p",null,"Одобрение новых пользователей, назначение админов и удаление учётных записей",-1)])]),_:1}),M((m(),f(r,{class:"users-card"},{default:s(()=>[w("h3",null,"Ожидают одобрения ("+y(k(t).pendingUsers.length)+")",1),k(t).pendingUsers.length===0?(m(),f(a,{key:0,description:"Нет пользователей, ожидающих одобрения"})):(m(),f(N,{key:1,data:k(t).pendingUsers,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Статус",width:"120"},{default:s(({row:n})=>[u(U,{type:"warning"},{default:s(()=>[v(y(n.status),1)]),_:2},1024)]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:n})=>[v(y(new Date(n.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"150",fixed:"right"},{default:s(({row:n})=>[w("div",q,[u(z,{type:"success",size:"small",onClick:$=>E(n)},{default:s(()=>[...l[1]||(l[1]=[v(" Одобрить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,k(t).loading]]),M((m(),f(r,{class:"users-card"},{default:s(()=>[w("h3",null,"Все пользователи ("+y(i.value.length)+")",1),i.value.length===0?(m(),f(a,{key:0,description:"Пользователи не найдены"})):(m(),f(N,{key:1,data:i.value,stripe:""},{default:s(()=>[u(e,{prop:"email",label:"Email","min-width":"250"}),u(e,{label:"Роль",width:"120"},{default:s(({row:n})=>[u(U,{type:n.role==="ADMIN"?"danger":"info"},{default:s(()=>[v(y(n.role),1)]),_:2},1032,["type"])]),_:1}),u(e,{label:"Статус",width:"140"},{default:s(({row:n})=>[u(U,{type:n.status==="ACTIVE"?"success":n.status==="PENDING"?"warning":"info"},{default:s(()=>[v(y(n.status),1)]),_:2},1032,["type"])]),_:1}),u(e,{prop:"created_at",label:"Дата регистрации",width:"180"},{default:s(({row:n})=>[v(y(new Date(n.created_at).toLocaleDateString("ru-RU")),1)]),_:1}),u(e,{label:"Действия",width:"180",align:"center"},{default:s(({row:n})=>[n.id===k(c).user?.id?(m(),f(U,{key:0,type:"info",size:"small"},{default:s(()=>[...l[2]||(l[2]=[v("Это вы",-1)])]),_:1})):(m(),G(H,{key:1},[n.role!=="ADMIN"?(m(),f(z,{key:0,type:"warning",size:"small",text:"",onClick:$=>C(n)},{default:s(()=>[...l[3]||(l[3]=[v(" В админы ",-1)])]),_:1},8,["onClick"])):S("",!0),n.role==="ADMIN"?(m(),f(z,{key:1,size:"small",text:"",onClick:$=>x(n)},{default:s(()=>[...l[4]||(l[4]=[v(" Снять ",-1)])]),_:1},8,["onClick"])):S("",!0),u(z,{type:"danger",size:"small",text:"",onClick:$=>D(n)},{default:s(()=>[...l[5]||(l[5]=[v(" Удалить ",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]))]),_:1})),[[B,k(t).loading]])])]),_:1})}}},Y=J(K,[["__scopeId","data-v-e3ca8f7b"]]);export{Y as default};
