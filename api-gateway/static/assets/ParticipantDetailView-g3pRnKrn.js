import{P as Z,m as g,Q as ee,p as oe,r as c,c as $,o as l,d as t,x as D,R as Rt,w as e,u as v,S as St,L as Et,z as Qe,B as y,F as ae,H as Ye,I as et,v as m,f as _,a as i,C as se,T as we,U as xt,V as Dt,W as Mt,X as It,M as ut,Y as Vt,Z as tt,E as N,q as dt,e as ct,J as at,K as be,_ as At,k as Je,$ as We,g as He,a0 as Nt,a1 as lt,a2 as nt,h as ot,a3 as Ke,a4 as Ze,O as Ft,n as zt,a5 as Tt,t as Lt,a6 as rt,G as Pt}from"./index-CjfMWYnu.js";import{A as Ut}from"./AppLayout-AS_O9BUo.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Ot,m as ye,g as Bt,p as Gt}from"./metricNames-BBrAYqAP.js";import{p as pt,u as Xt}from"./participants-BLnfBYBQ.js";const ve={async upload(r,k){const u=new FormData;return u.append("file",k),(await Z.post(`/participants/${r}/reports`,u,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(r){return await Z.get(`/reports/${r}/download`,{responseType:"blob"})},async getById(r){return(await Z.get(`/reports/${r}`)).data},async delete(r){return(await Z.delete(`/reports/${r}`)).data},async extract(r){return(await Z.post(`/reports/${r}/extract`)).data},async getMetrics(r){return(await Z.get(`/reports/${r}/metrics`)).data},async getList(r){return(await Z.get(`/participants/${r}/reports`)).data},async getReportImages(r){return(await Z.get(`/reports/${r}/images`)).data}},qe={async calculate(r,k){return(await Z.post(`/scoring/participants/${r}/calculate`,null,{params:{activity_code:k}})).data},async getHistory(r,k=10){return(await Z.get(`/scoring/participants/${r}/scores`,{params:{limit:k}})).data},async getById(r){return(await Z.get(`/scoring-results/${r}`)).data},async generateRecommendations(r){return(await Z.post(`/reports/${r}/recommendations`)).data},async getFinalReport(r,k,u="json"){const E={params:{activity_code:k,format:u}};u==="html"&&(E.responseType="text");const P=await Z.get(`/participants/${r}/final-report`,E);return P.data},async downloadFinalReportPdf(r,k){return await Z.get(`/participants/${r}/final-report`,{params:{activity_code:k,format:"pdf"},responseType:"blob"})}};function Ve(r,k=1){if(r==null||r==="")return"";const u=typeof r=="string"?parseFloat(r):r;return isNaN(u)?"":u.toLocaleString("ru-RU",{minimumFractionDigits:k,maximumFractionDigits:k})}function fe(r){if(r==null||r==="")return null;const u=String(r).trim().replace(",","."),E=parseFloat(u);return isNaN(E)?null:E}function qt(r){return fe(r)}function ge(r,k=1){return Ve(r,k)}const jt={key:0,class:"error-message"},Jt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(r,{emit:k}){const u=r,E=k,P=g(null),F=g(""),U=g(!1),M=g(!1),I=g(""),V=ee(()=>fe(F.value)),L=ee(()=>{const d=V.value;return d===null||d<=u.min}),z=ee(()=>{const d=V.value;return d===null||d>=u.max}),X=d=>{if(d==null||d===""){F.value="";return}U.value?F.value=String(d).replace(".",","):F.value=Ve(d,u.precision)},J=d=>{if(d==null||d==="")return M.value=!1,I.value="",!0;const n=fe(d);return n===null?(M.value=!0,I.value="Некорректное число",!1):n<u.min?(M.value=!0,I.value=`Значение должно быть не меньше ${Ve(u.min,u.precision)}`,!1):n>u.max?(M.value=!0,I.value=`Значение должно быть не больше ${Ve(u.max,u.precision)}`,!1):(M.value=!1,I.value="",!0)},b=d=>{const n=d.replace(/[^\d,.-]/g,"");let C=!1;const G=n.split("").filter(S=>S===","||S==="."?C?!1:(C=!0,!0):!0).join("").replace(".",",");F.value=G;const h=fe(G);h!==null?E("update:modelValue",h):(G===""||G==="-")&&E("update:modelValue",null)},q=()=>{U.value=!1;const d=fe(F.value);if(J(F.value)){if(d!==null){const n=Math.round(d*Math.pow(10,u.precision))/Math.pow(10,u.precision),C=Math.max(u.min,Math.min(u.max,n));E("update:modelValue",C),X(C),E("change",C)}}else if(d!==null&&(d<u.min||d>u.max)){const n=Math.max(u.min,Math.min(u.max,d));E("update:modelValue",n),X(n),E("change",n),M.value=!1,I.value=""}E("blur")},T=()=>{U.value=!0,V.value!==null&&(F.value=String(V.value).replace(".",","))},j=()=>{const d=V.value||0,n=Math.min(u.max,d+u.step),C=Math.round(n*Math.pow(10,u.precision))/Math.pow(10,u.precision);E("update:modelValue",C),E("change",C),X(C)},O=()=>{const d=V.value||0,n=Math.max(u.min,d-u.step),C=Math.round(n*Math.pow(10,u.precision))/Math.pow(10,u.precision);E("update:modelValue",C),E("change",C),X(C)};return oe(()=>u.modelValue,d=>{X(d)},{immediate:!0}),X(u.modelValue),(d,n)=>{const C=c("el-button"),G=c("el-button-group"),h=c("el-input");return l(),$(ae,null,[t(h,{ref_key:"inputRef",ref:P,modelValue:F.value,"onUpdate:modelValue":n[0]||(n[0]=S=>F.value=S),placeholder:r.placeholder,disabled:r.disabled,class:Qe({"is-invalid":M.value}),onInput:b,onBlur:q,onFocus:T},Rt({_:2},[r.showControls?{name:"append",fn:e(()=>[t(G,null,{default:e(()=>[t(C,{icon:v(St),disabled:r.disabled||L.value,onClick:O},null,8,["icon","disabled"]),t(C,{icon:v(Et),disabled:r.disabled||z.value,onClick:j},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),M.value?(l(),$("div",jt,y(I.value),1)):D("",!0)],64)}}},Wt=he(Jt,[["__scopeId","data-v-74ef628d"]]),Ht={class:"card-header"},Kt={class:"card-header-left"},Zt={class:"card-header-actions"},Qt={class:"metrics-filter"},Yt={class:"metrics-count"},ea={key:0,class:"metric-description"},ta={key:0,class:"metrics-info"},aa={class:"info-row"},sa={key:0,class:"info-row"},la={key:0,class:"loading-container"},na={key:1,class:"no-images"},oa={key:2,class:"images-container"},ra={class:"image-controls"},ia={class:"image-slide"},ua=["src","alt"],da={class:"image-info"},ca={class:"image-filename"},pa={key:0,class:"image-page"},ma={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null}},emits:["metrics-updated"],setup(r,{emit:k}){const u=r,E=k,P=g(!1),F=g(!1),U=g(!1),M=g(null),I=g(!1),V=g([]),L=g([]),z=g({metrics:{}}),X=g({}),J=g("metrics"),b=g([]),q=g(!1),T=g(1),j=g(!1),O=g(null),d=g(500),n=g(null),C=ee(()=>{if(!V.value||V.value.length===0)return[];if(I.value)return V.value;const w=new Set(L.value.filter(p=>{const B=parseFloat(String(p.value).replace(",","."));return!isNaN(B)&&B>0}).map(p=>p.metric_def_id));return V.value.filter(p=>{const B=w.has(p.id),Q=z.value.metrics[p.id],Y=Q!=null&&Q!==""&&parseFloat(String(Q).replace(",","."))>0;return B||Y})}),G=ee(()=>!L.value||L.value.length===0?[]:[...new Set(L.value.map(w=>w.source))]),h=ee(()=>!L.value||L.value.length===0?null:new Date),S=async()=>{try{const w=await ye.listMetricDefs(!0);V.value=w.items||[]}catch(w){console.error("Failed to load metric definitions:",w),M.value="Не удалось загрузить определения метрик"}},H=async()=>{P.value=!0,M.value=null;try{const w=await ye.listExtractedMetrics(u.reportId);L.value=w.items||[],z.value.metrics={},L.value.forEach(p=>{z.value.metrics[p.metric_def_id]=fe(p.value)}),X.value=JSON.parse(JSON.stringify(z.value.metrics))}catch(w){console.error("Failed to load metrics:",w),M.value="Не удалось загрузить метрики"}finally{P.value=!1}},K=async()=>{await H(),N.success("Метрики обновлены")},le=()=>{n.value||(n.value=setInterval(async()=>{await H()},5e3))},W=()=>{n.value&&(clearInterval(n.value),n.value=null)},_e=()=>{U.value=!0,I.value=!0,X.value=JSON.parse(JSON.stringify(z.value.metrics))},te=()=>{z.value.metrics=JSON.parse(JSON.stringify(X.value)),U.value=!1,M.value=null},ue=async()=>{F.value=!0,M.value=null;try{const w=[];for(const[p,B]of Object.entries(z.value.metrics))if(B!=null&&B!==""){const Q=qt(B);Q!==null&&w.push({metric_def_id:p,value:Q,source:"MANUAL",notes:null})}if(w.length===0){N.warning("Не введено ни одного значения метрики"),F.value=!1;return}await ye.bulkCreateExtractedMetrics(u.reportId,w),N.success(`Успешно сохранено ${w.length} метрик`),U.value=!1,await H(),E("metrics-updated")}catch(w){console.error("Failed to save metrics:",w);let p="Не удалось сохранить метрики";w.response?.data?.detail&&(typeof w.response.data.detail=="string"?p=w.response.data.detail:Array.isArray(w.response.data.detail)&&(p=w.response.data.detail.map(B=>B.msg||B.message).join(", "))),M.value=p,N.error(p)}finally{F.value=!1}},de=w=>{switch(w){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},ce=w=>{switch(w){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return w}},f=w=>new Date(w).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=async()=>{q.value=!0,M.value=null;try{b.value=await ve.getReportImages(u.reportId)}catch(w){console.error("Failed to load report images:",w),M.value="Не удалось загрузить изображения отчёта",N.error("Не удалось загрузить изображения отчёта")}finally{q.value=!1}},ie=()=>{T.value<2&&(T.value=Math.min(2,T.value+.25))},ke=()=>{T.value>.5&&(T.value=Math.max(.5,T.value-.25))},Ce=()=>{T.value=1},$e=()=>{j.value=!j.value,j.value?d.value=window.innerHeight-100:d.value=500};return Ye(async()=>{await S()}),et(()=>{W()}),oe(()=>u.reportId,async w=>{w&&(await H(),b.value=[])}),oe(()=>u.reportStatus,async(w,p)=>{p||await H(),w==="PROCESSING"?(le(),p&&p!=="PROCESSING"&&await H()):(W(),w==="EXTRACTED"&&p==="PROCESSING"&&await H())},{immediate:!0}),oe(J,async w=>{w==="images"&&b.value.length===0&&!q.value&&await re()}),(w,p)=>{const B=c("el-icon"),Q=c("el-tag"),Y=c("el-button"),Re=c("el-alert"),Ae=c("el-switch"),Se=c("el-form-item"),Ne=c("el-col"),Fe=c("el-row"),ze=c("el-form"),Ee=c("el-divider"),xe=c("el-tab-pane"),De=c("el-empty"),Me=c("el-button-group"),Te=c("el-carousel-item"),Le=c("el-carousel"),Pe=c("el-tabs"),Ue=c("el-card");return l(),m(Ue,{class:"metrics-editor"},{header:e(()=>[i("div",Ht,[i("div",Kt,[p[5]||(p[5]=i("span",null,"Метрики отчёта",-1)),r.reportStatus==="PROCESSING"?(l(),m(Q,{key:0,type:"warning",size:"small",class:"status-tag"},{default:e(()=>[t(B,{class:"is-loading"},{default:e(()=>[t(v(we))]),_:1}),p[3]||(p[3]=_(" Извлечение... ",-1))]),_:1})):r.reportStatus==="EXTRACTED"?(l(),m(Q,{key:1,type:"success",size:"small",class:"status-tag"},{default:e(()=>[...p[4]||(p[4]=[_(" Извлечено ",-1)])]),_:1})):D("",!0)]),i("div",Zt,[U.value?D("",!0):(l(),m(Y,{key:0,size:"small",loading:P.value,onClick:K},{default:e(()=>[t(B,null,{default:e(()=>[t(v(tt))]),_:1}),p[6]||(p[6]=_(" Обновить ",-1))]),_:1},8,["loading"])),U.value?(l(),$(ae,{key:2},[t(Y,{size:"small",onClick:te},{default:e(()=>[...p[8]||(p[8]=[_(" Отмена ",-1)])]),_:1}),t(Y,{type:"primary",size:"small",loading:F.value,onClick:ue},{default:e(()=>[...p[9]||(p[9]=[_(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(l(),m(Y,{key:1,type:"primary",size:"small",onClick:_e},{default:e(()=>[...p[7]||(p[7]=[_(" Редактировать ",-1)])]),_:1}))])])]),default:e(()=>[M.value?(l(),m(Re,{key:0,type:"error",title:M.value,closable:"",style:{"margin-bottom":"16px"},onClose:p[0]||(p[0]=A=>M.value=null)},null,8,["title"])):D("",!0),!L.value||L.value.length===0?(l(),m(Re,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...p[10]||(p[10]=[_(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):D("",!0),t(Pe,{modelValue:J.value,"onUpdate:modelValue":p[2]||(p[2]=A=>J.value=A),type:"card"},{default:e(()=>[t(xe,{label:"Метрики",name:"metrics"},{default:e(()=>[i("div",Qt,[t(Ae,{modelValue:I.value,"onUpdate:modelValue":p[1]||(p[1]=A=>I.value=A),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),i("span",Yt," Показано: "+y(C.value.length)+" из "+y(V.value.length),1)]),t(ze,{ref:"formRef",model:z.value,"label-position":"top",disabled:!U.value},{default:e(()=>[t(Fe,{gutter:20},{default:e(()=>[(l(!0),$(ae,null,se(C.value,A=>(l(),m(Ne,{key:A.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(Se,{label:v(Ot)(A),prop:`metrics.${A.id}`},{default:e(()=>[t(Wt,{modelValue:z.value.metrics[A.id],"onUpdate:modelValue":Oe=>z.value.metrics[A.id]=Oe,min:A.min_value||1,max:A.max_value||10,precision:1,step:.1,disabled:!U.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),A.description?(l(),$("div",ea,y(A.description),1)):D("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),L.value&&L.value.length>0?(l(),$("div",ta,[t(Ee),i("div",aa,[p[11]||(p[11]=i("span",{class:"info-label"},"Источник данных:",-1)),(l(!0),$(ae,null,se(G.value,A=>(l(),m(Q,{key:A,type:de(A),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[_(y(ce(A)),1)]),_:2},1032,["type"]))),128))]),h.value?(l(),$("div",sa,[p[12]||(p[12]=i("span",{class:"info-label"},"Последнее обновление:",-1)),i("span",null,y(f(h.value)),1)])):D("",!0)])):D("",!0)]),_:1}),t(xe,{label:"Изображения отчёта",name:"images"},{default:e(()=>[q.value?(l(),$("div",la,[t(B,{class:"is-loading"},{default:e(()=>[t(v(we))]),_:1}),p[13]||(p[13]=i("span",{style:{"margin-left":"8px"}},"Загрузка изображений...",-1))])):b.value.length===0?(l(),$("div",na,[t(De,{description:"Изображения отсутствуют"},{image:e(()=>[t(B,{size:60,color:"var(--el-color-info)"},{default:e(()=>[t(v(xt))]),_:1})]),_:1})])):(l(),$("div",oa,[i("div",ra,[t(Me,null,{default:e(()=>[t(Y,{disabled:T.value<=.5,onClick:ke},{default:e(()=>[t(B,null,{default:e(()=>[t(v(Dt))]),_:1})]),_:1},8,["disabled"]),t(Y,{onClick:Ce},{default:e(()=>[_(y(Math.round(T.value*100))+"% ",1)]),_:1}),t(Y,{disabled:T.value>=2,onClick:ie},{default:e(()=>[t(B,null,{default:e(()=>[t(v(Mt))]),_:1})]),_:1},8,["disabled"])]),_:1}),t(Y,{style:{"margin-left":"12px"},onClick:$e},{default:e(()=>[t(B,null,{default:e(()=>[t(v(It))]),_:1}),p[14]||(p[14]=_(" Полноэкранный режим ",-1))]),_:1})]),i("div",{ref_key:"carouselContainer",ref:O,class:Qe(["carousel-wrapper",{fullscreen:j.value}])},[t(Le,{height:d.value+"px",arrow:"always","indicator-position":"outside"},{default:e(()=>[(l(!0),$(ae,null,se(b.value,A=>(l(),m(Te,{key:A.id},{default:e(()=>[i("div",ia,[i("div",{class:"image-wrapper",style:ut({transform:`scale(${T.value})`})},[i("img",{src:A.data_url,alt:A.filename,class:"report-image"},null,8,ua)],4),i("div",da,[i("span",ca,y(A.filename),1),A.page_number?(l(),$("span",pa," Страница "+y(A.page_number),1)):D("",!0)])])]),_:2},1024))),128))]),_:1},8,["height"]),j.value?(l(),m(Y,{key:0,class:"exit-fullscreen",circle:"",onClick:$e},{default:e(()=>[t(B,null,{default:e(()=>[t(v(Vt))]),_:1})]),_:1})):D("",!0)],2)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},fa=he(ma,[["__scopeId","data-v-bf697254"]]),_a={class:"report-list"},va={class:"report-list__controls"},ga={class:"controls-left"},ya={class:"controls-right"},wa={class:"filename"},ba={class:"status-cell"},ha={key:1,class:"report-list__cards"},ka={class:"report-card__header"},Ca={class:"report-card__status"},$a={class:"report-card__body"},Ra={class:"report-card__field"},Sa={class:"field-value field-value--filename"},Ea={class:"report-card__field"},xa={class:"field-value"},Da={class:"report-card__actions"},Ma={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(r,{emit:k}){const u=r,E=k,P=dt(),F=ct(),U=g(window.innerWidth<=768),M=()=>{U.value=window.innerWidth<=768};Ye(()=>{window.addEventListener("resize",M),P.query.status&&(I.value=P.query.status),P.query.sort&&(V.value=P.query.sort)}),et(()=>{window.removeEventListener("resize",M)});const I=g(""),V=g("desc"),L=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];oe([I,V],([d,n])=>{const C={...P.query};d?C.status=d:delete C.status,n?C.sort=n:delete C.sort,F.replace({query:C})});const z=()=>{},X=()=>{V.value=V.value==="desc"?"asc":"desc"},J=ee(()=>{let d=[...u.reports];return I.value&&(d=d.filter(n=>n.status===I.value)),d.sort((n,C)=>{const G=new Date(n.uploaded_at),h=new Date(C.uploaded_at);return V.value==="desc"?h-G:G-h}),d}),b=ee(()=>I.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),q=d=>{if(!d)return"—";const n=new Date(d);return Number.isNaN(n.getTime())?"—":n.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},T=d=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[d]||d,j=d=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[d]||"info",O=async({action:d,report:n})=>{switch(d){case"view":E("view",n.id);break;case"edit":E("edit",n.id);break;case"extract":E("extract",n.id);break;case"download":E("download",n.id);break;case"delete":try{await Ft.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),E("delete",n.id)}catch{}break}};return(d,n)=>{const C=c("el-option"),G=c("el-select"),h=c("el-icon"),S=c("el-button"),H=c("el-table-column"),K=c("el-tag"),le=c("el-dropdown-item"),W=c("el-dropdown-menu"),_e=c("el-dropdown"),te=c("el-table"),ue=c("el-card"),de=c("el-empty"),ce=at("loading");return l(),$("div",_a,[i("div",va,[i("div",ga,[t(G,{modelValue:I.value,"onUpdate:modelValue":n[0]||(n[0]=f=>I.value=f),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:z},{default:e(()=>[t(C,{label:"Все статусы",value:""}),(l(),$(ae,null,se(L,f=>t(C,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),i("div",ya,[t(S,{type:V.value==="desc"?"primary":"default",size:"small",onClick:X},{default:e(()=>[t(h,null,{default:e(()=>[t(v(At))]),_:1}),_(" "+y(V.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),U.value?be((l(),$("div",ha,[(l(!0),$(ae,null,se(J.value,f=>(l(),m(ue,{key:f.id,class:"report-card",shadow:"hover"},{header:e(()=>[i("div",ka,[i("div",Ca,[f.status==="PROCESSING"?(l(),m(h,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):f.status==="EXTRACTED"?(l(),m(h,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):f.status==="FAILED"?(l(),m(h,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(We))]),_:1})):(l(),m(h,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(He))]),_:1})),t(K,{type:j(f.status),size:"small"},{default:e(()=>[_(y(T(f.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[i("div",Da,[f.status==="EXTRACTED"?(l(),m(S,{key:0,type:"success",size:"small",onClick:re=>O({action:"edit",report:f})},{default:e(()=>[t(h,null,{default:e(()=>[t(v(lt))]),_:1}),n[10]||(n[10]=_(" Редактировать ",-1))]),_:1},8,["onClick"])):D("",!0),f.status==="PROCESSING"||f.status==="EXTRACTED"?(l(),m(S,{key:1,type:"info",size:"small",onClick:re=>O({action:"view",report:f})},{default:e(()=>[t(h,null,{default:e(()=>[t(v(nt))]),_:1}),n[11]||(n[11]=_(" Просмотр ",-1))]),_:1},8,["onClick"])):D("",!0),t(S,{type:"primary",size:"small",onClick:re=>O({action:"extract",report:f})},{default:e(()=>[t(h,null,{default:e(()=>[t(v(ot))]),_:1}),_(" "+y(f.status==="FAILED"?"Повторить":f.status==="PROCESSING"?"Перезапустить":f.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(S,{size:"small",onClick:re=>O({action:"download",report:f})},{default:e(()=>[t(h,null,{default:e(()=>[t(v(Ke))]),_:1}),n[12]||(n[12]=_(" Скачать ",-1))]),_:1},8,["onClick"]),t(S,{type:"danger",size:"small",onClick:re=>O({action:"delete",report:f})},{default:e(()=>[t(h,null,{default:e(()=>[t(v(Ze))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[i("div",$a,[i("div",Ra,[n[8]||(n[8]=i("span",{class:"field-label"},"Файл:",-1)),i("span",Sa,y(f.file_ref?.filename||"Без названия"),1)]),i("div",Ea,[n[9]||(n[9]=i("span",{class:"field-label"},"Дата загрузки:",-1)),i("span",xa,y(q(f.uploaded_at)),1)])])]),_:2},1024))),128)),!J.value.length&&!r.loading?(l(),m(de,{key:0,description:b.value,"image-size":120},{default:e(()=>[I.value?D("",!0):(l(),m(S,{key:0,type:"primary",onClick:n[1]||(n[1]=f=>d.$emit("upload"))},{default:e(()=>[...n[13]||(n[13]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):D("",!0)])),[[ce,r.loading]]):be((l(),m(te,{key:0,data:J.value,class:"report-list__table",stripe:"","empty-text":b.value},{default:e(()=>[t(H,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:f})=>[i("span",wa,y(f.file_ref?.filename||"Без названия"),1)]),_:1}),t(H,{prop:"status",label:"Статус",width:"200"},{default:e(({row:f})=>[i("div",ba,[f.status==="PROCESSING"?(l(),m(h,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(v(we))]),_:1})):f.status==="EXTRACTED"?(l(),m(h,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):f.status==="FAILED"?(l(),m(h,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(v(We))]),_:1})):(l(),m(h,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(v(He))]),_:1})),t(K,{type:j(f.status),size:"default"},{default:e(()=>[_(y(T(f.status)),1)]),_:2},1032,["type"])])]),_:1}),t(H,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:f})=>[_(y(q(f.uploaded_at)),1)]),_:1}),t(H,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:f})=>[t(_e,{trigger:"click",onCommand:O},{dropdown:e(()=>[t(W,null,{default:e(()=>[f.status==="EXTRACTED"?(l(),m(le,{key:0,command:{action:"edit",report:f}},{default:e(()=>[t(h,null,{default:e(()=>[t(v(lt))]),_:1}),n[4]||(n[4]=_(" Редактировать метрики ",-1))]),_:1},8,["command"])):D("",!0),f.status==="PROCESSING"||f.status==="EXTRACTED"?(l(),m(le,{key:1,command:{action:"view",report:f}},{default:e(()=>[t(h,null,{default:e(()=>[t(v(nt))]),_:1}),n[5]||(n[5]=_(" Просмотр метрик ",-1))]),_:1},8,["command"])):D("",!0),t(le,{command:{action:"extract",report:f}},{default:e(()=>[t(h,null,{default:e(()=>[t(v(ot))]),_:1}),_(" "+y(f.status==="FAILED"?"Повторить извлечение":f.status==="PROCESSING"?"Перезапустить извлечение":f.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(le,{divided:"",command:{action:"download",report:f}},{default:e(()=>[t(h,null,{default:e(()=>[t(v(Ke))]),_:1}),n[6]||(n[6]=_(" Скачать ",-1))]),_:1},8,["command"]),t(le,{command:{action:"delete",report:f},class:"dropdown-item--danger"},{default:e(()=>[t(h,null,{default:e(()=>[t(v(Ze))]),_:1}),n[7]||(n[7]=_(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(S,{type:"primary",size:"small"},{default:e(()=>[n[3]||(n[3]=_(" Действия ",-1)),t(h,{class:"el-icon--right"},{default:e(()=>[t(v(Nt))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[ce,r.loading]]),!J.value.length&&!r.loading&&!U.value?(l(),m(de,{key:2,description:b.value,"image-size":120},{default:e(()=>[I.value?D("",!0):(l(),m(S,{key:0,type:"primary",onClick:n[2]||(n[2]=f=>d.$emit("upload"))},{default:e(()=>[...n[14]||(n[14]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):D("",!0)])}}},Ia=he(Ma,[["__scopeId","data-v-0ed222e2"]]),Va={class:"metrics-drawer"},Aa={class:"drawer-actions"},Na={key:1},Fa={key:1},za={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(r,{emit:k}){const u=r,E=k,P=g(!1),F=g([]),U=g([]),M=ee(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),I=b=>{E("update:modelValue",b)},V=async()=>{try{const b=await ye.listMetricDefs(!0);U.value=b.items||[]}catch(b){console.error("Error loading metric definitions:",b)}},L=async()=>{P.value=!0;try{const b=await pt.getMetrics(u.participantId);F.value=b.metrics||[]}catch(b){console.error("Error loading participant metrics:",b),N.error("Ошибка загрузки метрик участника")}finally{P.value=!1}},z=b=>{if(!b)return"—";const q=U.value.find(j=>j.code===b);return Bt(q,b,{warn:()=>{}})},X=b=>b>=.8?"var(--el-color-success)":b>=.6?"var(--el-color-warning)":"var(--el-color-danger)",J=b=>{if(!b)return"—";const q=new Date(b);return Number.isNaN(q.getTime())?"—":q.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return oe(()=>u.participantId,async b=>{b&&u.modelValue&&(await V(),await L())}),oe(()=>u.modelValue,async b=>{b&&u.participantId&&(await V(),await L())}),(b,q)=>{const T=c("el-icon"),j=c("el-button"),O=c("el-table-column"),d=c("el-tag"),n=c("el-table"),C=c("el-empty"),G=c("el-drawer"),h=at("loading");return l(),m(G,{"model-value":r.modelValue,title:`Метрики участника: ${r.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":I},{default:e(()=>[be((l(),$("div",Va,[i("div",Aa,[t(j,{type:"primary",size:"small",onClick:L},{default:e(()=>[t(T,null,{default:e(()=>[t(v(tt))]),_:1}),q[0]||(q[0]=_(" Обновить ",-1))]),_:1})]),t(n,{data:F.value,stripe:"","empty-text":M.value},{default:e(()=>[t(O,{prop:"metric_code",label:"Код метрики",width:"200"}),t(O,{label:"Название метрики","min-width":"250"},{default:e(({row:S})=>[_(y(z(S.metric_code)),1)]),_:1}),t(O,{prop:"value",label:"Значение",width:"120"},{default:e(({row:S})=>[t(d,{type:"success"},{default:e(()=>[_(y(v(ge)(S.value)),1)]),_:2},1024)]),_:1}),t(O,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:S})=>[S.confidence!==null?(l(),$("span",{key:0,style:ut({color:X(S.confidence)})},y((S.confidence*100).toFixed(0))+"% ",5)):(l(),$("span",Na,"—"))]),_:1}),t(O,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:S})=>[_(y(J(S.updated_at)),1)]),_:1}),t(O,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:S})=>[S.last_source_report_id?(l(),m(d,{key:0,size:"small"},{default:e(()=>[...q[1]||(q[1]=[_(" Из отчёта ",-1)])]),_:1})):(l(),$("span",Fa,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!F.value.length&&!P.value?(l(),m(C,{key:0,description:M.value},null,8,["description"])):D("",!0)])),[[h,P.value]])]),_:1},8,["model-value","title"])}}},Ta=he(za,[["__scopeId","data-v-93720633"]]),La={class:"participant-detail"},Pa={class:"card-header"},Ua={class:"header-actions"},Oa={class:"section-header"},Ba={class:"scoring-result"},Ga={class:"score-value"},Xa={class:"score-number"},qa={class:"score-details"},ja={class:"score-section"},Ja={key:0},Wa={class:"score-section"},Ha={key:0},Ka={class:"score-section recommendations-status-section"},Za={class:"recommendations-pending-alert"},Qa={key:0,class:"final-report-actions"},Ya={key:0,class:"batch-files-list"},es={class:"batch-files-header"},ts={class:"batch-file-info"},as={class:"batch-file-name"},ss={class:"batch-file-size"},ls={key:0,class:"batch-file-error"},ns={class:"activity-code-hint"},it=20*1024*1024,je=10,os={__name:"ParticipantDetailView",setup(r){const k=ct(),u=dt(),E=Xt(),P=g(!1),F=g(!1),U=g(window.innerWidth<=768),M=()=>{U.value=window.innerWidth<=768},I=g(!1),V=g(!1),L=g(!1),z=ee(()=>E.currentParticipant),X=g([]),J=g([]),b=g([]),q=g([]),T=g(null),j=g(null),O=g(null),d=ee(()=>X.value.some(a=>a.status==="PROCESSING")),n=ee(()=>T.value&&X.value.find(s=>s.id===T.value)?.status||null),C=ee(()=>J.value.some(a=>a.recommendations_status==="pending")),G=g(!1),h=g(!1),S=g(!1),H=g(!1),K=g(null),le=g([]),W=g([]);let _e=0;const te=zt({activityCode:""}),ue=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},de=a=>a>=80?"success":a>=60?"":"warning",ce=a=>({pending:"Формируются",ready:"Готовы",error:"Ошибка",disabled:"Отключены"})[a]||a,f=a=>({pending:"info",ready:"success",error:"danger",disabled:"warning"})[a]||"info",re=async()=>{P.value=!0;try{await E.getParticipant(u.params.id)}catch{N.error("Участник не найден"),k.push("/participants")}finally{P.value=!1}},ie=async({silent:a=!1}={})=>{a||(F.value=!0);try{const s=await pt.getReports(u.params.id);X.value=s.items||[]}catch(s){console.error("Error loading reports:",s),N.error("Ошибка загрузки списка отчётов")}finally{a||(F.value=!1)}},ke=a=>{if(!a)return a;const s=Array.isArray(a.recommendations)?a.recommendations:[];let x=a.recommendations_status||a.recommendationsStatus||null;x||(x=s.length>0?"ready":"pending");const R=Number(a.score_pct),pe=Number.isNaN(R)?a.score_pct:R;return{...a,score_pct:pe,recommendations:s,recommendations_status:x,recommendations_error:a.recommendations_error||a.recommendationsError||null}},Ce=async()=>{try{const a=await qe.getHistory(u.params.id),s=Array.isArray(a.items)?a.items:[];J.value=s.map(ke)}catch(a){console.error("Error loading scoring results:",a)}},$e=async()=>{I.value=!0;try{const a=await Gt.list();b.value=a||[]}catch{N.error("Ошибка загрузки профессиональных областей")}finally{I.value=!1}},w=async()=>{try{const a=await ye.listMetricDefs(!0);q.value=a.items||[]}catch(a){console.error("Error loading metric definitions:",a)}},p=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",B=a=>a.name.toLowerCase().endsWith(".docx")?a.size>it?`Размер файла превышает ${p(it)}`:null:"Только файлы формата .docx",Q=(a,s)=>{const x=a.raw;if(W.value.length>=je){N.warning(`Максимальное количество файлов: ${je}`),K.value&&K.value.clearFiles();return}const R=B(x);if(R){N.error(R),K.value&&K.value.clearFiles();return}W.value.push({id:++_e,file:x,name:x.name,size:x.size,status:"pending",progress:0,error:null,reportId:null}),K.value&&K.value.clearFiles()},Y=a=>{W.value=W.value.filter(s=>s.id!==a)},Re=async a=>{a.status="uploading",a.progress=0;try{const s=await ve.upload(u.params.id,a.file);a.status="success",a.reportId=s.id}catch(s){a.status="error",a.error=s.response?.data?.detail||"Ошибка загрузки"}},Ae=async()=>{const a=W.value.filter(s=>s.status==="pending");if(a.length===0){N.warning("Нет файлов для загрузки");return}V.value=!0;try{await Promise.allSettled(a.map(R=>Re(R)));const s=W.value.filter(R=>R.status==="success").length,x=W.value.filter(R=>R.status==="error").length;x===0?(N.success(`Загружено ${s} отчётов`),G.value=!1,Se()):N.warning(`Загружено: ${s}, ошибок: ${x}`),await ie()}finally{V.value=!1}},Se=()=>{W.value=[],le.value=[],K.value&&K.value.clearFiles()},Ne=async a=>{try{const s=await ve.download(a),x=window.URL.createObjectURL(new Blob([s.data])),R=document.createElement("a");R.href=x,R.setAttribute("download",`report_${a}.docx`),document.body.appendChild(R),R.click(),R.remove(),window.URL.revokeObjectURL(x),N.success("Отчёт скачан")}catch{N.error("Ошибка скачивания отчёта")}},Fe=async a=>{try{await ve.extract(a),N.success("Извлечение метрик запущено"),await ie()}catch{N.error("Ошибка запуска извлечения метрик")}},ze=()=>{j.value||(j.value=setInterval(async()=>{try{await ie({silent:!0})}catch(a){console.error("Auto-refresh error:",a)}},3e3))},Ee=()=>{j.value&&(clearInterval(j.value),j.value=null)},xe=()=>{O.value||(O.value=setInterval(async()=>{try{await Ce()}catch(a){console.error("Recommendations auto-refresh error:",a)}},15e3))},De=()=>{O.value&&(clearInterval(O.value),O.value=null)};oe(d,a=>{a?ze():Ee()}),oe(C,a=>{a?xe():De()});const Me=async a=>{T.value=a,await Pt(),S.value=!0},Te=async()=>{N.success("Метрики обновлены"),await ie({silent:!0})},Le=async a=>{try{await ve.delete(a),N.success("Отчёт удалён"),await ie()}catch{N.error("Ошибка удаления отчёта")}},Pe=async()=>{if(!te.activityCode){N.warning("Выберите профессиональную область");return}L.value=!0;try{const a=await qe.calculate(u.params.id,te.activityCode),s=ke({id:a.scoring_result_id,participant_id:u.params.id,prof_activity_code:a.prof_activity_code||te.activityCode,prof_activity_name:a.prof_activity_name,score_pct:parseFloat(a.score_pct),strengths:a.strengths||[],dev_areas:a.dev_areas||[],recommendations:a.recommendations||[],recommendations_status:a.recommendations_status||((a.recommendations||[]).length>0?"ready":"pending"),recommendations_error:a.recommendations_error||null,created_at:new Date().toISOString()});J.value.unshift(s),N.success("Расчёт пригодности выполнен"),h.value=!1,te.activityCode=""}catch(a){console.error("Scoring calculation error:",a);const s=a.response?.data?.detail||"Ошибка расчёта пригодности";N.error(s)}finally{L.value=!1}},Ue=async a=>{if(!a.prof_activity_code){N.warning("Код профессиональной деятельности не найден");return}try{const s=await qe.downloadFinalReportPdf(u.params.id,a.prof_activity_code),x=window.URL.createObjectURL(new Blob([s.data])),R=document.createElement("a");R.href=x,R.setAttribute("download",`final_report_${a.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(R),R.click(),R.remove(),window.URL.revokeObjectURL(x),N.success("Отчёт PDF скачан")}catch(s){const x=s.response?.data?.detail||"Ошибка загрузки PDF отчёта";N.error(x)}},A=a=>a?.recommendations_status==="ready"||a?.recommendations_status==="disabled",Oe=a=>a?.recommendations_status==="pending"?"Дождитесь завершения генерации рекомендаций":a?.recommendations_status==="error"?"Ошибка генерации рекомендаций. Попробуйте пересчитать пригодность":"",mt=a=>a?.recommendations_error?`Ошибка генерации: ${a.recommendations_error}`:"Не удалось получить рекомендации";return Ye(async()=>{window.addEventListener("resize",M),await re(),await ie(),await Ce(),await $e(),await w()}),et(()=>{window.removeEventListener("resize",M),Ee(),De()}),(a,s)=>{const x=c("el-button"),R=c("el-icon"),pe=c("el-descriptions-item"),ft=c("el-descriptions"),Ie=c("el-card"),_t=c("el-progress"),Be=c("el-empty"),vt=c("el-tag"),me=c("el-alert"),gt=c("el-tooltip"),yt=c("el-timeline-item"),wt=c("el-timeline"),bt=c("el-upload"),Ge=c("el-dialog"),ht=c("el-option"),kt=c("el-select"),Ct=c("el-form-item"),$t=c("el-form"),st=at("loading");return l(),m(Ut,null,{default:e(()=>[be((l(),$("div",La,[z.value?(l(),m(Ie,{key:0,class:"detail-card"},{header:e(()=>[i("div",Pa,[i("h2",null,y(z.value.full_name),1),i("div",Ua,[t(x,{onClick:s[0]||(s[0]=o=>v(k).back())},{default:e(()=>[...s[12]||(s[12]=[_(" Назад ",-1)])]),_:1}),t(x,{type:"info",onClick:s[1]||(s[1]=o=>H.value=!0)},{default:e(()=>[t(R,null,{default:e(()=>[t(v(Tt))]),_:1}),s[13]||(s[13]=_(" Метрики ",-1))]),_:1}),t(x,{type:"primary",onClick:s[2]||(s[2]=o=>h.value=!0)},{default:e(()=>[t(R,null,{default:e(()=>[t(v(Lt))]),_:1}),s[14]||(s[14]=_(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(ft,{column:U.value?1:2,border:""},{default:e(()=>[t(pe,{label:"ФИО"},{default:e(()=>[_(y(z.value.full_name),1)]),_:1}),t(pe,{label:"Дата рождения"},{default:e(()=>[_(y(z.value.birth_date||"Не указана"),1)]),_:1}),t(pe,{label:"Внешний ID"},{default:e(()=>[_(y(z.value.external_id||"Не указан"),1)]),_:1}),t(pe,{label:"Дата создания"},{default:e(()=>[_(y(ue(z.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):D("",!0),t(Ie,{class:"section-card"},{header:e(()=>[i("div",Oa,[s[16]||(s[16]=i("h3",null,"Отчёты",-1)),t(x,{type:"primary",onClick:s[3]||(s[3]=o=>G.value=!0)},{default:e(()=>[t(R,null,{default:e(()=>[t(v(rt))]),_:1}),s[15]||(s[15]=_(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(Ia,{reports:X.value,loading:F.value,onView:Me,onEdit:Me,onExtract:Fe,onDownload:Ne,onDelete:Le,onUpload:s[4]||(s[4]=o=>G.value=!0)},null,8,["reports","loading"])]),_:1}),J.value.length>0?(l(),m(Ie,{key:1,class:"section-card"},{header:e(()=>[...s[17]||(s[17]=[i("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(wt,null,{default:e(()=>[(l(!0),$(ae,null,se(J.value,o=>(l(),m(yt,{key:o.id,timestamp:ue(o.created_at),placement:"top"},{default:e(()=>[t(Ie,null,{default:e(()=>[i("h4",null,y(o.prof_activity_name),1),i("div",Ba,[i("div",Ga,[i("span",Xa,y(o.score_pct)+"%",1),t(_t,{percentage:o.score_pct,status:de(o.score_pct)},null,8,["percentage","status"])]),i("div",qa,[i("div",ja,[s[18]||(s[18]=i("h5",null,"Сильные стороны:",-1)),o.strengths&&o.strengths.length?(l(),$("ul",Ja,[(l(!0),$(ae,null,se(o.strengths,(ne,Xe)=>(l(),$("li",{key:Xe},[i("strong",null,y(ne.metric_name),1),_(" — "+y(v(ge)(ne.value))+" (вес "+y(v(ge)(ne.weight,2))+") ",1)]))),128))])):(l(),m(Be,{key:1,description:"Нет данных","image-size":60}))]),i("div",Wa,[s[19]||(s[19]=i("h5",null,"Зоны развития:",-1)),o.dev_areas&&o.dev_areas.length?(l(),$("ul",Ha,[(l(!0),$(ae,null,se(o.dev_areas,(ne,Xe)=>(l(),$("li",{key:Xe},[i("strong",null,y(ne.metric_name),1),_(" — "+y(v(ge)(ne.value))+" (вес "+y(v(ge)(ne.weight,2))+") ",1)]))),128))])):(l(),m(Be,{key:1,description:"Нет данных","image-size":60}))]),i("div",Ka,[i("h5",null,[s[20]||(s[20]=_(" Рекомендации: ",-1)),o.recommendations_status?(l(),m(vt,{key:0,type:f(o.recommendations_status),size:"small",class:"recommendation-status-tag"},{default:e(()=>[_(y(ce(o.recommendations_status)),1)]),_:2},1032,["type"])):D("",!0)]),o.recommendations_status==="pending"?(l(),m(me,{key:0,type:"info",closable:!1,"show-icon":""},{title:e(()=>[i("div",Za,[t(R,{class:"is-loading"},{default:e(()=>[t(v(tt))]),_:1}),s[21]||(s[21]=i("span",null,"Рекомендации формируются...",-1))])]),default:e(()=>[...s[22]||(s[22]=[_(" Кнопка «Скачать PDF» станет доступна после завершения генерации. ",-1)])]),_:1})):o.recommendations_status==="ready"?(l(),m(me,{key:1,title:"Рекомендации готовы",type:"success",closable:!1,"show-icon":""},{default:e(()=>[...s[23]||(s[23]=[_(" Персональные рекомендации доступны в итоговом PDF-отчёте. ",-1)])]),_:1})):o.recommendations_status==="error"?(l(),m(me,{key:2,title:mt(o),type:"error",closable:!1,"show-icon":""},{default:e(()=>[...s[24]||(s[24]=[_(" Не удалось сформировать рекомендации. Попробуйте пересчитать пригодность. ",-1)])]),_:1},8,["title"])):o.recommendations_status==="disabled"?(l(),m(me,{key:3,title:"Генерация рекомендаций отключена",type:"warning",closable:!1,"show-icon":""},{default:e(()=>[...s[25]||(s[25]=[_(" Генерация рекомендаций отключена для данного окружения. ",-1)])]),_:1})):(l(),m(Be,{key:4,description:"Статус рекомендаций неизвестен","image-size":60}))])]),o.prof_activity_code?(l(),$("div",Qa,[t(gt,{disabled:A(o),content:Oe(o),placement:"top"},{default:e(()=>[i("span",null,[t(x,{type:"primary",size:"small",disabled:!A(o),loading:o.recommendations_status==="pending",onClick:ne=>Ue(o)},{default:e(()=>[o.recommendations_status!=="pending"?(l(),m(R,{key:0},{default:e(()=>[t(v(Ke))]),_:1})):D("",!0),_(" "+y(o.recommendations_status==="pending"?"Формируется...":"Скачать PDF"),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},1032,["disabled","content"])])):D("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):D("",!0),t(Ge,{modelValue:G.value,"onUpdate:modelValue":s[6]||(s[6]=o=>G.value=o),title:"Загрузить отчёты",width:U.value?"95%":"600px",onClose:Se},{footer:e(()=>[t(x,{onClick:s[5]||(s[5]=o=>G.value=!1)},{default:e(()=>[...s[28]||(s[28]=[_(" Отмена ",-1)])]),_:1}),t(x,{type:"primary",loading:V.value,disabled:!W.value.some(o=>o.status==="pending"),onClick:Ae},{default:e(()=>[_(" Загрузить все ("+y(W.value.filter(o=>o.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(bt,{ref_key:"uploadRef",ref:K,"auto-upload":!1,multiple:"",accept:".docx","on-change":Q,"show-file-list":!1,drag:""},{tip:e(()=>[...s[26]||(s[26]=[i("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(R,{class:"el-icon--upload"},{default:e(()=>[t(v(rt))]),_:1}),s[27]||(s[27]=i("div",{class:"el-upload__text"},[_(" Перетащите файлы сюда или "),i("em",null,"нажмите для выбора")],-1))]),_:1},512),W.value.length?(l(),$("div",Ya,[i("div",es," Выбрано файлов: "+y(W.value.length)+"/"+y(je),1),(l(!0),$(ae,null,se(W.value,o=>(l(),$("div",{key:o.id,class:Qe(["batch-file-item","batch-file-item--"+o.status])},[o.status==="pending"?(l(),m(R,{key:0,class:"batch-file-icon"},{default:e(()=>[t(v(He))]),_:1})):o.status==="uploading"?(l(),m(R,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(v(we))]),_:1})):o.status==="success"?(l(),m(R,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(v(Je))]),_:1})):o.status==="error"?(l(),m(R,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(v(We))]),_:1})):D("",!0),i("div",ts,[i("span",as,y(o.name),1),i("span",ss,y(p(o.size)),1),o.error?(l(),$("span",ls,y(o.error),1)):D("",!0)]),o.status==="pending"||o.status==="error"?(l(),m(x,{key:4,type:"danger",icon:v(Ze),circle:"",size:"small",onClick:ne=>Y(o.id)},null,8,["icon","onClick"])):D("",!0)],2))),128))])):D("",!0)]),_:1},8,["modelValue","width"]),t(Ge,{modelValue:h.value,"onUpdate:modelValue":s[9]||(s[9]=o=>h.value=o),title:"Рассчитать профессиональную пригодность",width:U.value?"95%":"500px"},{footer:e(()=>[t(x,{onClick:s[8]||(s[8]=o=>h.value=!1)},{default:e(()=>[...s[29]||(s[29]=[_(" Отмена ",-1)])]),_:1}),t(x,{type:"primary",loading:L.value,disabled:!te.activityCode||X.value.length===0,onClick:Pe},{default:e(()=>[...s[30]||(s[30]=[_(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t($t,{model:te,"label-position":"top"},{default:e(()=>[t(Ct,{label:"Профессиональная область",required:""},{default:e(()=>[be((l(),m(kt,{modelValue:te.activityCode,"onUpdate:modelValue":s[7]||(s[7]=o=>te.activityCode=o),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(l(!0),$(ae,null,se(b.value,o=>(l(),m(ht,{key:o.code,label:o.name,value:o.code},{default:e(()=>[i("span",null,y(o.name),1),i("span",ns,y(o.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[st,I.value]])]),_:1}),t(me,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),X.value.length===0?(l(),m(me,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):D("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Ge,{modelValue:S.value,"onUpdate:modelValue":s[10]||(s[10]=o=>S.value=o),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:e(()=>[T.value?(l(),m(fa,{key:0,"report-id":T.value,"report-status":n.value,onMetricsUpdated:Te},null,8,["report-id","report-status"])):D("",!0)]),_:1},8,["modelValue"]),t(Ta,{modelValue:H.value,"onUpdate:modelValue":s[11]||(s[11]=o=>H.value=o),"participant-id":z.value?.id,"participant-name":z.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[st,P.value]])]),_:1})}}},ps=he(os,[["__scopeId","data-v-d2930f3b"]]);export{ps as default};
